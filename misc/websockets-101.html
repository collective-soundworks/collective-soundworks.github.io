<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>WebSockets 101 | soundworks</title>
    <meta name="description" content="Creative coding framework for distributed applications based on Web technologies">
    <meta name="generator" content="VitePress v2.0.0-alpha.16">
    <link rel="preload stylesheet" href="/assets/style.DklbAnHd.css" as="style">
    <link rel="preload stylesheet" href="/vp-icons.css" as="style">
    
    <script type="module" src="/assets/app.Crhjg3H6.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/theme.DKERbyZW.js">
    <link rel="modulepreload" href="/assets/chunks/framework.CRk2WtWN.js">
    <link rel="modulepreload" href="/assets/misc_websockets-101.md.C-gXDMS3.lean.js">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-304c8b69><!--[--><!--]--><!--[--><span tabindex="-1" data-v-10d4d845></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-10d4d845>Skip to content</a><!--]--><!----><header class="VPNav" data-v-304c8b69 data-v-d5bf7c8e><div class="VPNavBar has-sidebar top" data-v-d5bf7c8e data-v-cc1d9f2e><div class="wrapper" data-v-cc1d9f2e><div class="container" data-v-cc1d9f2e><div class="title" data-v-cc1d9f2e><div class="VPNavBarTitle has-sidebar" data-v-cc1d9f2e data-v-d4488dd0><a class="title" href="/" data-v-d4488dd0><!--[--><!--]--><!--[--><img class="VPImage logo" src="/logo-nav.png" alt data-v-ab19afbb><!--]--><span data-v-d4488dd0>soundworks</span><!--[--><!--]--></a></div></div><div class="content" data-v-cc1d9f2e><div class="content-body" data-v-cc1d9f2e><!--[--><!--]--><div class="VPNavBarSearch search" data-v-cc1d9f2e data-v-bdd98725><!--[--><button type="button" class="VPNavBarSearchButton" aria-label="Search" aria-keyshortcuts="/ control+k meta+k" data-v-bdd98725 data-v-69351052><span class="vpi-search" aria-hidden="true" data-v-69351052></span><span class="text" data-v-69351052>Search</span><span class="keys" aria-hidden="true" data-v-69351052><kbd class="key-cmd" data-v-69351052>⌘</kbd><kbd class="key-ctrl" data-v-69351052>Ctrl</kbd><kbd data-v-69351052>K</kbd></span></button><!----><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-cc1d9f2e data-v-020be4db><span id="main-nav-aria-label" class="visually-hidden" data-v-020be4db> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/tutorials/getting-started.html" tabindex="0" data-v-020be4db data-v-81dba28a><!--[--><span data-v-81dba28a>Guide</span><!--]--></a><!--]--><!--[--><a class="VPLink link vp-external-link-icon VPNavBarMenuLink" href="https://soundworks.dev/soundworks" target="_blank" rel="noreferrer" tabindex="0" data-v-020be4db data-v-81dba28a><!--[--><span data-v-81dba28a>soundworks API</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/credits.html" tabindex="0" data-v-020be4db data-v-81dba28a><!--[--><span data-v-81dba28a>Credits</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-cc1d9f2e data-v-3f90c1a5><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-3f90c1a5 data-v-be9742d9 data-v-b4ccac88><span class="check" data-v-b4ccac88><span class="icon" data-v-b4ccac88><!--[--><span class="vpi-sun sun" data-v-be9742d9></span><span class="vpi-moon moon" data-v-be9742d9></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-cc1d9f2e data-v-ef6192dc data-v-a1a7286e><!--[--><a class="VPSocialLink no-icon" href="https://github.com/collective-soundworks/collective-soundworks.github.io" aria-label="github" target="_blank" rel="me noopener" data-v-a1a7286e data-v-32d78712><span class="vpi-social-github"></span></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-cc1d9f2e data-v-600b50c9 data-v-d8fae6e2><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-d8fae6e2><span class="vpi-more-horizontal icon" data-v-d8fae6e2></span></button><div class="menu" data-v-d8fae6e2><div class="VPMenu" data-v-d8fae6e2 data-v-fcd1d7a8><!----><!--[--><!--[--><!----><div class="group" data-v-600b50c9><div class="item appearance" data-v-600b50c9><p class="label" data-v-600b50c9>Appearance</p><div class="appearance-action" data-v-600b50c9><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-600b50c9 data-v-be9742d9 data-v-b4ccac88><span class="check" data-v-b4ccac88><span class="icon" data-v-b4ccac88><!--[--><span class="vpi-sun sun" data-v-be9742d9></span><span class="vpi-moon moon" data-v-be9742d9></span><!--]--></span></span></button></div></div></div><div class="group" data-v-600b50c9><div class="item social-links" data-v-600b50c9><div class="VPSocialLinks social-links-list" data-v-600b50c9 data-v-a1a7286e><!--[--><a class="VPSocialLink no-icon" href="https://github.com/collective-soundworks/collective-soundworks.github.io" aria-label="github" target="_blank" rel="me noopener" data-v-a1a7286e data-v-32d78712><span class="vpi-social-github"></span></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-cc1d9f2e data-v-6bee1efd><span class="container" data-v-6bee1efd><span class="top" data-v-6bee1efd></span><span class="middle" data-v-6bee1efd></span><span class="bottom" data-v-6bee1efd></span></span></button></div></div></div></div><div class="divider" data-v-cc1d9f2e><div class="divider-line" data-v-cc1d9f2e></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-304c8b69 data-v-73add737><div class="container" data-v-73add737><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-73add737><span class="vpi-align-left menu-icon" data-v-73add737></span><span class="menu-text" data-v-73add737>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-73add737 data-v-e28a51a6><button data-v-e28a51a6>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-304c8b69 data-v-49f51a23><div class="curtain" data-v-49f51a23></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-49f51a23><span class="visually-hidden" id="sidebar-aria-label" data-v-49f51a23> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-a84b7c21><section class="VPSidebarItem level-0" data-v-a84b7c21 data-v-6b36a2fd><!----><div class="items" data-v-6b36a2fd><!--[--><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/introduction.html" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Introduction</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-a84b7c21><section class="VPSidebarItem level-0" data-v-a84b7c21 data-v-6b36a2fd><div class="item" role="button" tabindex="0" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><h2 class="text" data-v-6b36a2fd>Tutorials</h2><!----></div><div class="items" data-v-6b36a2fd><!--[--><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/tutorials/getting-started.html" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Getting Started</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/tutorials/state-manager.html" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Using the State Manager</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/tutorials/plugin-platform-init.html" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Using Plugins 1 - <i>platform-init</i></p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/tutorials/todo-noise.html" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>The <i>Todo Noise</i> Application</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/tutorials/node-clients.html" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Working with Node Clients</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/tutorials/plugin-sync.html" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Using Plugins 2 - <i>sync</i></p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/tutorials/step-sequencer.html" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Distributed Step Sequencer</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-a84b7c21><section class="VPSidebarItem level-0" data-v-a84b7c21 data-v-6b36a2fd><div class="item" role="button" tabindex="0" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><h2 class="text" data-v-6b36a2fd>Recipes</h2><!----></div><div class="items" data-v-6b36a2fd><!--[--><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/recipes/working-with-max.html" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Working with Max</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-a84b7c21><section class="VPSidebarItem level-0" data-v-a84b7c21 data-v-6b36a2fd><div class="item" role="button" tabindex="0" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><h2 class="text" data-v-6b36a2fd>Documentation</h2><!----></div><div class="items" data-v-6b36a2fd><!--[--><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link vp-external-link-icon link" href="https://soundworks.dev/soundworks" target="_blank" rel="noreferrer" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>soundworks API</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/tools/helpers.html" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Helpers</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/plugins/platform-init.html" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Plugin Platform Init</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/plugins/sync.html" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Plugin Sync</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/plugins/filesystem.html" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Plugin Filesystem</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/plugins/scripting.html" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Plugin Scripting</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/plugins/checkin.html" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Plugin Checkin</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/plugins/position.html" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Plugin Position</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/plugins/logger.html" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Plugin Logger</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-a84b7c21><section class="VPSidebarItem level-0" data-v-a84b7c21 data-v-6b36a2fd><div class="item" role="button" tabindex="0" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><h2 class="text" data-v-6b36a2fd>Ecosystem</h2><!----></div><div class="items" data-v-6b36a2fd><!--[--><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link vp-external-link-icon link" href="https://github.com/ircam-ismm/node-web-audio-api/" target="_blank" rel="noreferrer" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>node-web-audio-api</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link vp-external-link-icon link" href="https://github.com/ircam-ismm/sc-components/" target="_blank" rel="noreferrer" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>@ircam/sc-components</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link vp-external-link-icon link" href="https://github.com/ircam-ismm/sc-utils" target="_blank" rel="noreferrer" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>@ircam/sc-utils</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link vp-external-link-icon link" href="https://github.com/ircam-ismm/sc-scheduling/" target="_blank" rel="noreferrer" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>@ircam/sc-scheduling</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link vp-external-link-icon link" href="https://github.com/ircam-ismm/devicemotion" target="_blank" rel="noreferrer" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>@ircam/devicemotion</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link vp-external-link-icon link" href="https://ircam-ismm.github.io/dotpi/" target="_blank" rel="noreferrer" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>dotpi tools</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-a84b7c21><section class="VPSidebarItem level-0 has-active" data-v-a84b7c21 data-v-6b36a2fd><div class="item" role="button" tabindex="0" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><h2 class="text" data-v-6b36a2fd>Misc</h2><!----></div><div class="items" data-v-6b36a2fd><!--[--><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/misc/websockets-101.html" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>WebSockets 101</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-304c8b69 data-v-bd4f21ea><div class="VPDoc has-sidebar has-aside" data-v-bd4f21ea data-v-d668f7cc><!--[--><!--]--><div class="container" data-v-d668f7cc><div class="aside" data-v-d668f7cc><div class="aside-curtain" data-v-d668f7cc></div><div class="aside-container" data-v-d668f7cc><div class="aside-content" data-v-d668f7cc><div class="VPDocAside" data-v-d668f7cc data-v-cb998dce><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-cb998dce data-v-c8b19031><div class="content" data-v-c8b19031><div class="outline-marker" data-v-c8b19031></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-c8b19031>On this page</div><ul class="VPDocOutlineItem root" data-v-c8b19031 data-v-63c57e50><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-cb998dce></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-d668f7cc><div class="content-container" data-v-d668f7cc><!--[--><!--]--><main class="main" data-v-d668f7cc><div style="position:relative;" class="vp-doc _misc_websockets-101" data-v-d668f7cc><div><h1 id="websockets-101" tabindex="-1">WebSockets 101 <a class="header-anchor" href="#websockets-101" aria-label="Permalink to “WebSockets 101”">​</a></h1><p>WebSocket is a communication protocol that provides full-duplex communication channels over a single TCP connection. In other words, WebSockets enable bi-directionnal communication between a client and a server, meaning that both the client and the server can send data to the other, which is not possible with traditionnal HTTP protocol.</p><p>They are particularly useful for creating applications requiring instant updates, such as chats, multiplayer games, or in our case distributed music systems.</p><p><img src="/assets/protocol.D5Sgihg5.png" alt="protocol"></p><p>Let&#39;s then create a very simple application from groundup to have a taste of what using raw WebSockets means.</p><h2 id="scaffolding-the-project" tabindex="-1">Scaffolding the project <a class="header-anchor" href="#scaffolding-the-project" aria-label="Permalink to “Scaffolding the project”">​</a></h2><p>Let&#39;s first create a new simple project:</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki monokai" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#66D9EF;">cd</span><span style="color:#E6DB74;"> /path/to/working/directory</span></span>
<span class="line"><span style="color:#A6E22E;">npx</span><span style="color:#E6DB74;"> @ircam/create@latest</span><span style="color:#E6DB74;"> websockets-101</span></span></code></pre></div><p>In this project, we won&#39;t use the simple server which the command line tool propose (i.e. <code>npx serve</code>), but we will rather create our own server which will be able to handle websocket connections.</p><p>Let&#39;s then install some dependencies to simplifies the process:</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki monokai" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#66D9EF;">cd</span><span style="color:#E6DB74;"> websockets-101</span></span>
<span class="line"><span style="color:#A6E22E;">npm</span><span style="color:#E6DB74;"> install</span><span style="color:#AE81FF;"> --save</span><span style="color:#E6DB74;"> ws</span><span style="color:#E6DB74;"> server-static</span><span style="color:#E6DB74;"> finalhandler</span></span></code></pre></div><p>After the last command, you should see a new file called <code>package.json</code> that have been created by <code>npm</code> in order to (amongst other things) track the dependencies of your application. Let&#39;s just add the following line in the file so that we can use a more modern and compliant javascript syntax within node:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki monokai has-diff" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#88846F;">// package.json</span></span>
<span class="line"><span style="color:#F8F8F2;">{</span></span>
<span class="line diff add"><span style="color:#E6DB74;">  &quot;type&quot;</span><span style="color:#F8F8F2;">: </span><span style="color:#E6DB74;">&quot;module&quot;</span><span style="color:#F8F8F2;">, </span></span>
<span class="line"><span style="color:#E6DB74;">  &quot;dependencies&quot;</span><span style="color:#F8F8F2;">: {</span></span>
<span class="line"><span style="color:#E6DB74;">    &quot;finalhandler&quot;</span><span style="color:#F8F8F2;">: </span><span style="color:#E6DB74;">&quot;^1.2.0&quot;</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#E6DB74;">    &quot;serve-static&quot;</span><span style="color:#F8F8F2;">: </span><span style="color:#E6DB74;">&quot;^1.15.0&quot;</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#E6DB74;">    &quot;ws&quot;</span><span style="color:#F8F8F2;">: </span><span style="color:#E6DB74;">&quot;^8.16.0&quot;</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre></div><h2 id="implementing-the-server" tabindex="-1">Implementing the server <a class="header-anchor" href="#implementing-the-server" aria-label="Permalink to “Implementing the server”">​</a></h2><p>Now eveything is ready to implement our simple server. So, let&#39;s create a new file called <code>server.js</code> and let&#39;s start with importing all the dependencies we will need:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki monokai" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#88846F;">// server.js</span></span>
<span class="line"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> http </span><span style="color:#F92672;">from</span><span style="color:#E6DB74;"> &#39;node:http&#39;</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> { WebSocketServer } </span><span style="color:#F92672;">from</span><span style="color:#E6DB74;"> &#39;ws&#39;</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> serveStatic </span><span style="color:#F92672;">from</span><span style="color:#E6DB74;"> &#39;serve-static&#39;</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> finalHandler </span><span style="color:#F92672;">from</span><span style="color:#E6DB74;"> &#39;finalhandler&#39;</span><span style="color:#F8F8F2;">;</span></span></code></pre></div><p>Let&#39;s start with creating a simple HTTP server and configuring it so that it behaves as a static file server:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki monokai" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#88846F;">// create handler for static files</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> staticFileHandler </span><span style="color:#F92672;">=</span><span style="color:#A6E22E;"> serveStatic</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;./&#39;</span><span style="color:#F8F8F2;">, { index: [</span><span style="color:#E6DB74;">&#39;index.html&#39;</span><span style="color:#F8F8F2;">] })</span></span>
<span class="line"><span style="color:#88846F;">// create the server and use our static file handler to respond to requests</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> server </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> http.</span><span style="color:#A6E22E;">createServer</span><span style="color:#F8F8F2;">((</span><span style="color:#FD971F;font-style:italic;">req</span><span style="color:#F8F8F2;">, </span><span style="color:#FD971F;font-style:italic;">res</span><span style="color:#F8F8F2;">) </span><span style="color:#66D9EF;font-style:italic;">=&gt;</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#A6E22E;">  staticFileHandler</span><span style="color:#F8F8F2;">(req, res, </span><span style="color:#A6E22E;">finalHandler</span><span style="color:#F8F8F2;">(req, res))</span></span>
<span class="line"><span style="color:#F8F8F2;">});</span></span>
<span class="line"><span style="color:#88846F;">// start the server, listening for request on port 3000</span></span>
<span class="line"><span style="color:#F8F8F2;">server.</span><span style="color:#A6E22E;">listen</span><span style="color:#F8F8F2;">(</span><span style="color:#AE81FF;">3000</span><span style="color:#F8F8F2;">, () </span><span style="color:#66D9EF;font-style:italic;">=&gt;</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  console.</span><span style="color:#A6E22E;">log</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">`Server started: http://127.0.0.1:</span><span style="color:#F92672;">${</span><span style="color:#F8F8F2;">PORT</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;">`</span><span style="color:#F8F8F2;">);</span></span>
<span class="line"><span style="color:#F8F8F2;">});</span></span></code></pre></div><p>If you now start the server:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki monokai" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#F8F8F2;">node server.js</span></span></code></pre></div><p>And open the URL <a href="http://127.0.0.1:3000" target="_blank" rel="noreferrer">http://127.0.0.1:3000</a> in your browser, the server should retrieve all the files requested by the client, e.g. <code>index.html</code>, <code>main.js</code>, etc. and you should thus see the following on your screen:</p><p><img src="/assets/homepage.r0cl4Bmg.png" alt="homepage"></p><p>Let&#39;s then just modify a bit our server so that it can handle websockets connection as well:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki monokai has-diff" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#88846F;">// create handler for static files</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> staticFileHandler </span><span style="color:#F92672;">=</span><span style="color:#A6E22E;"> serveStatic</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;./&#39;</span><span style="color:#F8F8F2;">, { index: [</span><span style="color:#E6DB74;">&#39;index.html&#39;</span><span style="color:#F8F8F2;">] })</span></span>
<span class="line"><span style="color:#88846F;">// create the server and use our static file handler to respond to requests</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> server </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> http.</span><span style="color:#A6E22E;">createServer</span><span style="color:#F8F8F2;">((</span><span style="color:#FD971F;font-style:italic;">req</span><span style="color:#F8F8F2;">, </span><span style="color:#FD971F;font-style:italic;">res</span><span style="color:#F8F8F2;">) </span><span style="color:#66D9EF;font-style:italic;">=&gt;</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#A6E22E;">  staticFileHandler</span><span style="color:#F8F8F2;">(req, res, </span><span style="color:#A6E22E;">finalHandler</span><span style="color:#F8F8F2;">(req, res))</span></span>
<span class="line"><span style="color:#F8F8F2;">});</span></span>
<span class="line"><span style="color:#88846F;">// start the server, listening for request on port 3000</span></span>
<span class="line"><span style="color:#F8F8F2;">server.</span><span style="color:#A6E22E;">listen</span><span style="color:#F8F8F2;">(</span><span style="color:#AE81FF;">3000</span><span style="color:#F8F8F2;">, () </span><span style="color:#66D9EF;font-style:italic;">=&gt;</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  console.</span><span style="color:#A6E22E;">log</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">`Server started: http://127.0.0.1:3000`</span><span style="color:#F8F8F2;">);</span></span>
<span class="line"><span style="color:#F8F8F2;">});</span></span>
<span class="line diff add"><span style="color:#88846F;">// create the WebSocket server</span></span>
<span class="line diff add"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> wss </span><span style="color:#F92672;">=</span><span style="color:#F92672;"> new</span><span style="color:#A6E22E;"> WebSocketServer</span><span style="color:#F8F8F2;">({ server }); </span></span>
<span class="line diff add"><span style="color:#88846F;">// listen for &quot;connection&quot; event when a new WebSocket is created</span></span>
<span class="line diff add"><span style="color:#F8F8F2;">wss.</span><span style="color:#A6E22E;">on</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;connection&#39;</span><span style="color:#F8F8F2;">, </span><span style="color:#FD971F;font-style:italic;">socket</span><span style="color:#66D9EF;font-style:italic;"> =&gt;</span><span style="color:#F8F8F2;"> { </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">  console.</span><span style="color:#A6E22E;">log</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;- new websocket connection!&#39;</span><span style="color:#F8F8F2;">); </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">}); </span></span></code></pre></div><p>For now, we just log any created socket so we can easily see in the console if eveything works as expected.</p><p>Let&#39;s just restart our server so that our changes are taken into account. In the <code>Terminal</code>, press <code>Ctrl+C</code> to close the server then restart it with:</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki monokai" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#A6E22E;">node</span><span style="color:#E6DB74;"> serve</span></span></code></pre></div><h2 id="opening-a-client-websocket" tabindex="-1">Opening a client WebSocket <a class="header-anchor" href="#opening-a-client-websocket" aria-label="Permalink to “Opening a client WebSocket”">​</a></h2><p>Now that eveything is setup and running on our server side, let&#39;s create our WebSocket client to communicate with the server.</p><p>Open the <code>main.js</code> file and add the following lines of code:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki monokai has-diff" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> { html, render } </span><span style="color:#F92672;">from</span><span style="color:#E6DB74;"> &#39;https://unpkg.com/lit-html&#39;</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F92672;">import</span><span style="color:#E6DB74;"> &#39;https://unpkg.com/@ircam/sc-components@latest&#39;</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> resumeAudioContext </span><span style="color:#F92672;">from</span><span style="color:#E6DB74;"> &#39;./lib/resume-audio-context.js&#39;</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> loadAudioBuffer </span><span style="color:#F92672;">from</span><span style="color:#E6DB74;"> &#39;./lib/load-audio-buffer.js&#39;</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"></span>
<span class="line diff add"><span style="color:#88846F;">// create a WebSocket to the server</span></span>
<span class="line diff add"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> url </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> window.location.origin.</span><span style="color:#A6E22E;">replace</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;http&#39;</span><span style="color:#F8F8F2;">, </span><span style="color:#E6DB74;">&#39;ws&#39;</span><span style="color:#F8F8F2;">); </span></span>
<span class="line diff add"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> socket </span><span style="color:#F92672;">=</span><span style="color:#F92672;"> new</span><span style="color:#A6E22E;"> WebSocket</span><span style="color:#F8F8F2;">(url); </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">socket.</span><span style="color:#A6E22E;">addEventListener</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;open&#39;</span><span style="color:#F8F8F2;">, () </span><span style="color:#66D9EF;font-style:italic;">=&gt;</span><span style="color:#F8F8F2;"> { </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">  console.</span><span style="color:#A6E22E;">log</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;socket connected&#39;</span><span style="color:#F8F8F2;">); </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">}); </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">socket.</span><span style="color:#A6E22E;">addEventListener</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;error&#39;</span><span style="color:#F8F8F2;">, </span><span style="color:#FD971F;font-style:italic;">err</span><span style="color:#66D9EF;font-style:italic;"> =&gt;</span><span style="color:#F8F8F2;"> console.</span><span style="color:#A6E22E;">log</span><span style="color:#F8F8F2;">(err.message)); </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">socket.</span><span style="color:#A6E22E;">addEventListener</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;close&#39;</span><span style="color:#F8F8F2;">, () </span><span style="color:#66D9EF;font-style:italic;">=&gt;</span><span style="color:#F8F8F2;"> console.</span><span style="color:#A6E22E;">log</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;socket closed&#39;</span><span style="color:#F8F8F2;">)); </span></span></code></pre></div><p>If you reload the page, you should see the &quot;socket connected&quot; message displayed in the console:</p><p><img src="/assets/socket-connected.B92bY04h.png" alt="socket-connected"></p><h2 id="propagating-events" tabindex="-1">Propagating Events <a class="header-anchor" href="#propagating-events" aria-label="Permalink to “Propagating Events”">​</a></h2><p>Now that our communication channel is setup, let&#39;s modify sligthly the behavior of our demo app, so that when a user clicks on the bang components the sound is triggered on every connected client and not just itself.</p><p>Our data flow will thus be of the following form:</p><ol><li>When the client clicks on the <code>sc-bang</code> component, a message (e.g. &quot;trigger-input&quot;) is sent to the server</li><li>When the server receives a &quot;trigger-input&quot; message, it sends another message (e.g. &quot;trigger-output&quot;) to every connected socket</li><li>When a client receives a &quot;trigger-output&quot; message, it plays the sound file</li></ol><p><img src="/assets/data-flow.DLKi8_2j.png" alt="data-flow"></p><p>So let&#39;s start by implementing the point 1. on our client-side:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki monokai has-diff" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#88846F;">// main.js</span></span>
<span class="line"><span style="color:#A6E22E;">render</span><span style="color:#F8F8F2;">(</span><span style="color:#A6E22E;">html</span><span style="color:#E6DB74;">`</span></span>
<span class="line"><span style="color:#E6DB74;">  &lt;h1&gt;websockets-101&lt;/h1&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">  &lt;sc-bang</span></span>
<span class="line diff add"><span style="color:#E6DB74;">    @input=</span><span style="color:#F92672;">${</span><span style="color:#FD971F;font-style:italic;">e</span><span style="color:#66D9EF;font-style:italic;"> =&gt;</span><span style="color:#F8F8F2;"> socket.</span><span style="color:#A6E22E;">send</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;trigger-input&#39;</span><span style="color:#F8F8F2;">)</span><span style="color:#F92672;">}</span></span>
<span class="line diff remove"><span style="color:#E6DB74;">    @input=</span><span style="color:#F92672;">${</span><span style="color:#FD971F;font-style:italic;">e</span><span style="color:#66D9EF;font-style:italic;"> =&gt;</span><span style="color:#F8F8F2;"> { </span></span>
<span class="line diff remove"><span style="color:#66D9EF;font-style:italic;">      const</span><span style="color:#F8F8F2;"> src </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> audioContext.</span><span style="color:#A6E22E;">createBufferSource</span><span style="color:#F8F8F2;">(); </span></span>
<span class="line diff remove"><span style="color:#F8F8F2;">      src.</span><span style="color:#A6E22E;">connect</span><span style="color:#F8F8F2;">(audioContext.destination); </span></span>
<span class="line diff remove"><span style="color:#F8F8F2;">      src.buffer </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> buffer; </span></span>
<span class="line diff remove"><span style="color:#F8F8F2;">      src.</span><span style="color:#A6E22E;">start</span><span style="color:#F8F8F2;">(); </span></span>
<span class="line diff remove"><span style="color:#F8F8F2;">    }</span><span style="color:#F92672;">}</span></span>
<span class="line"><span style="color:#E6DB74;">  &gt;&lt;/sc-bang&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">`</span><span style="color:#F8F8F2;">, document.body);</span></span></code></pre></div><p>Quite easy step, we just send the message &quot;trigger-input&quot; to the server through our socket instance.</p><p>Let&#39;s now implement the step 2. on the server side:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki monokai has-diff" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#88846F;">// server.js</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> wss </span><span style="color:#F92672;">=</span><span style="color:#F92672;"> new</span><span style="color:#A6E22E;"> WebSocketServer</span><span style="color:#F8F8F2;">({ server });</span></span>
<span class="line diff add"><span style="color:#88846F;">// A store for our socket client instances</span></span>
<span class="line diff add"><span style="color:#66D9EF;font-style:italic;">let</span><span style="color:#F8F8F2;"> sockets </span><span style="color:#F92672;">=</span><span style="color:#F92672;"> new</span><span style="color:#A6E22E;"> Set</span><span style="color:#F8F8F2;">(); </span></span>
<span class="line"><span style="color:#88846F;">// listen for &quot;connection&quot; event when a new WebSocket is created</span></span>
<span class="line"><span style="color:#F8F8F2;">wss.</span><span style="color:#A6E22E;">on</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;connection&#39;</span><span style="color:#F8F8F2;">, </span><span style="color:#FD971F;font-style:italic;">socket</span><span style="color:#66D9EF;font-style:italic;"> =&gt;</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  console.</span><span style="color:#A6E22E;">log</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;- new websocket connection!&#39;</span><span style="color:#F8F8F2;">);</span></span>
<span class="line diff add"><span style="color:#88846F;">  // add socket to list</span></span>
<span class="line diff add"><span style="color:#F8F8F2;">  sockets.</span><span style="color:#A6E22E;">add</span><span style="color:#F8F8F2;">(socket); </span></span>
<span class="line diff add"><span style="color:#88846F;">  // listen for message from the socket</span></span>
<span class="line diff add"><span style="color:#F8F8F2;">  socket.</span><span style="color:#A6E22E;">addEventListener</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;message&#39;</span><span style="color:#F8F8F2;">, </span><span style="color:#FD971F;font-style:italic;">event</span><span style="color:#66D9EF;font-style:italic;"> =&gt;</span><span style="color:#F8F8F2;"> { </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">    console.</span><span style="color:#A6E22E;">log</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;message received&#39;</span><span style="color:#F8F8F2;">, event.data); </span></span>
<span class="line diff add"><span style="color:#88846F;">    // if the received message is equal to &quot;trigger-input&quot;, loop though</span></span>
<span class="line diff add"><span style="color:#88846F;">    // all the connected sockets to dispatch the &quot;trigger-output&quot; message</span></span>
<span class="line diff add"><span style="color:#F92672;">    if</span><span style="color:#F8F8F2;"> (event.data </span><span style="color:#F92672;">===</span><span style="color:#E6DB74;"> &#39;trigger-input&#39;</span><span style="color:#F8F8F2;">) { </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">      sockets.</span><span style="color:#A6E22E;">forEach</span><span style="color:#F8F8F2;">(</span><span style="color:#FD971F;font-style:italic;">socket</span><span style="color:#66D9EF;font-style:italic;"> =&gt;</span><span style="color:#F8F8F2;"> { </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">        socket.</span><span style="color:#A6E22E;">send</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;trigger-output&#39;</span><span style="color:#F8F8F2;">); </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">      }); </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">    } </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">  }); </span></span>
<span class="line diff add"><span style="color:#88846F;">  // delete socket from the list when it is closed</span></span>
<span class="line diff add"><span style="color:#F8F8F2;">  socket.</span><span style="color:#A6E22E;">addEventListener</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;close&#39;</span><span style="color:#F8F8F2;">, () </span><span style="color:#66D9EF;font-style:italic;">=&gt;</span><span style="color:#F8F8F2;"> { </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">    sockets.</span><span style="color:#A6E22E;">delete</span><span style="color:#F8F8F2;">(socket); </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">  }); </span></span>
<span class="line"><span style="color:#F8F8F2;">});</span></span></code></pre></div><p>Finally, let&#39;s go back to our client-side to make the client react to the &quot;trigger-output&quot; message:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki monokai" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#88846F;">// main.js</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> audioContext </span><span style="color:#F92672;">=</span><span style="color:#F92672;"> new</span><span style="color:#A6E22E;"> AudioContext</span><span style="color:#F8F8F2;">();</span></span>
<span class="line"><span style="color:#F92672;">await</span><span style="color:#A6E22E;"> resumeAudioContext</span><span style="color:#F8F8F2;">(audioContext);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> buffer </span><span style="color:#F92672;">=</span><span style="color:#F92672;"> await</span><span style="color:#A6E22E;"> loadAudioBuffer</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;./assets/sample.wav&#39;</span><span style="color:#F8F8F2;">, audioContext.sampleRate);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">socket.</span><span style="color:#A6E22E;">addEventListener</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;message&#39;</span><span style="color:#F8F8F2;">, </span><span style="color:#FD971F;font-style:italic;">event</span><span style="color:#66D9EF;font-style:italic;"> =&gt;</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">  const</span><span style="color:#F8F8F2;"> src </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> audioContext.</span><span style="color:#A6E22E;">createBufferSource</span><span style="color:#F8F8F2;">();</span></span>
<span class="line"><span style="color:#F8F8F2;">  src.buffer </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> buffer;</span></span>
<span class="line"><span style="color:#F8F8F2;">  src.</span><span style="color:#A6E22E;">connect</span><span style="color:#F8F8F2;">(audioContext.destination);</span></span>
<span class="line"><span style="color:#F8F8F2;">  src.</span><span style="color:#A6E22E;">start</span><span style="color:#F8F8F2;">();</span></span>
<span class="line"><span style="color:#F8F8F2;">});</span></span></code></pre></div><p>And congrats! You now have a working simple distributed application.</p><h2 id="conclusion" tabindex="-1">Conclusion <a class="header-anchor" href="#conclusion" aria-label="Permalink to “Conclusion”">​</a></h2><p>This tutorial just showed you how simple it is to use WebSocket to create a distributed application, however it also gives you an idea of the problem you might encounter when using the raw WebSocket API.</p><p>Indeed, the API is rather low-level, e.g. implies to send messages as raw strings, to route them all manually. In this application, the messages where deliberately simple, but what if we want to send some variables (e.g. some frequency values) or more complex data structure?</p><p>Another issue is that the application is completely stateless, meaning there is no history of what happened in the past which can be an issue in more complex situations: for example, you want your clients to playback a sound file all together, but one of them just connected after the event was send, what should we do in such case?</p><p><em>soundworks</em> is designed to hopefully help handle such more complex cases in simple manner.</p></div></div></main><footer class="VPDocFooter" data-v-d668f7cc data-v-1bcd8184><!--[--><!--]--><!----><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-1bcd8184><span class="visually-hidden" id="doc-footer-aria-label" data-v-1bcd8184>Pager</span><div class="pager" data-v-1bcd8184><a class="VPLink link vp-external-link-icon pager-link prev" href="https://ircam-ismm.github.io/dotpi/" target="_blank" rel="noreferrer" data-v-1bcd8184><!--[--><span class="desc" data-v-1bcd8184>Previous page</span><span class="title" data-v-1bcd8184>dotpi tools</span><!--]--></a></div><div class="pager" data-v-1bcd8184><!----></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"api.md\":\"Hy3wBnac\",\"credits.md\":\"BrA1Pzee\",\"ecosystem_ecosystem.md\":\"BA_RphpA\",\"index.md\":\"C18x0pat\",\"introduction.md\":\"1VoA1VB0\",\"misc__contributing-to-this-site.md\":\"CYeTkNSK\",\"misc__deployment.md\":\"BngYWeyB\",\"misc__local-deployment.md\":\"GnHl-ltB\",\"misc__todo_electron-applications.md\":\"CC5baAKP\",\"misc_websockets-101.md\":\"C-gXDMS3\",\"plugins_checkin.md\":\"C6RM-Tm2\",\"plugins_filesystem.md\":\"FMZlAHa5\",\"plugins_license.md\":\"BACUdzM4\",\"plugins_logger.md\":\"WkoUpJQD\",\"plugins_platform-init.md\":\"CpKNubvr\",\"plugins_position.md\":\"IHw_x8tv\",\"plugins_scripting.md\":\"BmalzbyY\",\"plugins_soundworks-helpers.md\":\"Csh1b2RR\",\"plugins_sync.md\":\"BcOxYxrv\",\"recipes_working-with-max.md\":\"B376Sw62\",\"tools_helpers.md\":\"CZZB8W_o\",\"tools_license.md\":\"BbonFmD2\",\"tutorials__connected-lamp.md\":\"BNjt-enF\",\"tutorials__context.md\":\"BjuHZuxh\",\"tutorials_getting-started.md\":\"BpaQKx_Z\",\"tutorials_node-clients.md\":\"C9rZi5xs\",\"tutorials_plugin-platform-init.md\":\"CVSQ4ZSt\",\"tutorials_plugin-sync.md\":\"BD1vtBCG\",\"tutorials_state-manager.md\":\"DL2GqnxU\",\"tutorials_step-sequencer.md\":\"CBp3A5Ak\",\"tutorials_todo-noise.md\":\"C57Po1TH\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"soundworks\",\"description\":\"Creative coding framework for distributed applications based on Web technologies\",\"base\":\"/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"logo\":\"/logo-nav.png\",\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/collective-soundworks/collective-soundworks.github.io\"}],\"search\":{\"provider\":\"local\"},\"nav\":[{\"text\":\"Guide\",\"link\":\"/tutorials/getting-started\"},{\"text\":\"soundworks API\",\"link\":\"https://soundworks.dev/soundworks\"},{\"text\":\"Credits\",\"link\":\"/credits\"}],\"sidebar\":[{\"text\":\"Introduction\",\"link\":\"/introduction\"},{\"text\":\"Tutorials\",\"items\":[{\"text\":\"Getting Started\",\"link\":\"/tutorials/getting-started\"},{\"text\":\"Using the State Manager\",\"link\":\"/tutorials/state-manager\"},{\"text\":\"Using Plugins 1 - <i>platform-init</i>\",\"link\":\"/tutorials/plugin-platform-init\"},{\"text\":\"The <i>Todo Noise</i> Application\",\"link\":\"/tutorials/todo-noise\"},{\"text\":\"Working with Node Clients\",\"link\":\"/tutorials/node-clients\"},{\"text\":\"Using Plugins 2 - <i>sync</i>\",\"link\":\"/tutorials/plugin-sync\"},{\"text\":\"Distributed Step Sequencer\",\"link\":\"/tutorials/step-sequencer\"}]},{\"text\":\"Recipes\",\"items\":[{\"text\":\"Working with Max\",\"link\":\"/recipes/working-with-max\"}]},{\"text\":\"Documentation\",\"items\":[{\"text\":\"soundworks API\",\"link\":\"https://soundworks.dev/soundworks\"},{\"text\":\"Helpers\",\"link\":\"/tools/helpers\"},{\"text\":\"Plugin Platform Init\",\"link\":\"/plugins/platform-init\"},{\"text\":\"Plugin Sync\",\"link\":\"/plugins/sync\"},{\"text\":\"Plugin Filesystem\",\"link\":\"/plugins/filesystem\"},{\"text\":\"Plugin Scripting\",\"link\":\"/plugins/scripting\"},{\"text\":\"Plugin Checkin\",\"link\":\"/plugins/checkin\"},{\"text\":\"Plugin Position\",\"link\":\"/plugins/position\"},{\"text\":\"Plugin Logger\",\"link\":\"/plugins/logger\"}]},{\"text\":\"Ecosystem\",\"items\":[{\"text\":\"node-web-audio-api\",\"link\":\"https://github.com/ircam-ismm/node-web-audio-api/\"},{\"text\":\"@ircam/sc-components\",\"link\":\"https://github.com/ircam-ismm/sc-components/\"},{\"text\":\"@ircam/sc-utils\",\"link\":\"https://github.com/ircam-ismm/sc-utils\"},{\"text\":\"@ircam/sc-scheduling\",\"link\":\"https://github.com/ircam-ismm/sc-scheduling/\"},{\"text\":\"@ircam/devicemotion\",\"link\":\"https://github.com/ircam-ismm/devicemotion\"},{\"text\":\"dotpi tools\",\"link\":\"https://ircam-ismm.github.io/dotpi/\"}]},{\"text\":\"Misc\",\"items\":[{\"text\":\"WebSockets 101\",\"link\":\"/misc/websockets-101\"}]}]},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false,\"additionalConfig\":{}}");</script>
    
  </body>
</html>