import{_ as s,o as a,c as e,V as n}from"./chunks/framework.7cbf217e.js";const l="/assets/distributed-application.ec63aa91.png",t="/assets/distributed-state-management.d09470bb.png",o="/assets/globals-server-log.38f03e6b.png",p="/assets/globals-client-log.a184f944.png",c="/assets/states-in-html.cfd64b16.png",r="/assets/create-controller-wizard.afe39dba.png",i="/assets/install-sc-components-1.edf96a4e.png",F="/assets/controller-1.8ae726c4.png",h="/assets/controller-2.a1db85de.png",y="/assets/controller-and-clients-1.db58d76e.png",d="/assets/controller-and-clients-2.51311d63.png",g="/assets/badly-defined-players.f2ea5e37.png",u="/assets/controller-player-final.ffc32479.png",j=JSON.parse('{"title":"Using the State Manager","description":"","frontmatter":{},"headers":[],"relativePath":"tutorials/state-manager.md","filePath":"tutorials/state-manager.md"}'),m={name:"tutorials/state-manager.md"},f=n('<h1 id="using-the-state-manager" tabindex="-1">Using the State Manager <a class="header-anchor" href="#using-the-state-manager" aria-label="Permalink to &quot;Using the State Manager&quot;">​</a></h1><p>In this tutorial, we will dig into the distributed state management system proposed by <em>soundworks</em>. After a short introduction on the concepts behind, we will see how to use shared states, and how this pattern can help you to implement remote control and monitoring in your applications. Along the way, we will see how the shared states simplify the development of distributed applications by abstracting the network communications and messages routing.</p><p>Along the way, we will discover a related library called <code>@ircam/simple-components</code> to simply create usable (and hopefully elegant) graphical user interfaces.</p><h3 id="relevant-api-documentation" tabindex="-1">Relevant API documentation <a class="header-anchor" href="#relevant-api-documentation" aria-label="Permalink to &quot;Relevant API documentation&quot;">​</a></h3><ul><li><a href="https://soundworks.dev/soundworks/client.StateManager" target="_blank" rel="noreferrer">client.StateManager</a></li><li><a href="https://soundworks.dev/soundworks/client.SharedState" target="_blank" rel="noreferrer">client.SharedState</a></li><li><a href="https://soundworks.dev/soundworks/server.StateManager" target="_blank" rel="noreferrer">server.StateManager</a></li><li><a href="https://soundworks.dev/soundworks/server.SharedState" target="_blank" rel="noreferrer">server.SharedState</a></li><li><a href="https://ircam-ismm.github.io/simple-components/" target="_blank" rel="noreferrer">@ircam/simple-components</a></li></ul><h2 id="introduction" tabindex="-1">Introduction <a class="header-anchor" href="#introduction" aria-label="Permalink to &quot;Introduction&quot;">​</a></h2><p>First of all, let&#39;s start with a bit of theory to understand the concepts and general logic behind the <em>soundworks</em>&#39; shared states.</p><h3 id="the-why" tabindex="-1">The &quot;Why&quot; <a class="header-anchor" href="#the-why" aria-label="Permalink to &quot;The &quot;Why&quot;&quot;">​</a></h3><p>Most of the time, we think of an application as &quot;something&quot; that runs on a computer with which a user can interact in some way. The idea of <em>distributed application</em> extends this to applications that run on several computers and where several users can interact at the same time. Or to say it in a more formal way:</p><blockquote><p><em>« A distributed system is a collection of autonomous computing elements that appears to its users as a single coherent system. »</em> Maarten van Steen, and Andrew S. Tanenbaum. “A Brief Introduction to Distributed Systems.” Computing 98, no. 10, October 2016.</p></blockquote><p><img src="'+l+'" alt="distributed-application"></p><p>Additionally, in creative contexts, it&#39;s important to have very simple ways to monitor and/or control the state of distant clients. This is true both during the development of the artwork / application, e.g. to tweak some synthesizer on distant machines from a central point (even in the studio, modifying some parameters on several machines can get cumbersome quite quickly), as well as during a performance, e.g. to control the general volume, to switch between two sections of the experience, etc.</p><p>The <code>SharedManager</code> and the <code>SharedState</code> abstractions proposed by <em>soundworks</em> provide a simple way to define and synchronize some sets of parameters (that are of interest by multiple clients) while abstracting all the network communications involved.</p><h3 id="the-how" tabindex="-1">The &quot;How&quot; <a class="header-anchor" href="#the-how" aria-label="Permalink to &quot;The &quot;How&quot;&quot;">​</a></h3><p>From a more technical point of view, the distributed state management system proposed by <em>soundworks</em> circular dataflow pattern (loosely inspired by the <a href="https://facebook.github.io/flux/docs/in-depth-overview" target="_blank" rel="noreferrer"><em>flux</em></a> pattern proposed by <em>Facebook</em>) adapted to the particular needs of real-time distributed applications.</p><p>To this end the dataflow follows a circular path that is always synchronized with the server. For illustrate the, we can see in the graph below that when an input (e.g. some user gesture) triggers a change in the state of a client (arrow 1, red), the data is automatically synchronized with a server-side representation of the state through WebSockets (arrow 2), which when done triggers the change in the rendering (be it audio or visual).</p><p>This simple pattern enables an important feature: any other node can make a change on the same server-side representation of the state (arrow 1&#39;, blue), while triggering 2 and 3 in a completely transparent way.</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>In this tutorial, when we speak of a <em>node</em> of the network, we consider both the clients and the server.</p><p>Form the point of view of the distributed state management system, the server is indeed a <em>node</em> just as any client. However, its central role gives it particular abilities and features.</p></div><p><img src="'+t+`" alt="distributed-application"></p><h2 id="declaring-schemas" tabindex="-1">Declaring schemas <a class="header-anchor" href="#declaring-schemas" aria-label="Permalink to &quot;Declaring schemas&quot;">​</a></h2><p>The <code>StateManager</code> component uses &quot;<em>schemas</em>&quot; that declare a set of attributes and their properties (you can think of it has the schema of a database table). A <em>schema</em> is a kind of blueprint for a shared state, as such, any number of <code>SharedState</code> instances can be created from the same schema.</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>The schema syntax follows the format described <a href="https://soundworks.dev/soundworks/server.StateManager#~schema" target="_blank" rel="noreferrer">here</a>.</p></div><p>First thing first, let&#39;s generate a new empty application with the <code>@soundworks/create</code> wizard. When the wizard will ask you for the name of the default client, just call it <code>player</code> (with the <code>browser</code> target and the <code>default</code> template) so that the rest of the tutorial will be more simple to follow:</p><div class="info custom-block"><p class="custom-block-title">INFO</p><p>If needed, refer to the <a href="/tutorials/getting-started.html">getting-started</a> page to learn more on how to run the wizard</p></div><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki monokai"><code><span class="line"><span style="color:#66D9EF;">cd</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">/path/to/working/directory</span></span>
<span class="line"><span style="color:#A6E22E;">npx</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">@soundworks/create@latest</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">state-manager</span></span></code></pre></div><p>In this application we will declare two different schemas:</p><ul><li>A schema we will call <code>globals</code>, meant to create a shared state that will be unique across the whole application. This shared state will be created by the server and every clients of the application will attach to it.</li><li>A schema we will call <code>player</code>, meant to describe the state of a single client of the application. All clients with the role <code>player</code> will create their own <code>SharedState</code> instance from this scheme.</li></ul><p>So first, let&#39;s create the file <code>src/server/schemas/globals.js</code> containing the following code:</p><div class="info custom-block"><p class="custom-block-title">INFO</p><p>Note that the <code>src/server/schemas</code> directory included in the application template is empty and not mandatory (i.e. schema declarations could potentially live anywhere in your code). It is just proposed as a way to keep things organized.</p></div><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki monokai"><code><span class="line"><span style="color:#88846F;">// src/server/schemas/globals.js</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">default</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#88846F;">// volume volume in dB [-60, 6]</span></span>
<span class="line"><span style="color:#F8F8F2;">  volume: {</span></span>
<span class="line"><span style="color:#F8F8F2;">    type: </span><span style="color:#E6DB74;">&#39;float&#39;</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#F8F8F2;">    min: </span><span style="color:#F92672;">-</span><span style="color:#AE81FF;">60</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#F8F8F2;">    max: </span><span style="color:#AE81FF;">6</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#F8F8F2;">    default: </span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#F8F8F2;">  },</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#88846F;">// mute [true, false]</span></span>
<span class="line"><span style="color:#F8F8F2;">  mute: {</span></span>
<span class="line"><span style="color:#F8F8F2;">    type: </span><span style="color:#E6DB74;">&#39;boolean&#39;</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#F8F8F2;">    default: </span><span style="color:#AE81FF;">false</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#F8F8F2;">  },</span></span>
<span class="line"><span style="color:#F8F8F2;">};</span></span></code></pre></div><p>While the code is quite self-explanatory, we can see that this schema will allow us to control the <em>volume</em> of all clients as well as to <em>mute/unmute</em> them.</p><p>Second, let&#39;s create the file <code>src/server/schemas/players.js</code> containing the following code:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki monokai"><code><span class="line"><span style="color:#88846F;">// src/server/schemas/player.js</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">default</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  frequency: {</span></span>
<span class="line"><span style="color:#F8F8F2;">    type: </span><span style="color:#E6DB74;">&#39;float&#39;</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#F8F8F2;">    min: </span><span style="color:#AE81FF;">50</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#F8F8F2;">    max: </span><span style="color:#AE81FF;">1000</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#F8F8F2;">    default: </span><span style="color:#AE81FF;">440</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#F8F8F2;">  },</span></span>
<span class="line"><span style="color:#F8F8F2;">};</span></span></code></pre></div><p>This schema will allow us to control the <em>frequency</em> of an oscillator on each client.</p><p>From these two definitions, we can already foresee the structure of the audio graph that could be created by each client:</p><blockquote><p><code>[OscillatorNode] -&gt; [GainNode (mute)] -&gt; [GainNode (volume)] -&gt; [destination]</code></p></blockquote><ul><li>The <code>OscillatorNode</code> will be controlled by the states created from the <code>player</code> schema, each client being able to have different oscillator <em>frequency</em> values.</li><li>At contrary, the <code>GainNode</code>s (<em>mute</em> and <em>volume</em>) will be controlled globally for all clients by the common state created from <code>globals</code> schema.</li></ul><div class="info custom-block"><p class="custom-block-title">INFO</p><p>Note that to keep things focused on the distributed state management system, we won&#39;t actually create the audio graph in this tutorial.</p></div><h2 id="registering-schemas" tabindex="-1">Registering schemas <a class="header-anchor" href="#registering-schemas" aria-label="Permalink to &quot;Registering schemas&quot;">​</a></h2><p>Let&#39;s first import the schemas declarations into the <code>src/server/index.js</code> file:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki monokai has-highlighted-lines"><code><span class="line"><span style="color:#88846F;">// src/server/index.js</span></span>
<span class="line"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> { loadConfig } </span><span style="color:#F92672;">from</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;../utils/load-config.js&#39;</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;../utils/catch-unhandled-errors.js&#39;</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"></span>
<span class="line highlighted"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> globalsSchema </span><span style="color:#F92672;">from</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;./schemas/globals.js&#39;</span><span style="color:#F8F8F2;">;</span></span>
<span class="line highlighted"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> playerSchema </span><span style="color:#F92672;">from</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;./schemas/player.js&#39;</span><span style="color:#F8F8F2;">;</span></span></code></pre></div><p>Once done, we can register them into the <code>stateManager</code> instance of the <em>soundworks</em> <code>server</code>:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki monokai has-highlighted-lines"><code><span class="line"><span style="color:#88846F;">// src/server/index.js</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> server </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">new</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">Server</span><span style="color:#F8F8F2;">(config);</span></span>
<span class="line"><span style="color:#88846F;">// configure the server for usage within this application template</span></span>
<span class="line"><span style="color:#F8F8F2;">server.</span><span style="color:#A6E22E;">useDefaultApplicationTemplate</span><span style="color:#F8F8F2;">();</span></span>
<span class="line"></span>
<span class="line highlighted"><span style="color:#88846F;">// register the schemas</span></span>
<span class="line highlighted"><span style="color:#F8F8F2;">server.stateManager.</span><span style="color:#A6E22E;">registerSchema</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;globals&#39;</span><span style="color:#F8F8F2;">, globalsSchema);</span></span>
<span class="line highlighted"><span style="color:#F8F8F2;">server.stateManager.</span><span style="color:#A6E22E;">registerSchema</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;player&#39;</span><span style="color:#F8F8F2;">, playerSchema);</span></span></code></pre></div><p>Note that the <code>stateManager.registerSchema</code> method takes 2 arguments:</p><ul><li>A <em>user defined</em> name, here <code>&#39;globals&#39;</code> and <code>&#39;player&#39;</code>.</li><li>A schema definition, here <code>globalsSchema</code> and <code>playerSchema</code>.</li></ul><p>This signature allows to define simple user-friendly names for creating and attaching shared state, but also to register the same schema under different names.</p><p>Now that our schemas are registered into the <code>server.stateManager</code>, we safely can create new instances of <code>SharedState</code>s based on these schemas.</p><h2 id="create-and-attach-shared-states" tabindex="-1">Create and attach shared states <a class="header-anchor" href="#create-and-attach-shared-states" aria-label="Permalink to &quot;Create and attach shared states&quot;">​</a></h2><p>Let&#39;s first create our <code>globals</code> shared state based on the schema declaration we defined in <code>src/server/schemas/globals.js</code>. As explained above, we want this shared state to be unique across the entire application so that all clients share the same values. This is achieved by <em>creating</em> the state on the server-side (i.e. the server is thus the <em>owner</em> of the state), and by <em>attaching</em> all clients to this state (i.e. they have full access to the shared state values but do not own it).</p><p>While this distinction between <code>create</code> and <code>attach</code> can be a bit confusing at first this will get more clear writing the code. So, add following line into the <code>src/server/index.js</code> to create the <code>globals</code> shared state:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki monokai has-highlighted-lines"><code><span class="line"><span style="color:#88846F;">// src/server/index.js</span></span>
<span class="line"><span style="color:#F92672;">await</span><span style="color:#F8F8F2;"> server.</span><span style="color:#A6E22E;">start</span><span style="color:#F8F8F2;">();</span></span>
<span class="line"></span>
<span class="line highlighted"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> globals </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">await</span><span style="color:#F8F8F2;"> server.stateManager.</span><span style="color:#A6E22E;">create</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;globals&#39;</span><span style="color:#F8F8F2;">);</span></span>
<span class="line highlighted"><span style="color:#F8F8F2;">console.</span><span style="color:#A6E22E;">log</span><span style="color:#F8F8F2;">(globals.</span><span style="color:#A6E22E;">getValues</span><span style="color:#F8F8F2;">());</span></span></code></pre></div><p>Here, we create a new <code>SharedState</code> instance from the schema we just registered with the name <code>&#39;globals&#39;</code>. You should also see the default values of the state displayed in you Terminal window:</p><p><img src="`+o+`" alt="globals-server-log"></p><p>Let &#39;s now <em>attach</em> all our <code>player</code> clients to the <code>globals</code> state created by the server.</p><p>To that end, open the file <code>src/clients/player/index.js</code> and add the following lines of code:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki monokai has-highlighted-lines"><code><span class="line"><span style="color:#88846F;">// src/clients/player/index.js</span></span>
<span class="line"><span style="color:#F92672;">await</span><span style="color:#F8F8F2;"> client.</span><span style="color:#A6E22E;">start</span><span style="color:#F8F8F2;">();</span></span>
<span class="line"></span>
<span class="line highlighted"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> globals </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">await</span><span style="color:#F8F8F2;"> client.stateManager.</span><span style="color:#A6E22E;">attach</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;globals&#39;</span><span style="color:#F8F8F2;">);</span></span>
<span class="line highlighted"><span style="color:#F8F8F2;">console.</span><span style="color:#A6E22E;">log</span><span style="color:#F8F8F2;">(globals.</span><span style="color:#A6E22E;">getValues</span><span style="color:#F8F8F2;">());</span></span></code></pre></div><p>Open the URL <a href="http://127.0.0.0:8000" target="_blank" rel="noreferrer">http://127.0.0.0:8000</a> in your browser of choice and open the JavaScript console. As for the server, you should see the current values of the state displayed in the console:</p><p><img src="`+p+`" alt="globals-client-log"></p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>To open the <em>JavaScript</em> console in your browser, you can press <code>Cmd + Alt + J</code> in <em>Chrome</em> or alternatively <code>Cmd + Alt + I</code> in <em>Firefox</em>, then select the <code>Console</code> tab.</p></div><p>While we are on the client-side <code>player</code> code, let&#39;s create the <code>player</code> shared state for each client. To that end, add the following line of code in the <code>src/clients/player/index.js</code> file:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki monokai has-highlighted-lines"><code><span class="line"><span style="color:#88846F;">// src/clients/player/index.js</span></span>
<span class="line"><span style="color:#F92672;">await</span><span style="color:#F8F8F2;"> client.</span><span style="color:#A6E22E;">start</span><span style="color:#F8F8F2;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> globals </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">await</span><span style="color:#F8F8F2;"> client.stateManager.</span><span style="color:#A6E22E;">attach</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;globals&#39;</span><span style="color:#F8F8F2;">);</span></span>
<span class="line highlighted"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> player </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">await</span><span style="color:#F8F8F2;"> client.stateManager.</span><span style="color:#A6E22E;">create</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;player&#39;</span><span style="color:#F8F8F2;">);</span></span></code></pre></div><p>Here, you can see side-by-side the <code>stateManager.create</code> and <code>stateManager.attach</code> methods and how they relate:</p><ul><li><code>stateManager.create</code> creates a new instance of a shared state that is owned by the node (clients or server).</li><li><code>stateManager.attach</code> attach to an existing shared state instance created (and thus owned) by another node.</li></ul><h2 id="display-the-states-values" tabindex="-1">Display the states values <a class="header-anchor" href="#display-the-states-values" aria-label="Permalink to &quot;Display the states values&quot;">​</a></h2><p>Now that our shared states are setup, let&#39;s continue on our client-side code to display the current values of the different shared states and update the screen when their values change. To that end, we will use the <a href="https://lit.dev/" target="_blank" rel="noreferrer"><code>lit</code></a> library proposed by <em>Google</em> and the <code>$layout</code> object created for us by the soundworks wizard.</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>The <code>$layout</code> included in the template is a convenience object proposed as a starting point for building interfaces. It is built on top of on the <a href="https://lit.dev/" target="_blank" rel="noreferrer">lit</a> library and its source code is located in <code>src/clients/player/views/layout.js</code>. By no means <em>soundworks</em> requires the use of this abstraction, feel free to remove it if you prefer using something else.</p></div><p>So, let&#39;s first import the <code>lit</code> library.</p><div class="info custom-block"><p class="custom-block-title">INFO</p><p>The <code>lit</code> library is installed as a dependency of the application by default. It can thus be used without any installation step.</p></div><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki monokai has-highlighted-lines"><code><span class="line"><span style="color:#88846F;">// src/clients/player.js</span></span>
<span class="line"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> { Client } </span><span style="color:#F92672;">from</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;@soundworks/core/client.js&#39;</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> launcher </span><span style="color:#F92672;">from</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;@soundworks/helpers/launcher.js&#39;</span><span style="color:#F8F8F2;">;</span></span>
<span class="line highlighted"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> { html } </span><span style="color:#F92672;">from</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;lit&#39;</span><span style="color:#F8F8F2;">;</span></span></code></pre></div><p>Then let&#39;s create a simple component that displays the values of our two states. The <code>$layout</code> waits for objects that implements a <code>render</code> method, which make it compatible with more advanced Web Components as formalized by <code>lit</code>. But to keep things more simple, let&#39;s just create a simple object with a <code>render</code> method that returns a piece of HTML:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki monokai has-highlighted-lines"><code><span class="line"><span style="color:#88846F;">// src/clients/player.js</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> $layout </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">createLayout</span><span style="color:#F8F8F2;">(client, $container);</span></span>
<span class="line"></span>
<span class="line highlighted"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> component </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line highlighted"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">render</span><span style="color:#F8F8F2;">: () </span><span style="color:#66D9EF;font-style:italic;">=&gt;</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line highlighted"><span style="color:#F8F8F2;">    </span><span style="color:#F92672;">return</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">html</span><span style="color:#E6DB74;">\`</span></span>
<span class="line highlighted"><span style="color:#E6DB74;">      &lt;h2&gt;Globals&lt;/h2&gt;</span></span>
<span class="line highlighted"><span style="color:#E6DB74;">      &lt;ul&gt;</span></span>
<span class="line highlighted"><span style="color:#E6DB74;">        &lt;li&gt;volume: </span><span style="color:#F92672;">\${</span><span style="color:#F8F8F2;">globals.</span><span style="color:#A6E22E;">get</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;volume&#39;</span><span style="color:#F8F8F2;">)</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;">&lt;/li&gt;</span></span>
<span class="line highlighted"><span style="color:#E6DB74;">        &lt;li&gt;mute: </span><span style="color:#F92672;">\${</span><span style="color:#F8F8F2;">globals.</span><span style="color:#A6E22E;">get</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;mute&#39;</span><span style="color:#F8F8F2;">)</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;">&lt;/li&gt;</span></span>
<span class="line highlighted"><span style="color:#E6DB74;">      &lt;/ul&gt;</span></span>
<span class="line highlighted"><span style="color:#E6DB74;">      &lt;h2&gt;Player&lt;/h2&gt;</span></span>
<span class="line highlighted"><span style="color:#E6DB74;">      &lt;ul&gt;</span></span>
<span class="line highlighted"><span style="color:#E6DB74;">        &lt;li&gt;frequency: </span><span style="color:#F92672;">\${</span><span style="color:#F8F8F2;">player.</span><span style="color:#A6E22E;">get</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;frequency&#39;</span><span style="color:#F8F8F2;">)</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;">&lt;/li&gt;</span></span>
<span class="line highlighted"><span style="color:#E6DB74;">      &lt;/ul&gt;</span></span>
<span class="line highlighted"><span style="color:#E6DB74;">    \`</span><span style="color:#F8F8F2;">;</span></span>
<span class="line highlighted"><span style="color:#F8F8F2;">  }</span></span>
<span class="line highlighted"><span style="color:#F8F8F2;">};</span></span>
<span class="line highlighted"><span style="color:#88846F;">// add the component to the layout</span></span>
<span class="line highlighted"><span style="color:#F8F8F2;">$layout.</span><span style="color:#A6E22E;">addComponent</span><span style="color:#F8F8F2;">(component);</span></span></code></pre></div><p>You can see how we add the component to the <code>$layout</code> object in the last line of the snippet above. If you are curious, the full code of the layout, which is quite simple, is located the file <code>src/client/player/views/layout.js</code>.</p><p>If you refresh your web page (<code>Cmd + Shift + R</code>), you should now see the following:</p><p><img src="`+c+'" alt="states-in-html"></p><p>So far so good, we have all our states set up and some display of their values (it&#39;s only graphical and we won&#39;t go into the audio in this tutorial to keep things on shared states, but the general idea would be the same with audio display).</p><p>However, what we miss is a way to change the values of the states. We could implement it directly in our <code>player</code> clients, but we will go a bit deeper and create a new client dedicated to this task.</p><h2 id="remote-control-and-monitoring" tabindex="-1">Remote control and monitoring <a class="header-anchor" href="#remote-control-and-monitoring" aria-label="Permalink to &quot;Remote control and monitoring&quot;">​</a></h2><p>In this section we will create a new client, that we will call <code>controller</code>, dedicated to control and monitor the general of the application. So first, let&#39;s create a new client using the soundworks wizard. To this end, go to the Terminal, shutdown the server (<code>Ctrl + C</code>) and enter the following command:</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki monokai"><code><span class="line"><span style="color:#A6E22E;">npx</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">soundworks</span><span style="color:#F8F8F2;"> </span><span style="color:#AE81FF;">--create-client</span></span></code></pre></div><p>Just as when you created the application at the beginning of the tutorial, the command will ask some questions to configure the client. Let&#39;s call our new client <code>controller</code>, choose the <code>browser</code> target, but this time choose the <code>controller</code> template. Additionnally, the wizard will ask you if you want to use this client as the default one (meaning it will be accessible at the root of your website), choose <code>no</code> and confirm.</p><p><img src="'+r+'" alt="create-controller-wizard"></p><p>In your editor you will see a new directory: <code>src/clients/controller</code>. This is where we will implement the logic for our controller. But first, let&#39;s also install a libray to help us creating the interface. In your Terminal, type the following command:</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki monokai"><code><span class="line"><span style="color:#A6E22E;">npx</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">soundworks</span><span style="color:#F8F8F2;"> </span><span style="color:#AE81FF;">--install-libs</span></span></code></pre></div><p>Select the <code>@ircam/simple-components</code> using the space bar, then press <code>Enter</code> and confirm:</p><p><img src="'+i+`" alt="install-sc-components-1"></p><p>The documentation of the <code>@ircam/simple-components</code> library can be found <a href="https://ircam-ismm.github.io/simple-components/" target="_blank" rel="noreferrer">there</a>.</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>Note that the step above a equivalent to running <code>npm install --save @ircam/simple-components</code>. The wizard is just here to help you find some curated libraries we develop and we know work well with <code>soundworks</code>.</p></div><p>Now that all things are set up, we can go back to the implementation of our <code>controller</code> client. So let&#39;s restart our development server:</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki monokai"><code><span class="line"><span style="color:#F8F8F2;">npm run dev</span></span></code></pre></div><p>and open the page <a href="http://127.0.0.1:8000/controller" target="_blank" rel="noreferrer">http://127.0.0.1:8000/controller</a></p><div class="info custom-block"><p class="custom-block-title">INFO</p><p>Note that the <code>/controller</code> part of the URL, we call a &quot;route&quot;, is automatically created by soundworks according to the names of the clients.</p></div><h3 id="binding-the-globals-state" tabindex="-1">Binding the <code>globals</code> state <a class="header-anchor" href="#binding-the-globals-state" aria-label="Permalink to &quot;Binding the \`globals\` state&quot;">​</a></h3><p>Let&#39;s start with creating the controls for the <code>globals</code> shared state. Open the <code>src/clients/controller/index.js</code> file and add the following code to import some parts the library we just installed:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki monokai has-highlighted-lines"><code><span class="line"><span style="color:#88846F;">// src/clients/controller/index.js</span></span>
<span class="line"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> launcher </span><span style="color:#F92672;">from</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;@soundworks/helpers/launcher.js&#39;</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"></span>
<span class="line highlighted"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> { html } </span><span style="color:#F92672;">from</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;lit&#39;</span><span style="color:#F8F8F2;">;</span></span>
<span class="line highlighted"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;@ircam/simple-components/sc-number.js&#39;</span><span style="color:#F8F8F2;">;</span></span>
<span class="line highlighted"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;@ircam/simple-components/sc-slider.js&#39;</span><span style="color:#F8F8F2;">;</span></span>
<span class="line highlighted"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;@ircam/simple-components/sc-text.js&#39;</span><span style="color:#F8F8F2;">;</span></span>
<span class="line highlighted"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;@ircam/simple-components/sc-toggle.js&#39;</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> createLayout </span><span style="color:#F92672;">from</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;./views/layout.js&#39;</span><span style="color:#F8F8F2;">;</span></span></code></pre></div><p>Importing these files, will register new Web Components that we can to use in our HTML templates: a text element to display parameter names, a slider to control the volume, a toggle button to control the mute parameter, and a number box to control the players&#39; frequencies.</p><div class="info custom-block"><p class="custom-block-title">INFO</p><p>See <a href="https://developer.mozilla.org/en-US/docs/Web/Web_Components" target="_blank" rel="noreferrer">https://developer.mozilla.org/en-US/docs/Web/Web_Components</a> for more information on Web Components.</p></div><p>Then, such as for the <code>player</code>, let&#39;s attach to the globals state and create a component that displays its values:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki monokai has-highlighted-lines"><code><span class="line"><span style="color:#88846F;">// src/clients/controller/index.js</span></span>
<span class="line"><span style="color:#F92672;">await</span><span style="color:#F8F8F2;"> client.</span><span style="color:#A6E22E;">start</span><span style="color:#F8F8F2;">();</span></span>
<span class="line"></span>
<span class="line highlighted"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> globals </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">await</span><span style="color:#F8F8F2;"> client.stateManager.</span><span style="color:#A6E22E;">attach</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;globals&#39;</span><span style="color:#F8F8F2;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> $layout </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">createLayout</span><span style="color:#F8F8F2;">(client, $container);</span></span>
<span class="line"></span>
<span class="line highlighted"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> globalsComponent </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line highlighted"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">render</span><span style="color:#F8F8F2;">() {</span></span>
<span class="line highlighted"><span style="color:#F8F8F2;">    </span><span style="color:#F92672;">return</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">html</span><span style="color:#E6DB74;">\`</span></span>
<span class="line highlighted"><span style="color:#E6DB74;">      &lt;div&gt;</span></span>
<span class="line highlighted"><span style="color:#E6DB74;">        &lt;h2&gt;Globals&lt;/h2&gt;</span></span>
<span class="line highlighted"><span style="color:#E6DB74;">        &lt;div style=&quot;padding-bottom: 4px;&quot;&gt;</span></span>
<span class="line highlighted"><span style="color:#E6DB74;">          &lt;sc-text readonly value=&quot;volume (dB)&quot;&gt;&lt;/sc-text&gt;</span></span>
<span class="line highlighted"><span style="color:#E6DB74;">          &lt;sc-slider</span></span>
<span class="line highlighted"><span style="color:#E6DB74;">            min=&quot;-60&quot;</span></span>
<span class="line highlighted"><span style="color:#E6DB74;">            max=&quot;6&quot;</span></span>
<span class="line highlighted"><span style="color:#E6DB74;">            value=&quot;</span><span style="color:#F92672;">\${</span><span style="color:#F8F8F2;">globals.</span><span style="color:#A6E22E;">get</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;volume&#39;</span><span style="color:#F8F8F2;">)</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;">&quot;</span></span>
<span class="line highlighted"><span style="color:#E6DB74;">          &gt;&lt;/sc-slider&gt;</span></span>
<span class="line highlighted"><span style="color:#E6DB74;">        &lt;/div&gt;</span></span>
<span class="line highlighted"><span style="color:#E6DB74;">        &lt;div style=&quot;padding-bottom: 4px;&quot;&gt;</span></span>
<span class="line highlighted"><span style="color:#E6DB74;">          &lt;sc-text readonly value=&quot;mute&quot;&gt;&lt;/sc-text&gt;</span></span>
<span class="line highlighted"><span style="color:#E6DB74;">          &lt;sc-toggle</span></span>
<span class="line highlighted"><span style="color:#E6DB74;">            ?active=&quot;</span><span style="color:#F92672;">\${</span><span style="color:#F8F8F2;">globals.</span><span style="color:#A6E22E;">get</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;mute&#39;</span><span style="color:#F8F8F2;">)</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;">&quot;</span></span>
<span class="line highlighted"><span style="color:#E6DB74;">          &gt;&lt;/sc-toggle&gt;</span></span>
<span class="line highlighted"><span style="color:#E6DB74;">        &lt;/div&gt;</span></span>
<span class="line highlighted"><span style="color:#E6DB74;">      &lt;/div&gt;</span></span>
<span class="line highlighted"><span style="color:#E6DB74;">    \`</span><span style="color:#F8F8F2;">;</span></span>
<span class="line highlighted"><span style="color:#F8F8F2;">  },</span></span>
<span class="line highlighted"><span style="color:#F8F8F2;">};</span></span>
<span class="line highlighted"><span style="color:#88846F;">// add the component to the layout</span></span>
<span class="line highlighted"><span style="color:#F8F8F2;">$layout.</span><span style="color:#A6E22E;">addComponent</span><span style="color:#F8F8F2;">(globalsComponent);</span></span></code></pre></div><p>The HTML code is a bit more verbose than what we did in the <code>player</code> client, but the interface is more complex too. If you refresh your <code>controller</code> page, you should see the following interface with the <code>globals</code> default values correctly displayed:</p><p><img src="`+F+`" alt="controller-1"></p><p>However, the binding between the state and the interface is not done: interacting the interface (e.g. moving the slider or clicking the toggle) does not update the shared state values, and updates of the shared state values do not trigger updates of the interface. To do that, we simply need to add the following lines of code:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki monokai has-highlighted-lines"><code><span class="line"><span style="color:#88846F;">// src/clients/controller/index.js</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> $layout </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">createLayout</span><span style="color:#F8F8F2;">(client, $container);</span></span>
<span class="line"></span>
<span class="line highlighted"><span style="color:#88846F;">// update interface when the shared state values are updated</span></span>
<span class="line highlighted"><span style="color:#F8F8F2;">globals.</span><span style="color:#A6E22E;">onUpdate</span><span style="color:#F8F8F2;">(() </span><span style="color:#66D9EF;font-style:italic;">=&gt;</span><span style="color:#F8F8F2;"> $layout.</span><span style="color:#A6E22E;">requestUpdate</span><span style="color:#F8F8F2;">());</span></span>
<span class="line"></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> globalsComponent </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">render</span><span style="color:#F8F8F2;">() {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#F92672;">return</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">html</span><span style="color:#E6DB74;">\`</span></span>
<span class="line"><span style="color:#E6DB74;">      &lt;div&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">        &lt;h2&gt;Globals&lt;/h2&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">        &lt;div style=&quot;padding-bottom: 4px;&quot;&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">          &lt;sc-text readonly value=&quot;volume (dB)&quot;&gt;&lt;/sc-text&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">          &lt;sc-slider</span></span>
<span class="line"><span style="color:#E6DB74;">            min=&quot;-60&quot;</span></span>
<span class="line"><span style="color:#E6DB74;">            max=&quot;6&quot;</span></span>
<span class="line"><span style="color:#E6DB74;">            value=&quot;</span><span style="color:#F92672;">\${</span><span style="color:#F8F8F2;">globals.</span><span style="color:#A6E22E;">get</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;volume&#39;</span><span style="color:#F8F8F2;">)</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;">&quot;</span></span>
<span class="line highlighted"><span style="color:#E6DB74;">            @input=</span><span style="color:#F92672;">\${</span><span style="color:#FD971F;font-style:italic;">e</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">=&gt;</span><span style="color:#F8F8F2;"> globals.</span><span style="color:#A6E22E;">set</span><span style="color:#F8F8F2;">({ volume: e.detail.value })</span><span style="color:#F92672;">}</span></span>
<span class="line"><span style="color:#E6DB74;">          &gt;&lt;/sc-slider&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">        &lt;/div&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">        &lt;div style=&quot;padding-bottom: 4px;&quot;&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">          &lt;sc-text readonly value=&quot;mute&quot;&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">          &gt;&lt;/sc-text&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">          &lt;sc-toggle</span></span>
<span class="line"><span style="color:#E6DB74;">            ?active=&quot;</span><span style="color:#F92672;">\${</span><span style="color:#F8F8F2;">globals.</span><span style="color:#A6E22E;">get</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;mute&#39;</span><span style="color:#F8F8F2;">)</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;">&quot;</span></span>
<span class="line highlighted"><span style="color:#E6DB74;">            @change=</span><span style="color:#F92672;">\${</span><span style="color:#FD971F;font-style:italic;">e</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">=&gt;</span><span style="color:#F8F8F2;"> globals.</span><span style="color:#A6E22E;">set</span><span style="color:#F8F8F2;">({ mute: e.detail.value })</span><span style="color:#F92672;">}</span></span>
<span class="line"><span style="color:#E6DB74;">          &gt;&lt;/sc-toggle&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">        &lt;/div&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">      &lt;/div&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">    \`</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F8F8F2;">  },</span></span>
<span class="line"><span style="color:#F8F8F2;">};</span></span></code></pre></div><p>Now, if you open <a href="http://127.0.0.1:8000/controller?emulate=2" target="_blank" rel="noreferrer">http://127.0.0.1:8000/controller?emulate=2</a> to emulate two <code>controller</code> clients side by side, you should see that both interfaces are kept synchronized through the <code>globals</code> shared state.</p><p><img src="`+h+`" alt="controller-2"></p><p>Finally, let&#39;s go back to our <code>player</code> clients to implement the update of the screen when the shared states are updated. So let&#39;s re-open the <code>src/clients/player/index.js</code> file and add the following lines of code:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki monokai has-highlighted-lines"><code><span class="line"><span style="color:#88846F;">// src/clients/player/index.js</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> $layout </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">createLayout</span><span style="color:#F8F8F2;">(client, $container);</span></span>
<span class="line"></span>
<span class="line highlighted"><span style="color:#88846F;">// update layout when the states are updated</span></span>
<span class="line highlighted"><span style="color:#F8F8F2;">globals.</span><span style="color:#A6E22E;">onUpdate</span><span style="color:#F8F8F2;">(() </span><span style="color:#66D9EF;font-style:italic;">=&gt;</span><span style="color:#F8F8F2;"> $layout.</span><span style="color:#A6E22E;">requestUpdate</span><span style="color:#F8F8F2;">());</span></span>
<span class="line highlighted"><span style="color:#F8F8F2;">player.</span><span style="color:#A6E22E;">onUpdate</span><span style="color:#F8F8F2;">(() </span><span style="color:#66D9EF;font-style:italic;">=&gt;</span><span style="color:#F8F8F2;"> $layout.</span><span style="color:#A6E22E;">requestUpdate</span><span style="color:#F8F8F2;">());</span></span></code></pre></div><p>With these two lines of code, all the clients are now automatically updated anytime a shared-state parameter is modified. To see this in action, open two browser windows side by side and open some controller(s) in one of them <a href="http://127.0.0.1:8000/controller?emulate=2" target="_blank" rel="noreferrer">http://127.0.0.1:8000/controller?emulate=2</a> and some players in the other one <a href="http://127.0.0.1:8000/?emulate=2" target="_blank" rel="noreferrer">http://127.0.0.1:8000/?emulate=2</a>.</p><p><img src="`+y+`" alt="controller-and-clients-1"></p><h3 id="observing-and-controlling-clients" tabindex="-1">Observing and controlling clients <a class="header-anchor" href="#observing-and-controlling-clients" aria-label="Permalink to &quot;Observing and controlling clients&quot;">​</a></h3><p>The final thing we need to do, is to be able to control the frequency of each player from the <code>controller</code> clients. To that end, the controller needs to be able to track the creation (and deletion) of all <code>player</code> states in the application. Fortunately, the <code>StateManager</code> gives you access to such functionality.</p><p>To do so, let&#39;s add the following snippet in the <code>src/clients/controller/index.js</code> file:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki monokai has-highlighted-lines"><code><span class="line"><span style="color:#88846F;">// src/clients/controller/index.js</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> globals </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">await</span><span style="color:#F8F8F2;"> client.stateManager.</span><span style="color:#A6E22E;">attach</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;globals&#39;</span><span style="color:#F8F8F2;">);</span></span>
<span class="line"></span>
<span class="line highlighted"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> players </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">new</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">Set</span><span style="color:#F8F8F2;">();</span></span>
<span class="line highlighted"><span style="color:#88846F;">// observe all states created on the network</span></span>
<span class="line highlighted"><span style="color:#F8F8F2;">client.stateManager.</span><span style="color:#A6E22E;">observe</span><span style="color:#F8F8F2;">(</span><span style="color:#F92672;">async</span><span style="color:#F8F8F2;"> (</span><span style="color:#FD971F;font-style:italic;">schemaName</span><span style="color:#F8F8F2;">, </span><span style="color:#FD971F;font-style:italic;">stateId</span><span style="color:#F8F8F2;">) </span><span style="color:#66D9EF;font-style:italic;">=&gt;</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line highlighted"><span style="color:#F8F8F2;">  </span><span style="color:#88846F;">// we are only interested in player schemas</span></span>
<span class="line highlighted"><span style="color:#F8F8F2;">  </span><span style="color:#F92672;">if</span><span style="color:#F8F8F2;"> (schemaName </span><span style="color:#F92672;">===</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;player&#39;</span><span style="color:#F8F8F2;">) {</span></span>
<span class="line highlighted"><span style="color:#F8F8F2;">    </span><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> player </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">await</span><span style="color:#F8F8F2;"> client.stateManager.</span><span style="color:#A6E22E;">attach</span><span style="color:#F8F8F2;">(schemaName, stateId);</span></span>
<span class="line highlighted"><span style="color:#F8F8F2;">    </span><span style="color:#88846F;">// store this state in our local list in relation to the node id</span></span>
<span class="line highlighted"><span style="color:#F8F8F2;">    players.</span><span style="color:#A6E22E;">add</span><span style="color:#F8F8F2;">(player);</span></span>
<span class="line highlighted"><span style="color:#F8F8F2;">    </span><span style="color:#88846F;">// remove the player from the list when is deleted. The \`onDetach\` method is</span></span>
<span class="line highlighted"><span style="color:#F8F8F2;">    </span><span style="color:#88846F;">// automatically called when the remote client disconnects and the state deleted</span></span>
<span class="line highlighted"><span style="color:#F8F8F2;">    player.</span><span style="color:#A6E22E;">onDetach</span><span style="color:#F8F8F2;">(() </span><span style="color:#66D9EF;font-style:italic;">=&gt;</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line highlighted"><span style="color:#F8F8F2;">      players.</span><span style="color:#A6E22E;">delete</span><span style="color:#F8F8F2;">(player);</span></span>
<span class="line highlighted"><span style="color:#F8F8F2;">      </span><span style="color:#88846F;">// update the view to remove the player from the interface</span></span>
<span class="line highlighted"><span style="color:#F8F8F2;">      $layout.</span><span style="color:#A6E22E;">requestUpdate</span><span style="color:#F8F8F2;">();</span></span>
<span class="line highlighted"><span style="color:#F8F8F2;">    });</span></span>
<span class="line highlighted"><span style="color:#F8F8F2;">    </span><span style="color:#88846F;">// update the view vhen the state is updated</span></span>
<span class="line highlighted"><span style="color:#F8F8F2;">    player.</span><span style="color:#A6E22E;">onUpdate</span><span style="color:#F8F8F2;">(() </span><span style="color:#66D9EF;font-style:italic;">=&gt;</span><span style="color:#F8F8F2;"> $layout.</span><span style="color:#A6E22E;">requestUpdate</span><span style="color:#F8F8F2;">());</span></span>
<span class="line highlighted"><span style="color:#F8F8F2;">    </span><span style="color:#88846F;">// update the view to display the new player</span></span>
<span class="line highlighted"><span style="color:#F8F8F2;">    $layout.</span><span style="color:#A6E22E;">requestUpdate</span><span style="color:#F8F8F2;">();</span></span>
<span class="line highlighted"><span style="color:#F8F8F2;">  }</span></span>
<span class="line highlighted"><span style="color:#F8F8F2;">});</span></span></code></pre></div><div class="info custom-block"><p class="custom-block-title">INFO</p><p>In a future release of <em>soundworks</em> we will provide a more simple and user-friendly way to handle such collections of similar states.</p></div><p>Then, let&#39;s create a new graphic component to display the frequency control for all <code>player</code> shared states:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki monokai has-highlighted-lines"><code><span class="line"><span style="color:#88846F;">// src/clients/controller/index.js</span></span>
<span class="line"><span style="color:#F8F8F2;">$layout.</span><span style="color:#A6E22E;">addComponent</span><span style="color:#F8F8F2;">(globalsComponent);</span></span>
<span class="line"></span>
<span class="line highlighted"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> playersComponent </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line highlighted"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">render</span><span style="color:#F8F8F2;">() {</span></span>
<span class="line highlighted"><span style="color:#F8F8F2;">    </span><span style="color:#88846F;">// loop through \`players\` to create an interface per player state instance</span></span>
<span class="line highlighted"><span style="color:#F8F8F2;">    </span><span style="color:#F92672;">return</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">html</span><span style="color:#E6DB74;">\`</span></span>
<span class="line highlighted"><span style="color:#E6DB74;">      &lt;h2&gt;Players&lt;/h2&gt;</span></span>
<span class="line highlighted"><span style="color:#E6DB74;">      </span><span style="color:#F92672;">\${</span><span style="color:#F8F8F2;">Array.</span><span style="color:#A6E22E;">from</span><span style="color:#F8F8F2;">(players).</span><span style="color:#A6E22E;">map</span><span style="color:#F8F8F2;">(</span><span style="color:#FD971F;font-style:italic;">player</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">=&gt;</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line highlighted"><span style="color:#F8F8F2;">        </span><span style="color:#F92672;">return</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">html</span><span style="color:#E6DB74;">\`</span></span>
<span class="line highlighted"><span style="color:#E6DB74;">          &lt;div style=&quot;padding-bottom: 4px&quot;&gt;</span></span>
<span class="line highlighted"><span style="color:#E6DB74;">            &lt;sc-text value=&quot;frequency&quot; readonly&gt;&lt;/sc-text&gt;</span></span>
<span class="line highlighted"><span style="color:#E6DB74;">            &lt;sc-number</span></span>
<span class="line highlighted"><span style="color:#E6DB74;">              min=&quot;50&quot;</span></span>
<span class="line highlighted"><span style="color:#E6DB74;">              max=&quot;1000&quot;</span></span>
<span class="line highlighted"><span style="color:#E6DB74;">              value=&quot;</span><span style="color:#F92672;">\${</span><span style="color:#F8F8F2;">player.</span><span style="color:#A6E22E;">get</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;frequency&#39;</span><span style="color:#F8F8F2;">)</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;">&quot;</span></span>
<span class="line highlighted"><span style="color:#E6DB74;">              @input=&quot;</span><span style="color:#F92672;">\${</span><span style="color:#FD971F;font-style:italic;">e</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">=&gt;</span><span style="color:#F8F8F2;"> player.</span><span style="color:#A6E22E;">set</span><span style="color:#F8F8F2;">({ frequency: e.detail.value })</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;">&quot;</span></span>
<span class="line highlighted"><span style="color:#E6DB74;">            &gt;&lt;/sc-number&gt;</span></span>
<span class="line highlighted"><span style="color:#E6DB74;">          &lt;/div&gt;</span></span>
<span class="line highlighted"><span style="color:#E6DB74;">        \`</span><span style="color:#F8F8F2;">;</span></span>
<span class="line highlighted"><span style="color:#F8F8F2;">      })</span><span style="color:#F92672;">}</span></span>
<span class="line highlighted"><span style="color:#E6DB74;">    \`</span><span style="color:#F8F8F2;">;</span></span>
<span class="line highlighted"><span style="color:#F8F8F2;">  }</span></span>
<span class="line highlighted"><span style="color:#F8F8F2;">}</span></span>
<span class="line highlighted"><wbr></span>
<span class="line highlighted"><span style="color:#F8F8F2;">$layout.</span><span style="color:#A6E22E;">addComponent</span><span style="color:#F8F8F2;">(playersComponent);</span></span></code></pre></div><p>Now if you open two browser windows and launch a controller <a href="http://127.0.0.1:8000/controller" target="_blank" rel="noreferrer">http://127.0.0.1:8000/controller</a> and a player <a href="http://127.0.0.1:8000/" target="_blank" rel="noreferrer">http://127.0.0.1:8000/</a>, you will see that you can control the frequency of the player from the controller.</p><p><img src="`+d+'" alt="controller-and-clients-2"></p><p>However, there is still an issue with our interface: if we emulate several player clients (e.g. [<a href="http://127.0.0.1:8000/?emulate=6" target="_blank" rel="noreferrer">http://127.0.0.1:8000/?emulate=6</a>]), we can see that we have no way to know which control correspond to which player:</p><p><img src="'+g+`" alt="badly-defined-players"></p><p>Let&#39;s review our code a bit to takle this issue.</p><h3 id="using-the-client-id-to-enhance-the-control-interface" tabindex="-1">Using the client id to enhance the control interface <a class="header-anchor" href="#using-the-client-id-to-enhance-the-control-interface" aria-label="Permalink to &quot;Using the client id to enhance the control interface&quot;">​</a></h3><p>To fix this problem let&#39;s just use the id that is automatically given by <em>soundworks</em> to each client when it connects to share it in the <code>player</code> state.</p><p>So first, let&#39;s add a new parameter called <code>id</code> in our <code>player</code> schema to store this value:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki monokai has-highlighted-lines"><code><span class="line"><span style="color:#88846F;">// src/server/schemas/player.js</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">default</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line highlighted"><span style="color:#F8F8F2;">  id: {</span></span>
<span class="line highlighted"><span style="color:#F8F8F2;">    type: </span><span style="color:#E6DB74;">&#39;integer&#39;</span><span style="color:#F8F8F2;">,</span></span>
<span class="line highlighted"><span style="color:#F8F8F2;">    default: </span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">,</span></span>
<span class="line highlighted"><span style="color:#F8F8F2;">  },</span></span>
<span class="line"><span style="color:#F8F8F2;">  frequency: {</span></span>
<span class="line"><span style="color:#F8F8F2;">    type: </span><span style="color:#E6DB74;">&#39;float&#39;</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#F8F8F2;">    min: </span><span style="color:#AE81FF;">50</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#F8F8F2;">    max: </span><span style="color:#AE81FF;">1000</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#F8F8F2;">    default: </span><span style="color:#AE81FF;">440</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#F8F8F2;">  },</span></span>
<span class="line"><span style="color:#F8F8F2;">};</span></span></code></pre></div><p>Second, let&#39;s review our <code>player</code> client code to:</p><ol><li>pass the client id to the shared state when it is created by the client</li></ol><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki monokai has-diff"><code><span class="line"><span style="color:#88846F;">// src/clients/player/index.js</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> globals </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">await</span><span style="color:#F8F8F2;"> client.stateManager.</span><span style="color:#A6E22E;">attach</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;globals&#39;</span><span style="color:#F8F8F2;">);</span></span>
<span class="line"><span style="color:#88846F;">// create the player state with the client id</span></span>
<span class="line diff remove"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> player </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">await</span><span style="color:#F8F8F2;"> client.stateManager.</span><span style="color:#A6E22E;">create</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;player&#39;</span><span style="color:#F8F8F2;">) </span></span>
<span class="line diff add"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> player </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">await</span><span style="color:#F8F8F2;"> client.stateManager.</span><span style="color:#A6E22E;">create</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;player&#39;</span><span style="color:#F8F8F2;">, { id: client.id }); </span></span></code></pre></div><ol start="2"><li>and display the <code>client.id</code> in the player interface:</li></ol><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki monokai has-diff"><code><span class="line"><span style="color:#88846F;">// src/clients/player/index.js</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> component </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">render</span><span style="color:#F8F8F2;">: () </span><span style="color:#66D9EF;font-style:italic;">=&gt;</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#F92672;">return</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">html</span><span style="color:#E6DB74;">\`</span></span>
<span class="line diff add"><span style="color:#E6DB74;">      &lt;h1&gt;Client n° </span><span style="color:#F92672;">\${</span><span style="color:#F8F8F2;">player.</span><span style="color:#A6E22E;">get</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;id&#39;</span><span style="color:#F8F8F2;">)</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;">&lt;/h1&gt; </span></span>
<span class="line"><span style="color:#E6DB74;">      &lt;h2&gt;Globals&lt;/h2&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">      &lt;ul&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">        &lt;li&gt;volume: </span><span style="color:#F92672;">\${</span><span style="color:#F8F8F2;">globals.</span><span style="color:#A6E22E;">get</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;volume&#39;</span><span style="color:#F8F8F2;">)</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;">&lt;/li&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">        &lt;li&gt;mute: </span><span style="color:#F92672;">\${</span><span style="color:#F8F8F2;">globals.</span><span style="color:#A6E22E;">get</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;mute&#39;</span><span style="color:#F8F8F2;">)</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;">&lt;/li&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">      &lt;/ul&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">      &lt;h2&gt;Player&lt;/h2&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">      &lt;ul&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">        &lt;li&gt;frequency: </span><span style="color:#F92672;">\${</span><span style="color:#F8F8F2;">player.</span><span style="color:#A6E22E;">get</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;frequency&#39;</span><span style="color:#F8F8F2;">)</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;">&lt;/li&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">      &lt;/ul&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">    \`</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"><span style="color:#F8F8F2;">};</span></span></code></pre></div><p>Finally, let&#39;s just display this information in the controller interface:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki monokai has-diff"><code><span class="line"><span style="color:#88846F;">// src/clients/controller/index.js</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> playersComponent </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">render</span><span style="color:#F8F8F2;">() {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#88846F;">// loop through \`players\` to create an interface per player state</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#F92672;">return</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">html</span><span style="color:#E6DB74;">\`</span></span>
<span class="line"><span style="color:#E6DB74;">      &lt;h2&gt;Players&lt;/h2&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">      </span><span style="color:#F92672;">\${</span><span style="color:#F8F8F2;">Array.</span><span style="color:#A6E22E;">from</span><span style="color:#F8F8F2;">(players).</span><span style="color:#A6E22E;">map</span><span style="color:#F8F8F2;">(</span><span style="color:#FD971F;font-style:italic;">player</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">=&gt;</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">        </span><span style="color:#F92672;">return</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">html</span><span style="color:#E6DB74;">\`</span></span>
<span class="line"><span style="color:#E6DB74;">          &lt;div style=&quot;padding-bottom: 4px&quot;&gt;</span></span>
<span class="line diff remove"><span style="color:#E6DB74;">            &lt;sc-text value=&quot;frequency&quot; readonly&gt;&lt;/sc-text&gt; </span></span>
<span class="line diff add"><span style="color:#E6DB74;">            &lt;sc-text value=&quot;player: </span><span style="color:#F92672;">\${</span><span style="color:#F8F8F2;">player.</span><span style="color:#A6E22E;">get</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;id&#39;</span><span style="color:#F8F8F2;">)</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;"> - frequency&quot; readonly&gt;&lt;/sc-text&gt; </span></span>
<span class="line"><span style="color:#E6DB74;">            &lt;sc-number</span></span>
<span class="line"><span style="color:#E6DB74;">              min=&quot;50&quot;</span></span>
<span class="line"><span style="color:#E6DB74;">              max=&quot;1000&quot;</span></span>
<span class="line"><span style="color:#E6DB74;">              value=&quot;</span><span style="color:#F92672;">\${</span><span style="color:#F8F8F2;">player.</span><span style="color:#A6E22E;">get</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;frequency&#39;</span><span style="color:#F8F8F2;">)</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;">&quot;</span></span>
<span class="line"><span style="color:#E6DB74;">              @input=&quot;</span><span style="color:#F92672;">\${</span><span style="color:#FD971F;font-style:italic;">e</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">=&gt;</span><span style="color:#F8F8F2;"> player.</span><span style="color:#A6E22E;">set</span><span style="color:#F8F8F2;">({ frequency: e.detail.value })</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;">&quot;</span></span>
<span class="line"><span style="color:#E6DB74;">            &gt;&lt;/sc-number&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">          &lt;/div&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">        \`</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F8F8F2;">      })</span><span style="color:#F92672;">}</span></span>
<span class="line"><span style="color:#E6DB74;">    \`</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span></code></pre></div><p>Now, if you open a controller (<a href="http://127.0.0.1:8000/controller" target="_blank" rel="noreferrer">http://127.0.0.1:8000/controller</a>) and several players (<a href="http://127.0.0.1:8000/?emulate=3" target="_blank" rel="noreferrer">http://127.0.0.1:8000/?emulate=3</a>) side by side, you should have a more usefull interface:</p><p><img src="`+u+'" alt="controller-player-final"></p><h2 id="conclusion" tabindex="-1">Conclusion <a class="header-anchor" href="#conclusion" aria-label="Permalink to &quot;Conclusion&quot;">​</a></h2><p>In this tutorial, you learned how to use the <em>soundworks</em> distributed state management system which we think is one of its most powerfull and versatile feature.</p><p>You have seen how to create global states that are common to all clients of the application, how to use them to describe the state of each client and how use them to implement remote control and monitoring interfaces. Along the way, you have seen how to use the <em>soundworks</em> wizard within your application (i.e. <code>npx soundworks</code>) and how to create user interface components working with the default <code>$layout</code> provided in the default application template.</p><p>In the next tutorial, we will see how to extend the possibilities of <em>soundworks</em> with plugins. For this first dive into plugins we will use the <code>@soundworks/plugin-init</code> plugin that is meant to simplify some redondant and cumbersome tasks such as resuming the audio context, etc.</p>',137),E=[f];function b(w,v,D,k,B,q){return a(),e("div",null,E)}const x=s(m,[["render",b]]);export{j as __pageData,x as default};
