import{_ as n,o as a,c as e,O as o}from"./chunks/framework.b2c12034.js";const l="/assets/homepage.188f2fad.png",t="/assets/homepage-multiple.f4d0c003.png",p="/assets/homepage-custom.b5ad577b.png",g=JSON.parse('{"title":"Using Plugins 1 - The platform-init Plugin","description":"","frontmatter":{},"headers":[],"relativePath":"tutorials/plugin-platform-init.md","filePath":"tutorials/plugin-platform-init.md"}'),i={name:"tutorials/plugin-platform-init.md"};function r(c,s,F,d,y,u){return a(),e("div",null,s[0]||(s[0]=[o(`<h1 id="using-plugins-1-the-platform-init-plugin" tabindex="-1">Using Plugins 1 - The <em>platform-init</em> Plugin <a class="header-anchor" href="#using-plugins-1-the-platform-init-plugin" aria-label="Permalink to &quot;Using Plugins 1 - The _platform-init_ Plugin&quot;">​</a></h1><p>In this first tutorial on <em>soundworks</em> plugins, we will learn why and how to use the <em>platform-init</em> plugin, which aims to simplify the use of certain browser features, such as the Web Audio API, that require a user gesture to be properly initialized.</p><p>The tutorial requires basic knowledge of the <code>soundworks</code> wizard, so please refer to the <a href="/tutorials/getting-started.html">getting started tutorial</a> if you didn&#39;t check it yet.</p><blockquote><p>The final source code of this tutorial can be found <a href="https://github.com/collective-soundworks/tutorials/tree/main/plugin-platform-init" target="_blank" rel="noreferrer">here</a></p></blockquote><h3 id="relevant-documentation" tabindex="-1">Relevant documentation <a class="header-anchor" href="#relevant-documentation" aria-label="Permalink to &quot;Relevant documentation&quot;">​</a></h3><ul><li><a href="https://soundworks.dev/soundworks/ClientPluginManager" target="_blank" rel="noreferrer">ClientPluginManager</a></li><li><a href="https://soundworks.dev/soundworks/ServerPluginManager" target="_blank" rel="noreferrer">ServerPluginManager</a></li><li><a href="/plugins/platform-init.html">@soundworks/plugin-platform-init</a></li></ul><h2 id="scaffolding-the-application-and-installing-the-plugin" tabindex="-1">Scaffolding the application and installing the plugin <a class="header-anchor" href="#scaffolding-the-application-and-installing-the-plugin" aria-label="Permalink to &quot;Scaffolding the application and installing the plugin&quot;">​</a></h2><p>First thing first, let&#39;s generate a new empty application with the <code>@soundworks/create</code> wizard. When the wizard will ask you to configure the default client, enter the following information:</p><ul><li>Name it <code>player</code></li><li>Select the <code>browser</code> target</li><li>Select the <code>default</code> template</li></ul><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki monokai"><code><span class="line"><span style="color:#66D9EF;">cd</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">/path/to/working/directory</span></span>
<span class="line"><span style="color:#A6E22E;">npx</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">@soundworks/create@latest</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">plugin-platform-init</span></span></code></pre></div><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki monokai"><code><span class="line"><span style="color:#86B42B;">~/tmp</span><span style="color:#F8F8F2;"> $ npx @soundworks/create@latest plugin-platform-init</span></span>
<span class="line"><span style="color:#666666;">[@soundworks/create#v5.0.3]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B3B42B;">&gt; welcome to soundworks</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">- documentation: </span><span style="color:#56ADBC;">https://soundworks.dev</span></span>
<span class="line"><span style="color:#F8F8F2;">- issues: </span><span style="color:#56ADBC;">https://github.com/collective-soundworks/soundworks/issues</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">- Scaffolding application in &quot;~/tmp/plugin-platform-init&quot; directory</span></span>
<span class="line"><span style="color:#F8F8F2;">- Installing dependencies</span></span>
<span class="line"></span>
<span class="line"><span style="color:#666666;">[@soundworks/wizard#v5.0.3]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#56ADBC;"># Install plugins</span></span>
<span class="line"><span style="color:#86B42B;">✔</span><span style="color:#F8F8F2;"> </span><span style="color:#F8F8F2;font-weight:bold;">Select the plugins you would like to install/uninstall</span><span style="color:#F8F8F2;"> </span><span style="color:#666666;">›</span><span style="color:#F8F8F2;"> </span></span>
<span class="line"><span style="color:#B3B42B;">+ nothing to do, aborting...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#56ADBC;"># Install libraries</span></span>
<span class="line"><span style="color:#86B42B;">✔</span><span style="color:#F8F8F2;"> </span><span style="color:#F8F8F2;font-weight:bold;">Select the libraries you would like to install/uninstall</span><span style="color:#F8F8F2;"> </span><span style="color:#666666;">›</span><span style="color:#F8F8F2;"> </span></span>
<span class="line"><span style="color:#B3B42B;">+ nothing to do, aborting...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#56ADBC;"># Create client</span></span>
<span class="line"><span style="color:#86B42B;">✔</span><span style="color:#F8F8F2;"> </span><span style="color:#F8F8F2;font-weight:bold;">Name of your new client (lowercase, no-space):</span><span style="color:#F8F8F2;"> </span><span style="color:#666666;">…</span><span style="color:#F8F8F2;"> player</span></span>
<span class="line"><span style="color:#86B42B;">✔</span><span style="color:#F8F8F2;"> </span><span style="color:#F8F8F2;font-weight:bold;">Which runtime for your client?</span><span style="color:#F8F8F2;"> </span><span style="color:#666666;">›</span><span style="color:#F8F8F2;"> browser</span></span>
<span class="line"><span style="color:#86B42B;">✔</span><span style="color:#F8F8F2;"> </span><span style="color:#F8F8F2;font-weight:bold;">Which template would you like to use?</span><span style="color:#F8F8F2;"> </span><span style="color:#666666;">›</span><span style="color:#F8F8F2;"> default</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">- Creating client &quot;player&quot; in file &quot;src/clients/player.js&quot;</span></span>
<span class="line"><span style="color:#F8F8F2;">- name: </span><span style="color:#56ADBC;">player</span></span>
<span class="line"><span style="color:#F8F8F2;">- runtime: </span><span style="color:#56ADBC;">browser</span></span>
<span class="line"><span style="color:#F8F8F2;">- template: </span><span style="color:#56ADBC;">default</span></span>
<span class="line"><span style="color:#F8F8F2;">- default: </span><span style="color:#56ADBC;">true</span></span>
<span class="line"></span>
<span class="line"><span style="color:#86B42B;">✔</span><span style="color:#F8F8F2;"> </span><span style="color:#F8F8F2;font-weight:bold;">Confirm?</span><span style="color:#F8F8F2;"> </span><span style="color:#666666;">…</span><span style="color:#F8F8F2;"> no </span><span style="color:#666666;">/</span><span style="color:#F8F8F2;"> </span><span style="color:#56ADBC;text-decoration:underline;">yes</span></span>
<span class="line"><span style="color:#86B42B;">+ client player created and configured</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#B3B42B;">&gt; welcome to the soundworks wizard</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#666666;">- you can exit the wizard at any moment by typing Ctrl+C or by choosing the &quot;exit&quot; option</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  - documentation: </span><span style="color:#56ADBC;">https://soundworks.dev</span></span>
<span class="line"><span style="color:#F8F8F2;">  - issues: </span><span style="color:#56ADBC;">https://github.com/collective-soundworks/soundworks/issues</span></span>
<span class="line"></span>
<span class="line"><span style="color:#86B42B;">✔</span><span style="color:#F8F8F2;"> </span><span style="color:#F8F8F2;font-weight:bold;">What do you want to do?</span><span style="color:#F8F8F2;"> </span><span style="color:#666666;">›</span><span style="color:#F8F8F2;"> → exit</span></span></code></pre></div><p>Once done, go to the directory and launch the <code>soundworks</code> wizard again to install the plugin:</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki monokai"><code><span class="line"><span style="color:#66D9EF;">cd</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">plugin-platform-init</span></span>
<span class="line"><span style="color:#A6E22E;">npx</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">soundworks</span></span></code></pre></div><p>Select the <code>install / uninstall soundworks plugins</code> entry with the arrows and press <code>Enter</code>:</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki monokai"><code><span class="line"><span style="color:#86B42B;">~/tmp</span><span style="color:#F8F8F2;"> $ cd plugin-platform-init/</span></span>
<span class="line"><span style="color:#86B42B;">~/tmp/plugin-platform-init</span><span style="color:#F8F8F2;"> $ npx soundworks</span></span>
<span class="line"><span style="color:#666666;">[@soundworks/wizard#v5.0.3]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#B3B42B;">&gt; welcome to the soundworks wizard</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#666666;">- you can exit the wizard at any moment by typing Ctrl+C or by choosing the &quot;exit&quot; option</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  - documentation: </span><span style="color:#56ADBC;">https://soundworks.dev</span></span>
<span class="line"><span style="color:#F8F8F2;">  - issues: </span><span style="color:#56ADBC;">https://github.com/collective-soundworks/soundworks/issues</span></span>
<span class="line"></span>
<span class="line"><span style="color:#56ADBC;">?</span><span style="color:#F8F8F2;"> </span><span style="color:#F8F8F2;font-weight:bold;">What do you want to do?</span><span style="color:#F8F8F2;"> </span><span style="color:#666666;">›</span><span style="color:#F8F8F2;"> </span><span style="color:#666666;">- Use arrow-keys. Return to submit.</span></span>
<span class="line"><span style="color:#F8F8F2;">    create a new soundworks client</span></span>
<span class="line"><span style="color:#56ADBC;">❯</span><span style="color:#F8F8F2;">   </span><span style="color:#56ADBC;text-decoration:underline;">install / uninstall soundworks plugins</span></span>
<span class="line"><span style="color:#F8F8F2;">    install / uninstall related libs</span></span>
<span class="line"><span style="color:#F8F8F2;">    find documentation about plugins and libs</span></span>
<span class="line"><span style="color:#F8F8F2;">    get config information about you application</span></span>
<span class="line"><span style="color:#F8F8F2;">    create a new environment config file</span></span>
<span class="line"><span style="color:#F8F8F2;">    eject the launcher and default init views</span></span>
<span class="line"><span style="color:#F8F8F2;">    check and update your dependencies</span></span>
<span class="line"><span style="color:#F8F8F2;">    upgrade config files from JSON to YAML</span></span>
<span class="line"><span style="color:#F8F8F2;">    → exit</span></span>
<span class="line"></span></code></pre></div><p>Select the <code>@soundworks/plugin-platform-init</code> using the space bar:</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki monokai"><code><span class="line"><span style="color:#86B42B;">✔</span><span style="color:#F8F8F2;"> </span><span style="color:#F8F8F2;font-weight:bold;">What do you want to do?</span><span style="color:#F8F8F2;"> </span><span style="color:#666666;">›</span><span style="color:#F8F8F2;"> install / uninstall soundworks plugins</span></span>
<span class="line"></span>
<span class="line"><span style="color:#56ADBC;"># Install plugins</span></span>
<span class="line"><span style="color:#56ADBC;">?</span><span style="color:#F8F8F2;"> </span><span style="color:#F8F8F2;font-weight:bold;">Select the plugins you would like to install/uninstall</span><span style="color:#F8F8F2;"> </span><span style="color:#666666;">›</span><span style="color:#F8F8F2;"> </span><span style="color:#666666;">- Space to select. Return to submit</span><span style="color:#F8F8F2;"> </span></span>
<span class="line"><span style="color:#86B42B;">◉</span><span style="color:#F8F8F2;">   </span><span style="color:#56ADBC;text-decoration:underline;">@soundworks/plugin-platform-init</span></span>
<span class="line"><span style="color:#F8F8F2;">◯   @soundworks/plugin-sync</span></span>
<span class="line"><span style="color:#F8F8F2;">◯   @soundworks/plugin-filesystem</span></span>
<span class="line"><span style="color:#F8F8F2;">◯   @soundworks/plugin-scripting</span></span>
<span class="line"><span style="color:#F8F8F2;">◯   @soundworks/plugin-checkin</span></span>
<span class="line"><span style="color:#F8F8F2;">◯   @soundworks/plugin-position</span></span>
<span class="line"><span style="color:#F8F8F2;">◯   @soundworks/plugin-logger</span></span></code></pre></div><p>And confirm:</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki monokai"><code><span class="line"><span style="color:#86B42B;">✔</span><span style="color:#F8F8F2;"> </span><span style="color:#F8F8F2;font-weight:bold;">What do you want to do?</span><span style="color:#F8F8F2;"> </span><span style="color:#666666;">›</span><span style="color:#F8F8F2;"> install / uninstall soundworks plugins</span></span>
<span class="line"></span>
<span class="line"><span style="color:#56ADBC;"># Install plugins</span></span>
<span class="line"><span style="color:#86B42B;">✔</span><span style="color:#F8F8F2;"> </span><span style="color:#F8F8F2;font-weight:bold;">Select the plugins you would like to install/uninstall</span><span style="color:#F8F8F2;"> </span><span style="color:#666666;">›</span><span style="color:#F8F8F2;"> @soundworks/plugin-platform-init</span></span>
<span class="line"></span>
<span class="line"><span style="color:#666666;">&gt; installing: @soundworks/plugin-platform-init</span></span>
<span class="line"><span style="color:#56ADBC;">?</span><span style="color:#F8F8F2;"> </span><span style="color:#F8F8F2;font-weight:bold;">Confirm?</span><span style="color:#F8F8F2;"> </span><span style="color:#666666;">›</span><span style="color:#F8F8F2;"> no </span><span style="color:#666666;">/</span><span style="color:#F8F8F2;"> </span><span style="color:#56ADBC;text-decoration:underline;">yes</span></span></code></pre></div><p>After the installation has completed, you can exit the wizard by pressing <code>Ctrl+C</code> or by selecting the <code>→ exit</code> entry in the menu.</p><div class="info custom-block"><p class="custom-block-title">INFO</p><p>You may have already noted that the wizard asks you if you want to install plugins when creating the application.</p><p>We just followed the long path to show you how to use the wizard within an existing application.</p></div><div class="info custom-block"><p class="custom-block-title">INFO</p><p>Note that this specific functionality of the wizard is just a facade over <code>npm install</code>, it is exactly equivalent to doing:</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki monokai"><code><span class="line"><span style="color:#A6E22E;">npm</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">install</span><span style="color:#F8F8F2;"> </span><span style="color:#AE81FF;">--save</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">@soundworks/plugin-platform-init</span></span></code></pre></div></div><p>If you open the <code>package.json</code> file, you should see the <code>@soundworks/plugin-platform-init</code> package declared in the <code>dependencies</code>::</p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki monokai has-highlighted-lines"><code><span class="line"><span style="color:#88846F;">// package.json</span></span>
<span class="line"><span style="color:#E6DB74;">&quot;dependencies&quot;</span><span style="color:#F8F8F2;">: {</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#66D9EF;font-style:italic;">&quot;@soundworks/core&quot;</span><span style="color:#F8F8F2;">: </span><span style="color:#CFCFC2;">&quot;^5.0.0&quot;</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#66D9EF;font-style:italic;">&quot;@soundworks/helpers&quot;</span><span style="color:#F8F8F2;">: </span><span style="color:#CFCFC2;">&quot;^5.0.0&quot;</span><span style="color:#F8F8F2;">,</span></span>
<span class="line highlighted"><span style="color:#F8F8F2;">  </span><span style="color:#66D9EF;font-style:italic;">&quot;@soundworks/plugin-platform-init&quot;</span><span style="color:#F8F8F2;">: </span><span style="color:#CFCFC2;">&quot;^5.0.0&quot;</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#66D9EF;font-style:italic;">&quot;lit&quot;</span><span style="color:#F8F8F2;">: </span><span style="color:#CFCFC2;">&quot;^3.1.3&quot;</span></span>
<span class="line"><span style="color:#F8F8F2;">},</span></span></code></pre></div><p>This file allows you and the <em>node package manager</em> (i.e. <code>npm</code>) to keep track of the dependencies of your project. Then, if you need to re-install the application dependencies (i.e. <code>npm install</code>) the plugin will be re-installed as well.</p><div class="info custom-block"><p class="custom-block-title">INFO</p><p>Note that the actual list of dependencies and version numbers might change compared with the ones listed above, as new versions of the core library and of the plugins will be released in the future.</p></div><h2 id="registering-the-plugin-into-soundworks" tabindex="-1">Registering the plugin into <em>soundworks</em> <a class="header-anchor" href="#registering-the-plugin-into-soundworks" aria-label="Permalink to &quot;Registering the plugin into _soundworks_&quot;">​</a></h2><p>Now that the plugin is installed as a dependency of our application, let&#39;s write the code to register the plugin into <em>soundworks</em>.</p><p>Note that by design, all <em>soundworks</em> plugins always come with both a server-side component and a client-side component. Hence, you will always have to register the plugin on both side of your application.</p><h3 id="server-side-registration" tabindex="-1">Server-side registration <a class="header-anchor" href="#server-side-registration" aria-label="Permalink to &quot;Server-side registration&quot;">​</a></h3><p>Let&#39;s start with the server-side part and write the following code in the <code>src/server.js</code> file. First let&#39;s import the server-side part of the plugin on top of the file:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki monokai has-diff"><code><span class="line"><span style="color:#88846F;">// src/server.js</span></span>
<span class="line"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> { Server } </span><span style="color:#F92672;">from</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;@soundworks/core/server.js&#39;</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> { loadConfig, configureHttpRouter } </span><span style="color:#F92672;">from</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;@soundworks/helpers/server.js&#39;</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#88846F;">// import the server-side part of the \`platform-init\` plugin</span></span>
<span class="line diff add"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> ServerPluginPlatformInit </span><span style="color:#F92672;">from</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;@soundworks/plugin-platform-init/server.js&#39;</span><span style="color:#F8F8F2;">; </span></span></code></pre></div><p>Then register it into the <code>server.pluginManager</code> component:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki monokai has-diff"><code><span class="line"><span style="color:#88846F;">// src/server.js</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> server </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">new</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">Server</span><span style="color:#F8F8F2;">(config);</span></span>
<span class="line"><span style="color:#A6E22E;">configureHttpRouter</span><span style="color:#F8F8F2;">(server);</span></span>
<span class="line"><span style="color:#88846F;">// register the plugin into the soundworks&#39; plugin manager</span></span>
<span class="line diff add"><span style="color:#F8F8F2;">server.pluginManager.</span><span style="color:#A6E22E;">register</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;platform-init&#39;</span><span style="color:#F8F8F2;">, ServerPluginPlatformInit); </span></span></code></pre></div><p>The <a href="https://soundworks.dev/soundworks/ServerPluginManager#register" target="_blank" rel="noreferrer"><code>ServerPluginManager.register</code></a> method takes at least 2 arguments:</p><ul><li>A user defined <code>id</code> (here <code>platform-init</code>) that is used as an internal identifier to retrieve the plugin instance. In more advanced use-cases, it also allows you to register several times the same plugin under different ids.</li><li>A plugin constructor (here <code>ServerPluginPlatformInit</code>) from which the actual plugin instance will be created.</li></ul><p>And that&#39;s all for the server-side! Let&#39;s now install the plugin on the client-side.</p><h3 id="client-side-registration" tabindex="-1">Client-side registration <a class="header-anchor" href="#client-side-registration" aria-label="Permalink to &quot;Client-side registration&quot;">​</a></h3><p>Let&#39;s open the <code>src/clients/player.js</code> and, as for the server-side, import the client-side part of the <em>platform-init</em> plugin:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki monokai has-diff"><code><span class="line"><span style="color:#88846F;">// src/clients/player.js</span></span>
<span class="line"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> { Client } </span><span style="color:#F92672;">from</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;@soundworks/core/client.js&#39;</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> { loadConfig, launcher } </span><span style="color:#F92672;">from</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;@soundworks/helpers/browser.js&#39;</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> { html, render } </span><span style="color:#F92672;">from</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;lit&#39;</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#88846F;">// import the client-side part of the \`platform-init\` plugin</span></span>
<span class="line diff add"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> ClientPluginPlatformInit </span><span style="color:#F92672;">from</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;@soundworks/plugin-platform-init/client.js&#39;</span><span style="color:#F8F8F2;">; </span></span></code></pre></div><p>Now that our plugin is imported, we can register it into the <a href="https://soundworks.dev/soundworks/ClientPluginManager" target="_blank" rel="noreferrer"><code>ClientPluginManager</code></a>:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki monokai has-diff"><code><span class="line"><span style="color:#88846F;">// src/clients/player.js</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> config </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">loadConfig</span><span style="color:#F8F8F2;">();</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> client </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">new</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">Client</span><span style="color:#F8F8F2;">(config);</span></span>
<span class="line"><span style="color:#88846F;">// register the plugin into the soundworks&#39; plugin manager</span></span>
<span class="line diff add"><span style="color:#F8F8F2;">client.pluginManager.</span><span style="color:#A6E22E;">register</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;platform-init&#39;</span><span style="color:#F8F8F2;">, ClientPluginPlatformInit); </span></span></code></pre></div><p>As for the server-side, we passed 2 arguments to the <a href="https://soundworks.dev/soundworks/ClientPluginManager#register" target="_blank" rel="noreferrer"><code>ClientPluginManager#register</code></a> method: the plugin user-defined <code>id</code> and the constructor of the plugin.</p><p>An important point to notice here is that the <code>id</code> we used is the same on both server-side and client-side. This allows <em>soundworks</em> to automatically match and associate the two components.</p><p>At this point, if you start the server (i.e. <code>npm run dev</code>) and go to <a href="http://127.0.0.1:8000" target="_blank" rel="noreferrer">http://127.0.0.1:8000</a>, you should see the default splash screen provided by the plugin. This screen requires a user gesture (i.e. a &quot;click&quot; event) and is automatically shown by the <code>launcher</code> because the <em>platform-init</em> plugin has been registered into <em>soundworks</em>:</p><p><img src="`+l+`" alt="homepage"></p><h2 id="resuming-an-audiocontext" tabindex="-1">Resuming an <code>AudioContext</code> <a class="header-anchor" href="#resuming-an-audiocontext" aria-label="Permalink to &quot;Resuming an \`AudioContext\`&quot;">​</a></h2><p>So far, so good but what we did until now is mainly to add a splash screen asking for a click, but does nothing particular... Or, as stated in the beginning of the tutorial, the whole aim of the <code>platform-init</code> plugin is to simplify the initialization of features that require a user-gesture in order to be properly launched. Let&#39;s exemplify that by resuming an <code>AudioContext</code>.</p><div class="info custom-block"><p class="custom-block-title">INFO</p><p>An user gesture is required by the browsers to access or initialize certain features such as the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Audio_API" target="_blank" rel="noreferrer">Web Audio API</a>, the microphone or the camera. This is a way to protect end-users against intrusive ads and/or for obvious privacy reasons.</p></div><p>So first, let&#39;s first create an new <code>audioContext</code>:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki monokai has-diff"><code><span class="line"><span style="color:#88846F;">// src/clients/player.js</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> config </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">loadConfig</span><span style="color:#F8F8F2;">();</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> client </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">new</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">Client</span><span style="color:#F8F8F2;">(config);</span></span>
<span class="line diff add"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> audioContext </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">new</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">AudioContext</span><span style="color:#F8F8F2;">(); </span></span></code></pre></div><p>And pass it as third argument of the <code>pluginManager.register</code> method:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki monokai has-highlighted-lines has-diff"><code><span class="line"><span style="color:#88846F;">// src/clients/player.js</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> client </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">new</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">Client</span><span style="color:#F8F8F2;">(config);</span></span>
<span class="line"><span style="color:#88846F;">// register the plugin into the soundworks&#39; plugin manager, and pass it the audioContext</span></span>
<span class="line diff remove highlighted"><span style="color:#F8F8F2;">client.pluginManager.</span><span style="color:#A6E22E;">register</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;platform-init&#39;</span><span style="color:#F8F8F2;">, ClientPluginPlatformInit);  </span></span>
<span class="line diff add highlighted"><span style="color:#F8F8F2;">client.pluginManager.</span><span style="color:#A6E22E;">register</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;platform-init&#39;</span><span style="color:#F8F8F2;">, ClientPluginPlatformInit, { audioContext });  </span></span></code></pre></div><div class="info custom-block"><p class="custom-block-title">INFO</p><p>By default, the <em>platform-init</em> plugin provides simplified access to several features, such as motion sensors, microphone and camera. Refer to the <a href="https://github.com/collective-soundworks/soundworks-plugin-platform-init" target="_blank" rel="noreferrer">plugin documentation</a> for more information.</p></div><p>Finally, let&#39;s create some welcoming sound that will show us that everything works well and that our <code>audioContext</code> is properly resumed:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki monokai has-diff"><code><span class="line"><span style="color:#88846F;">// src/clients/player.js</span></span>
<span class="line"><span style="color:#F8F8F2;">launcher.</span><span style="color:#A6E22E;">register</span><span style="color:#F8F8F2;">(client, { initScreensContainer: $container });</span></span>
<span class="line"></span>
<span class="line diff add"><span style="color:#F8F8F2;">console.</span><span style="color:#A6E22E;">log</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">\`&gt; before start - audioContext is &quot;</span><span style="color:#F92672;">\${</span><span style="color:#F8F8F2;">audioContext.state</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;">&quot;\`</span><span style="color:#F8F8F2;">); </span></span>
<span class="line"><span style="color:#F92672;">await</span><span style="color:#F8F8F2;"> client.</span><span style="color:#A6E22E;">start</span><span style="color:#F8F8F2;">();</span></span>
<span class="line diff add"><span style="color:#F8F8F2;">console.</span><span style="color:#A6E22E;">log</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">\`&gt; after start - audioContext is &quot;</span><span style="color:#F92672;">\${</span><span style="color:#F8F8F2;">audioContext.state</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;">&quot;\`</span><span style="color:#F8F8F2;">); </span></span>
<span class="line"></span>
<span class="line diff add"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> now </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> audioContext.currentTime;  </span></span>
<span class="line diff add"><span style="color:#88846F;">// create a simple envelop </span></span>
<span class="line diff add"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> env </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> audioContext.</span><span style="color:#A6E22E;">createGain</span><span style="color:#F8F8F2;">(); </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">env.</span><span style="color:#A6E22E;">connect</span><span style="color:#F8F8F2;">(audioContext.destination); </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">env.gain.</span><span style="color:#A6E22E;">setValueAtTime</span><span style="color:#F8F8F2;">(</span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">, now); </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">env.gain.</span><span style="color:#A6E22E;">linearRampToValueAtTime</span><span style="color:#F8F8F2;">(</span><span style="color:#AE81FF;">0.5</span><span style="color:#F8F8F2;">, now </span><span style="color:#F92672;">+</span><span style="color:#F8F8F2;"> </span><span style="color:#AE81FF;">0.01</span><span style="color:#F8F8F2;">); </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">env.gain.</span><span style="color:#A6E22E;">exponentialRampToValueAtTime</span><span style="color:#F8F8F2;">(</span><span style="color:#AE81FF;">0.0001</span><span style="color:#F8F8F2;">, now </span><span style="color:#F92672;">+</span><span style="color:#F8F8F2;"> </span><span style="color:#AE81FF;">4</span><span style="color:#F8F8F2;">); </span></span>
<span class="line"></span>
<span class="line diff add"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> src </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> audioContext.</span><span style="color:#A6E22E;">createOscillator</span><span style="color:#F8F8F2;">(); </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">src.</span><span style="color:#A6E22E;">connect</span><span style="color:#F8F8F2;">(env); </span><span style="color:#88846F;">// [!code ++]</span></span>
<span class="line diff add"><span style="color:#88846F;">// randomly pick a frequency on an harmonic spectrum (150, 300, 450, etc...)  </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">src.frequency.value </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#AE81FF;">150</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">+</span><span style="color:#F8F8F2;"> Math.</span><span style="color:#A6E22E;">floor</span><span style="color:#F8F8F2;">(Math.</span><span style="color:#A6E22E;">random</span><span style="color:#F8F8F2;">() </span><span style="color:#F92672;">*</span><span style="color:#F8F8F2;"> </span><span style="color:#AE81FF;">10</span><span style="color:#F8F8F2;">) </span><span style="color:#F92672;">*</span><span style="color:#F8F8F2;"> </span><span style="color:#AE81FF;">150</span><span style="color:#F8F8F2;">; </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">src.</span><span style="color:#A6E22E;">start</span><span style="color:#F8F8F2;">(now); </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">src.</span><span style="color:#A6E22E;">stop</span><span style="color:#F8F8F2;">(now </span><span style="color:#F92672;">+</span><span style="color:#F8F8F2;"> </span><span style="color:#AE81FF;">4</span><span style="color:#F8F8F2;">); </span></span></code></pre></div><p>Reload the page (<code>Cmd+R</code>) and click, you should now hear an incredibly nice sound coming from your speakers!</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>Note that if you emulate multiple clients in the same window (i.e. <a href="http://127.0.0.1:8000/?emulate=4" target="_blank" rel="noreferrer">http://127.0.0.1:8000/?emulate=4</a>), you should see how the soundworks launcher also helps you to start all the clients at once without requiring you to click on each of them:</p><p><img src="`+t+`" alt="homepage-multiple"></p></div><h2 id="notes-on-the-soundworks-helpers-default-views" tabindex="-1">Notes on the <code>@soundworks/helpers</code> default views <a class="header-anchor" href="#notes-on-the-soundworks-helpers-default-views" aria-label="Permalink to &quot;Notes on the \`@soundworks/helpers\` default views&quot;">​</a></h2><p>The splash screen, as well as other default initialization views that we have not seen yet, are automatically created and handled by the <code>launcher</code> object included in the default application template:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki monokai"><code><span class="line"><span style="color:#88846F;">// src/clients/player.js</span></span>
<span class="line"><span style="color:#F8F8F2;">launcher.</span><span style="color:#A6E22E;">register</span><span style="color:#F8F8F2;">(client, { initScreensContainer: $container });</span></span></code></pre></div><p>The launcher offers numerous ways to adapt these views to your specific needs: e.g. to change the default styles, to adapt the language, or even to use completely different user defined views.</p><p>While we won&#39;t cover these advanced use-cases here, as they will be the subject of a dedicated tutorial, let&#39;s just see here the minimal changes we can make to customize the init view.</p><p>Let&#39;s then open the <code>config/application.yaml</code> file which should look like this:</p><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki monokai"><code><span class="line"><span style="color:#88846F;"># config/application.yaml</span></span>
<span class="line"><span style="color:#F92672;">name</span><span style="color:#F8F8F2;">: </span><span style="color:#E6DB74;">plugin-platform-init</span></span>
<span class="line"><span style="color:#F92672;">author</span><span style="color:#F8F8F2;">: </span><span style="color:#E6DB74;">&quot;&quot;</span></span>
<span class="line"><span style="color:#F92672;">clients</span><span style="color:#F8F8F2;">:</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#F92672;">player</span><span style="color:#F8F8F2;">:</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#F92672;">runtime</span><span style="color:#F8F8F2;">: </span><span style="color:#E6DB74;">browser</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#F92672;">default</span><span style="color:#F8F8F2;">: </span><span style="color:#AE81FF;">true</span></span></code></pre></div><p>This file has been generated for you by the <em>soundworks</em> wizard, and the <code>clients</code> entry is automatically updated each time you create a new client using this tool.</p><p>However, the <code>name</code> and <code>author</code> entries can be safely changed and are used by the <code>launcher</code> to create the splash screen. Let&#39;s just change the <code>name</code> and <code>author</code> entries to see it in action:</p><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki monokai has-diff"><code><span class="line diff remove"><span style="color:#F92672;">name</span><span style="color:#F8F8F2;">: </span><span style="color:#E6DB74;">plugin-platform-init</span><span style="color:#F8F8F2;"> </span></span>
<span class="line diff add"><span style="color:#F92672;">name</span><span style="color:#F8F8F2;">: </span><span style="color:#E6DB74;">Hello Plugins</span><span style="color:#F8F8F2;"> </span></span>
<span class="line diff remove"><span style="color:#F92672;">author</span><span style="color:#F8F8F2;">: </span><span style="color:#E6DB74;">&quot;&quot;</span><span style="color:#F8F8F2;"> </span></span>
<span class="line diff add"><span style="color:#F92672;">author</span><span style="color:#F8F8F2;">: </span><span style="color:#E6DB74;">me &amp; myself</span><span style="color:#F8F8F2;"> </span></span></code></pre></div><p>And tada! If you now go to <a href="http://127.0.0.1:8000" target="_blank" rel="noreferrer">http://127.0.0.1:8000</a> you should now see something like:</p><p><img src="`+p+'" alt="homepage-custom"></p><div class="info custom-block"><p class="custom-block-title">INFO</p><p>By default, the init views try to adapt to the locale of the browser and falls back to English if the localized texts do not exist. However, as we only provide English and French versions of the texts at time of writing the tutorial, it&#39;s very likely that you have seen the English version.</p><p>If you are comfortable with another language and are willing to contribute to a localized version of <a href="https://github.com/collective-soundworks/soundworks-helpers/blob/main/browser-client/i18n/en.js" target="_blank" rel="noreferrer">this file</a>, please open an issue or a pull request in the <a href="https://github.com/collective-soundworks/soundworks-helpers/" target="_blank" rel="noreferrer"><code>@soundworks/helpers</code></a> repository!</p></div><h2 id="conclusion" tabindex="-1">Conclusion <a class="header-anchor" href="#conclusion" aria-label="Permalink to &quot;Conclusion&quot;">​</a></h2><p>In this tutorial, you have learned the basics of <em>soundworks</em> plugins usage, and more precisely how to use the <em>platform-init</em> plugin. While this plugin is not <em>per se</em> very complex, it can save you a lot of (quite boring) development time by simplifying the initialization of certain browser features. Along the way, you also discovered some of the functionalities provided by the <code>launcher</code> component that is automatically included in all <em>soundworks</em> applications created with the wizard.</p><p>In the next tutorial, we will wrap up what we have learned so far by creating a small working application where several clients can be used as distributed speakers from a central controller.</p>',74)]))}const f=n(i,[["render",r]]);export{g as __pageData,f as default};
