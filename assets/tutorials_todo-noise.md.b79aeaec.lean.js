import{_ as a,o as n,c as l,O as e}from"./chunks/framework.b2c12034.js";const o="/assets/install-plugin-platform-init.169972d8.png",p="/assets/create-player.ef5368fc.png",t="/assets/soundworks-devtools.d9e925b7.png",c="/assets/create-controller.1271e198.png",r="/assets/global-server-log.822a6d53.png",F="/assets/player-log-global.b0f55f02.png",i="/assets/global-player-controller.af9833c0.png",y="/assets/player-full.c56b8647.png",d="/assets/todo-noise-full.c1e1dfdb.png",D=JSON.parse('{"title":"The Todo Noise Application","description":"","frontmatter":{},"headers":[],"relativePath":"tutorials/todo-noise.md","filePath":"tutorials/todo-noise.md"}'),h={name:"tutorials/todo-noise.md"};function f(g,s,m,u,E,b){return n(),l("div",null,s[0]||(s[0]=[e(`<h1 id="the-todo-noise-application" tabindex="-1">The <em>Todo Noise</em> Application <a class="header-anchor" href="#the-todo-noise-application" aria-label="Permalink to &quot;The _Todo Noise_ Application&quot;">​</a></h1><p>In this tutorial we will build a simple application, which illustrates the most common type of distributed interaction you will need to implement in your own applications: i.e. remote monitoring and control.</p><p>The tutorial requires basic knowledge of the <em>soundworks</em> <a href="./state-manager.html">state manager</a> and of the <a href="./plugin-platform-init.html">platform-init plugin</a>, so please refer to the relevant tutorials if you didn&#39;t check them yet.</p><p>Along the way, we will discover how to create our own reusable <a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_components" target="_blank" rel="noreferrer">Web Components</a> using the <a href="https://lit.dev/" target="_blank" rel="noreferrer">Lit</a> library proposed by default in soundworks applications.</p><h3 id="relevant-documentation" tabindex="-1">Relevant documentation <a class="header-anchor" href="#relevant-documentation" aria-label="Permalink to &quot;Relevant documentation&quot;">​</a></h3><ul><li><a href="https://soundworks.dev/soundworks/client.SharedStateCollection.html" target="_blank" rel="noreferrer">client.SharedStateCollection</a></li><li><a href="https://soundworks.dev/soundworks/server.SharedStateCollection.html" target="_blank" rel="noreferrer">server.SharedStateCollection</a></li><li><a href="https://github.com/collective-soundworks/soundworks-plugin-platform-init" target="_blank" rel="noreferrer">@soundworks/plugin-platform-init</a></li><li><a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_components" target="_blank" rel="noreferrer">Web Components</a></li><li><a href="https://lit.dev/" target="_blank" rel="noreferrer">Lit</a></li></ul><h2 id="user-story" tabindex="-1">User Story <a class="header-anchor" href="#user-story" aria-label="Permalink to &quot;User Story&quot;">​</a></h2><p>The application purposely privileges the point of view of a user in a working situation (e.g. developer, designer, composer or performer) rather than the point of view of the end user (e.g. participant, audience). Indeed, while the later is most of the time very specific to the application or artwork, the former generally requires some properties and features that are relatively common. To illustrate these two roles, the application is composed of two different types of clients: the <em>player</em> and the <em>controller</em>.</p><p>The <em>player</em> can be envisioned as the client dedicated to the end users. The application can accept any number of players and each player has access to the following functionalities:</p><ul><li>It can trigger a sound.</li><li>It can start and stop a synthesizer.</li><li>It can update a parameter (i.e. the frequency of the synths).</li></ul><p>The <em>controller</em> is dedicated to the user in working situation, be it during the creation or the performance of the artwork. The application can accept any number of controllers and each of them has access to the following functionalities:</p><ul><li>It controls global parameters of the application (i.e. mute, master volume). These global parameters must be synchronized among all the clients of the application (i.e. <em>player</em> and <em>controller</em>).</li><li>It can take full control over any <em>player</em>, i.e. the change the volume, trigger a sound and change the state of the synthesizer as if it was the client itself.</li></ul><p>This minimal set of functionalities should provide a good overview of several important and recurring patterns at stake in real-time distributed audio applications.</p><h2 id="scaffolding-the-application" tabindex="-1">Scaffolding the application <a class="header-anchor" href="#scaffolding-the-application" aria-label="Permalink to &quot;Scaffolding the application&quot;">​</a></h2><p>First thing first, let&#39;s generate a new empty application with the <code>@soundworks/create</code> wizard:</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki monokai"><code><span class="line"><span style="color:#66D9EF;">cd</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">/path/to/working/directory</span></span>
<span class="line"><span style="color:#A6E22E;">npx</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">@soundworks/create@latest</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">todo-noise</span></span></code></pre></div><p>You can already select the <a href="https://github.com/collective-soundworks/soundworks-plugin-platform-init" target="_blank" rel="noreferrer"><code>@soundworks/plugin-platform-init</code></a> plugin to have it installed.</p><p><img src="`+o+'" alt="install-plugin-platform-init"></p><p>Then, when the wizard asks you for the name of the default client, just call it <code>player</code>, and select the <code>browser</code> target as well as the <code>default</code> template:</p><p><img src="'+p+`" alt="create-player"></p><p>Once the wizard ended, let&#39;s launch the <code>soundworks</code> development tools inside our application and select the &quot;create a new soundworks client&quot; option to create our second type of client, the <em>controller</em>:</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki monokai"><code><span class="line"><span style="color:#66D9EF;">cd</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">todo-noise</span></span>
<span class="line"><span style="color:#A6E22E;">npx</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">soundworks</span></span></code></pre></div><p><img src="`+t+'" alt="soundworks-devtools"></p><p>The devtool wizard will ask you for the same questions as when you just created the <em>player</em> client. This time call the client <code>controller</code>, select the <code>browser</code> target and the <code>controller</code> template. Select <code>no</code>, the default value, when the tool asks if the client should be used as default:</p><p><img src="'+c+`" alt="create-controller"></p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>Selecting a client as <em>default</em> means the client will be accessible at the root of the domain, which is for example more simple if you need to share an URL with the public. In the other case the name of the client will be used as the route to access it.</p><p>For example, in our application:</p><ul><li>the <em>player</em> client would be accessible at <code>http://my-domain.com</code></li><li>the <em>controller</em> client would be accessible at <code>http://my-domain.com/controller</code></li></ul></div><p>Once done, you can exit the command-line devtool by typing <code>Ctrl+C</code> or by selecting the <code>→ exit</code> entry option.</p><p>Now that our project is scaffolded, let&#39;s create the schemas describing the states for each <em>player</em> as well as the global state.</p><h2 id="creating-and-using-the-shared-global-state" tabindex="-1">Creating and using the shared <code>global</code> state <a class="header-anchor" href="#creating-and-using-the-shared-global-state" aria-label="Permalink to &quot;Creating and using the shared \`global\` state&quot;">​</a></h2><p>To implement the user story defined above, the application will rely on 2 types of schema:</p><ul><li>A schema defining global variables of the application (e.g. mute, master volume) which will be unique and shared by every connected clients.</li><li>A schema that is tied to each connected player, i.e. each <em>player</em> client will create its own shared state instance from this schema.</li></ul><p>Let&#39;s start by defining and creating the global schema. Create a new file named <code>global.js</code> in the <code>src/server/schemas/</code> directory, and fill it with the following code:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki monokai has-diff"><code><span class="line"><span style="color:#88846F;">// src/server/schemas/global.js</span></span>
<span class="line diff add"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">default</span><span style="color:#F8F8F2;"> { </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">  master: { </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">    type: </span><span style="color:#E6DB74;">&#39;float&#39;</span><span style="color:#F8F8F2;">, </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">    default: </span><span style="color:#AE81FF;">1</span><span style="color:#F8F8F2;">, </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">    min: </span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">, </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">    max: </span><span style="color:#AE81FF;">1</span><span style="color:#F8F8F2;">, </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">  }, </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">  mute: { </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">    type: </span><span style="color:#E6DB74;">&#39;boolean&#39;</span><span style="color:#F8F8F2;">, </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">    default: </span><span style="color:#AE81FF;">false</span><span style="color:#F8F8F2;">, </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">  }, </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">}; </span></span></code></pre></div><p>The global state derived from this schema will keep track of the master volume applied to all connected <em>player</em> clients (i.e. a gain between 0 and 1), and whether they are muted or not.</p><p>Once done, let&#39;s instantiate the shared <code>global</code> state on the server and attach all clients (i.e. <em>players</em> and <em>controllers</em> to it).</p><h3 id="create-the-shared-instance" tabindex="-1">Create the shared instance <a class="header-anchor" href="#create-the-shared-instance" aria-label="Permalink to &quot;Create the shared instance&quot;">​</a></h3><p>First let&#39;s create the shared instance on the server:</p><ol><li>Import the schema in <code>src/server/index.js</code>:</li></ol><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki monokai has-diff"><code><span class="line"><span style="color:#88846F;">// src/server/index.js</span></span>
<span class="line"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> { loadConfig } </span><span style="color:#F92672;">from</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;../utils/load-config.js&#39;</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;../utils/catch-unhandled-errors.js&#39;</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"></span>
<span class="line diff add"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> globalSchema </span><span style="color:#F92672;">from</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;./schemas/global.js&#39;</span><span style="color:#F8F8F2;">; </span></span></code></pre></div><ol start="2"><li>Register the schema into the state manager and create the <code>global</code> state instance:</li></ol><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki monokai has-highlighted-lines has-diff"><code><span class="line"><span style="color:#88846F;">// src/server/index.js</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> server </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">new</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">Server</span><span style="color:#F8F8F2;">(config);</span></span>
<span class="line"><span style="color:#F8F8F2;">server.</span><span style="color:#A6E22E;">useDefaultApplicationTemplate</span><span style="color:#F8F8F2;">();</span></span>
<span class="line diff add highlighted"><span style="color:#88846F;">// register the global schema </span></span>
<span class="line diff add highlighted"><span style="color:#F8F8F2;">server.stateManager.</span><span style="color:#A6E22E;">registerSchema</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;global&#39;</span><span style="color:#F8F8F2;">, globalSchema); </span></span>
<span class="line"></span>
<span class="line"><span style="color:#F92672;">await</span><span style="color:#F8F8F2;"> server.</span><span style="color:#A6E22E;">start</span><span style="color:#F8F8F2;">();</span></span>
<span class="line diff add highlighted"><span style="color:#88846F;">// create the shared global state instance </span></span>
<span class="line diff add highlighted"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> global </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">await</span><span style="color:#F8F8F2;"> server.stateManager.</span><span style="color:#A6E22E;">create</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;global&#39;</span><span style="color:#F8F8F2;">); </span></span>
<span class="line diff add highlighted"><span style="color:#F8F8F2;">console.</span><span style="color:#A6E22E;">log</span><span style="color:#F8F8F2;">(global.</span><span style="color:#A6E22E;">getValues</span><span style="color:#F8F8F2;">()); </span></span></code></pre></div><p>Let&#39;s now start our server using <code>npm run dev</code>, you should see the current default values of the state logged in the terminal:</p><p><img src="`+r+`" alt="global-server-log"></p><h3 id="attaching-the-global-state-to-the-player-clients" tabindex="-1">Attaching the <code>global</code> state to the <em>player</em> clients <a class="header-anchor" href="#attaching-the-global-state-to-the-player-clients" aria-label="Permalink to &quot;Attaching the \`global\` state to the _player_ clients&quot;">​</a></h3><p>Let&#39;s now attach all our <em>player</em> clients to the global shared state. For now, we will only display its current values on the screen and will keep the actual audio code for later.</p><p>To attach to the <code>global</code> state, write the following snippet in the <code>src/clients/player/index.js</code> file:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki monokai has-diff"><code><span class="line"><span style="color:#88846F;">// src/clients/player/index.js</span></span>
<span class="line"><span style="color:#F92672;">await</span><span style="color:#F8F8F2;"> client.</span><span style="color:#A6E22E;">start</span><span style="color:#F8F8F2;">();</span></span>
<span class="line diff add"><span style="color:#88846F;">// attach to the global state </span></span>
<span class="line diff add"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> global </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">await</span><span style="color:#F8F8F2;"> client.stateManager.</span><span style="color:#A6E22E;">attach</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;global&#39;</span><span style="color:#F8F8F2;">); </span></span></code></pre></div><p>Then, modify the <code>renderApp</code> function provided by the template to log the current values of the global shared state:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki monokai has-highlighted-lines has-diff"><code><span class="line"><span style="color:#88846F;">// src/client/player/index</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> global </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">await</span><span style="color:#F8F8F2;"> client.stateManager.</span><span style="color:#A6E22E;">attach</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;global&#39;</span><span style="color:#F8F8F2;">);</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> $layout </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">createLayout</span><span style="color:#F8F8F2;">(client, $container);</span></span>
<span class="line"></span>
<span class="line highlighted"><span style="color:#66D9EF;font-style:italic;">function</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">renderApp</span><span style="color:#F8F8F2;">() {</span></span>
<span class="line highlighted"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">render</span><span style="color:#F8F8F2;">(</span><span style="color:#A6E22E;">html</span><span style="color:#E6DB74;">\`</span></span>
<span class="line highlighted"><span style="color:#E6DB74;">    &lt;div class=&quot;simple-layout&quot;&gt;</span></span>
<span class="line diff remove highlighted"><span style="color:#E6DB74;">      &lt;p&gt;Hello </span><span style="color:#F92672;">\${</span><span style="color:#F8F8F2;">client.config.app.name</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;">!&lt;/p&gt; </span></span>
<span class="line diff add highlighted"><span style="color:#E6DB74;">      &lt;h2&gt;Global&lt;/h2&gt; </span></span>
<span class="line diff add highlighted"><span style="color:#E6DB74;">      &lt;p&gt;Master: </span><span style="color:#F92672;">\${</span><span style="color:#F8F8F2;">global.</span><span style="color:#A6E22E;">get</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;master&#39;</span><span style="color:#F8F8F2;">)</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;">&lt;/p&gt; </span></span>
<span class="line diff add highlighted"><span style="color:#E6DB74;">      &lt;p&gt;Mute: </span><span style="color:#F92672;">\${</span><span style="color:#F8F8F2;">global.</span><span style="color:#A6E22E;">get</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;mute&#39;</span><span style="color:#F8F8F2;">)</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;">&lt;/p&gt; </span></span>
<span class="line highlighted"><wbr></span>
<span class="line highlighted"><span style="color:#E6DB74;">      &lt;sw-credits .infos=&quot;</span><span style="color:#F92672;">\${</span><span style="color:#F8F8F2;">client.config.app</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;">&quot;&gt;&lt;/sw-credits&gt;</span></span>
<span class="line highlighted"><span style="color:#E6DB74;">    &lt;/div&gt;</span></span>
<span class="line highlighted"><span style="color:#E6DB74;">  \`</span><span style="color:#F8F8F2;">, $container);</span></span>
<span class="line highlighted"><span style="color:#F8F8F2;">}</span></span></code></pre></div><p>Finally, register a callback function to the <a href="https://soundworks.dev/soundworks/client.SharedState.html#onUpdate" target="_blank" rel="noreferrer"><code>onUpdate</code></a> method of the global state, to refresh our screen each time the state is updated:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki monokai has-diff"><code><span class="line"><span style="color:#66D9EF;font-style:italic;">function</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">renderApp</span><span style="color:#F8F8F2;">() {</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#88846F;">// ...</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"></span>
<span class="line diff add"><span style="color:#F8F8F2;">global.</span><span style="color:#A6E22E;">onUpdate</span><span style="color:#F8F8F2;">(() </span><span style="color:#66D9EF;font-style:italic;">=&gt;</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">renderApp</span><span style="color:#F8F8F2;">(), </span><span style="color:#AE81FF;">true</span><span style="color:#F8F8F2;">); </span></span>
<span class="line diff remove"><span style="color:#A6E22E;">renderApp</span><span style="color:#F8F8F2;">(); </span></span></code></pre></div><p>Note that the <code>true</code> passed as second parameter of the <code>onUpdate</code> method means that the given callback will be executed immediately at registration. This allows us to remove the last <code>renderApp()</code> line as we know the <code>renderApp</code> function will be executed at startup of the application.</p><p>If you open a player client at <a href="http://127.0.0.1:8000" target="_blank" rel="noreferrer"><code>http://127.0.0.1:8000</code></a> you should now see the following:</p><p><img src="`+F+`" alt="player-log-global"></p><h3 id="controlling-the-global-shared-states-from-the-controller-clients" tabindex="-1">Controlling the <code>global</code> shared states from the <em>controller</em> clients <a class="header-anchor" href="#controlling-the-global-shared-states-from-the-controller-clients" aria-label="Permalink to &quot;Controlling the \`global\` shared states from the _controller_ clients&quot;">​</a></h3><p>Now that everything is setup on the <em>player</em> side, let&#39;s implement our <em>controller</em> client to be able to control the <code>global</code> state on all connected clients.</p><p>Similarly to what we did with the <em>player</em> clients, let&#39;s open the <code>src/clients/controller/index.js</code> and:</p><ul><li>attach to the <code>global</code> state the same way we did for <em>players</em>,</li><li>make sure the application screen is refreshed when the <code>global</code> state is updated</li></ul><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki monokai has-diff"><code><span class="line"><span style="color:#88846F;">// src/client/controller/index.js</span></span>
<span class="line"><span style="color:#F92672;">await</span><span style="color:#F8F8F2;"> client.</span><span style="color:#A6E22E;">start</span><span style="color:#F8F8F2;">();</span></span>
<span class="line"></span>
<span class="line diff add"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> global </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">await</span><span style="color:#F8F8F2;"> client.stateManager.</span><span style="color:#A6E22E;">attach</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;global&#39;</span><span style="color:#F8F8F2;">); </span></span>
<span class="line"></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">function</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">renderApp</span><span style="color:#F8F8F2;">() {</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#88846F;">// ...</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"></span>
<span class="line diff add"><span style="color:#F8F8F2;">global.</span><span style="color:#A6E22E;">onUpdate</span><span style="color:#F8F8F2;">(() </span><span style="color:#66D9EF;font-style:italic;">=&gt;</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">renderApp</span><span style="color:#F8F8F2;">(), </span><span style="color:#AE81FF;">true</span><span style="color:#F8F8F2;">); </span></span>
<span class="line diff remove"><span style="color:#A6E22E;">renderApp</span><span style="color:#F8F8F2;">(); </span></span></code></pre></div><p>To create the interface, we will again use some components provided by the <a href="https://ircam-ismm.github.io/sc-components/" target="_blank" rel="noreferrer">@ircam/sc-compoents</a> library, which is installed by default by the <em>soundworks</em> wizard. Let&#39;s then first import the components we need (i.e. text, slider and toggle) into our controller&#39;s <code>index.js</code> file:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki monokai has-diff"><code><span class="line"><span style="color:#88846F;">// src/client/controller/index.js</span></span>
<span class="line"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> { html, render } </span><span style="color:#F92672;">from</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;lit&#39;</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;../components/sw-audit.js&#39;</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"></span>
<span class="line diff add"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;@ircam/sc-components/sc-text.js&#39;</span><span style="color:#F8F8F2;">; </span></span>
<span class="line diff add"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;@ircam/sc-components/sc-slider.js&#39;</span><span style="color:#F8F8F2;">; </span></span>
<span class="line diff add"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;@ircam/sc-components/sc-toggle.js&#39;</span><span style="color:#F8F8F2;">; </span></span></code></pre></div><p>Finally, let&#39;s modify the <code>renderApp</code> function by adding the control component to the layout to control the <code>global</code> shared state:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki monokai has-diff"><code><span class="line"><span style="color:#88846F;">// src/client/controller/index.js</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> global </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">await</span><span style="color:#F8F8F2;"> client.stateManager.</span><span style="color:#A6E22E;">attach</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;global&#39;</span><span style="color:#F8F8F2;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">function</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">renderApp</span><span style="color:#F8F8F2;">() {</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">render</span><span style="color:#F8F8F2;">(</span><span style="color:#A6E22E;">html</span><span style="color:#E6DB74;">\`</span></span>
<span class="line"><span style="color:#E6DB74;">    &lt;div class=&quot;controller-layout&quot;&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">      &lt;header&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">        &lt;h1&gt;</span><span style="color:#F92672;">\${</span><span style="color:#F8F8F2;">client.config.app.name</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;"> | </span><span style="color:#F92672;">\${</span><span style="color:#F8F8F2;">client.role</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;">&lt;/h1&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">        &lt;sw-audit .client=&quot;</span><span style="color:#F92672;">\${</span><span style="color:#F8F8F2;">client</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;">&quot;&gt;&lt;/sw-audit&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">      &lt;/header&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">      &lt;section&gt;</span></span>
<span class="line diff remove"><span style="color:#E6DB74;">        &lt;p&gt;Hello </span><span style="color:#F92672;">\${</span><span style="color:#F8F8F2;">client.config.app.name</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;">!&lt;/p&gt; </span></span>
<span class="line diff add"><span style="color:#E6DB74;">        &lt;h2&gt;Global&lt;/h2&gt; </span></span>
<span class="line diff add"><span style="color:#E6DB74;">        &lt;div style=&quot;padding-bottom: 4px&quot;&gt; </span></span>
<span class="line diff add"><span style="color:#E6DB74;">          &lt;sc-text&gt;master&lt;/sc-text&gt; </span></span>
<span class="line diff add"><span style="color:#E6DB74;">          &lt;sc-slider </span></span>
<span class="line diff add"><span style="color:#E6DB74;">            min=</span><span style="color:#F92672;">\${</span><span style="color:#F8F8F2;">global.</span><span style="color:#A6E22E;">getSchema</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;master&#39;</span><span style="color:#F8F8F2;">).min</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;"> </span></span>
<span class="line diff add"><span style="color:#E6DB74;">            max=</span><span style="color:#F92672;">\${</span><span style="color:#F8F8F2;">global.</span><span style="color:#A6E22E;">getSchema</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;master&#39;</span><span style="color:#F8F8F2;">).max</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;"> </span></span>
<span class="line diff add"><span style="color:#E6DB74;">            value=</span><span style="color:#F92672;">\${</span><span style="color:#F8F8F2;">global.</span><span style="color:#A6E22E;">get</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;master&#39;</span><span style="color:#F8F8F2;">)</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;"> </span></span>
<span class="line diff add"><span style="color:#E6DB74;">            @input=</span><span style="color:#F92672;">\${</span><span style="color:#FD971F;font-style:italic;">e</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">=&gt;</span><span style="color:#F8F8F2;"> global.</span><span style="color:#A6E22E;">set</span><span style="color:#F8F8F2;">({ master: e.detail.value })</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;"> </span></span>
<span class="line diff add"><span style="color:#E6DB74;">          &gt;&lt;/sc-slider&gt; </span></span>
<span class="line diff add"><span style="color:#E6DB74;">        &lt;/div&gt; </span></span>
<span class="line diff add"><span style="color:#E6DB74;">        &lt;div style=&quot;padding-bottom: 4px&quot;&gt; </span></span>
<span class="line diff add"><span style="color:#E6DB74;">          &lt;sc-text&gt;mute&lt;/sc-text&gt; </span></span>
<span class="line diff add"><span style="color:#E6DB74;">          &lt;sc-toggle </span></span>
<span class="line diff add"><span style="color:#E6DB74;">            ?active=</span><span style="color:#F92672;">\${</span><span style="color:#F8F8F2;">global.</span><span style="color:#A6E22E;">get</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;mute&#39;</span><span style="color:#F8F8F2;">)</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;"> </span></span>
<span class="line diff add"><span style="color:#E6DB74;">            @change=</span><span style="color:#F92672;">\${</span><span style="color:#FD971F;font-style:italic;">e</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">=&gt;</span><span style="color:#F8F8F2;"> global.</span><span style="color:#A6E22E;">set</span><span style="color:#F8F8F2;">({ mute: e.detail.value })</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;"> </span></span>
<span class="line diff add"><span style="color:#E6DB74;">          &gt;&lt;/sc-toggle&gt; </span></span>
<span class="line diff add"><span style="color:#E6DB74;">        &lt;/div&gt; </span></span>
<span class="line"><span style="color:#E6DB74;">      &lt;/section&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">    &lt;/div&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">  \`</span><span style="color:#F8F8F2;">, $container);</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">global.</span><span style="color:#A6E22E;">onUpdate</span><span style="color:#F8F8F2;">(() </span><span style="color:#66D9EF;font-style:italic;">=&gt;</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">renderApp</span><span style="color:#F8F8F2;">(), </span><span style="color:#AE81FF;">true</span><span style="color:#F8F8F2;">);</span></span></code></pre></div><p>Now, if you open a <code>player</code> (<a href="http://127.0.0.1:8000" target="_blank" rel="noreferrer"><code>http://127.0.0.1:8000</code></a>) and a <code>controller</code> (<a href="http://127.0.0.1:8000/controller" target="_blank" rel="noreferrer"><code>http://127.0.0.1:8000/controller</code></a>) in two different windows side by side, you should be able to remote control the <em>player</em> from the <em>controller</em>:</p><p><img src="`+i+`" alt="global-player-controller"></p><h2 id="creating-and-using-the-player-shared-states" tabindex="-1">Creating and using the <code>player</code> shared states <a class="header-anchor" href="#creating-and-using-the-player-shared-states" aria-label="Permalink to &quot;Creating and using the \`player\` shared states&quot;">​</a></h2><p>As defined in our user story, we want the <em>player</em> clients to have some controls on their own interface. But importantly we also want to be able to take control over any <em>player</em> remotely to simplify and fasten our development and creation process.</p><p>Indeed, once you start working with multiple physical devices (smartphones, tablets, etc.), being able to control each of them from a single central point can save you a lot of testing time. Time that will be better used to make your artwork and experience more interesting.</p><h3 id="registering-the-schema-and-creating-the-states" tabindex="-1">Registering the schema and creating the states <a class="header-anchor" href="#registering-the-schema-and-creating-the-states" aria-label="Permalink to &quot;Registering the schema and creating the states&quot;">​</a></h3><p>To that end, we will define and register another schema, from which we will create a new state state for each connected <em>players</em>. Let&#39;s then create a new <code>src/server/schemas/player.js</code> file with the following snippet:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki monokai has-diff"><code><span class="line"><span style="color:#88846F;">// src/server/schemas/player.js</span></span>
<span class="line diff add"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">default</span><span style="color:#F8F8F2;"> { </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">  id: { </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">    type: </span><span style="color:#E6DB74;">&#39;integer&#39;</span><span style="color:#F8F8F2;">, </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">    default: </span><span style="color:#AE81FF;">null</span><span style="color:#F8F8F2;">, </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">    nullable: </span><span style="color:#AE81FF;">true</span><span style="color:#F8F8F2;">, </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">  }, </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">  frequency: { </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">    type: </span><span style="color:#E6DB74;">&#39;float&#39;</span><span style="color:#F8F8F2;">, </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">    default: </span><span style="color:#AE81FF;">200</span><span style="color:#F8F8F2;">, </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">    min: </span><span style="color:#AE81FF;">50</span><span style="color:#F8F8F2;">, </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">    max: </span><span style="color:#AE81FF;">2000</span><span style="color:#F8F8F2;">, </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">  }, </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">  synthToggle: { </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">    type: </span><span style="color:#E6DB74;">&#39;boolean&#39;</span><span style="color:#F8F8F2;">, </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">    default: </span><span style="color:#AE81FF;">false</span><span style="color:#F8F8F2;">, </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">    immediate: </span><span style="color:#AE81FF;">true</span><span style="color:#F8F8F2;">, </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">  }, </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">  synthTrigger: { </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">    type: </span><span style="color:#E6DB74;">&#39;boolean&#39;</span><span style="color:#F8F8F2;">, </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">    event: </span><span style="color:#AE81FF;">true</span><span style="color:#F8F8F2;">, </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">    immediate: </span><span style="color:#AE81FF;">true</span><span style="color:#F8F8F2;">, </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">  }, </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">}; </span></span></code></pre></div><p>Then, just as with the <code>global</code> schema, import it and register the schema in the server&#39;s stateManager:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki monokai has-diff"><code><span class="line"><span style="color:#88846F;">// src/server/index.js</span></span>
<span class="line"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> globalSchema </span><span style="color:#F92672;">from</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;./schemas/global.js&#39;</span><span style="color:#F8F8F2;">;</span></span>
<span class="line diff add"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> playerSchema </span><span style="color:#F92672;">from</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;./schemas/player.js&#39;</span><span style="color:#F8F8F2;">; </span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;">// ...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">server.stateManager.</span><span style="color:#A6E22E;">registerSchema</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;global&#39;</span><span style="color:#F8F8F2;">, globalSchema);</span></span>
<span class="line diff add"><span style="color:#F8F8F2;">server.stateManager.</span><span style="color:#A6E22E;">registerSchema</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;player&#39;</span><span style="color:#F8F8F2;">, playerSchema); </span></span></code></pre></div><p>The parameters of the <code>player</code> shared states will allow us to implement two different types of synthesizer with very common behavior: one that is triggered by an event (e.g. playing back a simple sound file, see <code>synthTrigger</code>) and a second one that can be started and stopped (e.g. playing a sound file in a loop, see <code>synthToggle</code>). To keep the audio code simple and focus on the architecture and the logic of the application, we will create very simple synthesizers based on oscillators and use the same <code>frequency</code> value for the two synths.</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>Note the <code>immediate</code> attribute for the <code>synthToggle</code> and <code>synthTrigger</code> which is one of the different options that can be applied to tweak the shared states behavior. In this case <code>immediate</code> means that the value is propagated locally before being propagated on the network to keep the latency and responsiveness of the interface to the minimum. See the different <a href="https://soundworks.dev/soundworks/server.StateManager.html#~schema" target="_blank" rel="noreferrer">schema type definitions</a> for more information on the different options.</p></div><p>So let&#39;s first create a new <code>player</code> state on each <code>player</code> client. To that end, add the following snippet in <code>src/clients/player/index.js</code>:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki monokai has-highlighted-lines has-diff"><code><span class="line"><span style="color:#88846F;">// src/clients/player/index.js</span></span>
<span class="line"><span style="color:#F92672;">await</span><span style="color:#F8F8F2;"> client.</span><span style="color:#A6E22E;">start</span><span style="color:#F8F8F2;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> global </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">await</span><span style="color:#F8F8F2;"> client.stateManager.</span><span style="color:#A6E22E;">attach</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;global&#39;</span><span style="color:#F8F8F2;">);</span></span>
<span class="line diff add highlighted"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> player </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">await</span><span style="color:#F8F8F2;"> client.stateManager.</span><span style="color:#A6E22E;">create</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;player&#39;</span><span style="color:#F8F8F2;">, { </span></span>
<span class="line diff add highlighted"><span style="color:#F8F8F2;">  id: client.id, </span></span>
<span class="line diff add highlighted"><span style="color:#F8F8F2;">}); </span></span></code></pre></div><p>The second argument passed to the <code>stateManager.create</code> method allows to define initialization values of the state. Here, we simply pass the <code>client.id</code> generated by <code>soundworks</code> to the state so we can easily track which <code>player</code> shared state is bound to which client.</p><h3 id="creating-the-graphical-user-interface" tabindex="-1">Creating the graphical user interface <a class="header-anchor" href="#creating-the-graphical-user-interface" aria-label="Permalink to &quot;Creating the graphical user interface&quot;">​</a></h3><p>Then, let&#39;s create the <code>player</code> shared state control interface. To that end, we will create a simple Web Component using the <code>Lit</code> library. Creating this abstraction will allow us to simply reuse the component later in the <em>controller</em> interface to remotely take control over any connected <em>player</em>.</p><p>Let&#39;s then create a new file called <code>sw-player.js</code> in the <code>src/clients/components</code> directory, with the following code:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki monokai"><code><span class="line"><span style="color:#88846F;">// src/clients/components/sw-player.js</span></span>
<span class="line"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> { LitElement, html, css } </span><span style="color:#F92672;">from</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;lit&#39;</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;">// import needed GUI components</span></span>
<span class="line"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;@ircam/sc-components/sc-text.js&#39;</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;@ircam/sc-components/sc-slider.js&#39;</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;@ircam/sc-components/sc-toggle.js&#39;</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;@ircam/sc-components/sc-bang.js&#39;</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">class</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;text-decoration:underline;">SwPlayer</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">extends</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;font-style:italic;text-decoration:underline;">LitElement</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#66D9EF;font-style:italic;">constructor</span><span style="color:#F8F8F2;">() {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#FD971F;">super</span><span style="color:#F8F8F2;">();</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#88846F;">// reference to the \`player\` state</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#FD971F;">this</span><span style="color:#F8F8F2;">.player </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#AE81FF;">null</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#88846F;">// stores the \`unsubscribe\` callback returned by the \`state.onUpdate\` methos</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#88846F;">// https://soundworks.dev/soundworks/client.SharedState.html#onUpdate</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#FD971F;">this</span><span style="color:#F8F8F2;">.unobserve </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#AE81FF;">null</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">connectedCallback</span><span style="color:#F8F8F2;">() {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#FD971F;">super</span><span style="color:#F8F8F2;">.</span><span style="color:#A6E22E;">connectedCallback</span><span style="color:#F8F8F2;">();</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#88846F;">// update the component when a state change occurs</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#FD971F;">this</span><span style="color:#F8F8F2;">.unobserve </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#FD971F;">this</span><span style="color:#F8F8F2;">.player.</span><span style="color:#A6E22E;">onUpdate</span><span style="color:#F8F8F2;">(() </span><span style="color:#66D9EF;font-style:italic;">=&gt;</span><span style="color:#F8F8F2;"> </span><span style="color:#FD971F;">this</span><span style="color:#F8F8F2;">.</span><span style="color:#A6E22E;">requestUpdate</span><span style="color:#F8F8F2;">());</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">disconnectedCallback</span><span style="color:#F8F8F2;">() {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#FD971F;">super</span><span style="color:#F8F8F2;">.</span><span style="color:#A6E22E;">disconnectedCallback</span><span style="color:#F8F8F2;">();</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#88846F;">// stop reacting to state change when the element is removed from the DOM</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#FD971F;">this</span><span style="color:#F8F8F2;">.</span><span style="color:#A6E22E;">unobserve</span><span style="color:#F8F8F2;">();</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">render</span><span style="color:#F8F8F2;">() {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#88846F;">// create controls for the player state</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#F92672;">return</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">html</span><span style="color:#E6DB74;">\`</span></span>
<span class="line"><span style="color:#E6DB74;">      &lt;h2&gt;Player [id: </span><span style="color:#F92672;">\${</span><span style="color:#FD971F;">this</span><span style="color:#F8F8F2;">.player.</span><span style="color:#A6E22E;">get</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;id&#39;</span><span style="color:#F8F8F2;">)</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;">]&lt;/h2&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">      &lt;div style=&quot;padding-bottom: 4px;&quot;&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">        &lt;sc-text&gt;Frequency&lt;/sc-text&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">        &lt;sc-slider</span></span>
<span class="line"><span style="color:#E6DB74;">          width=&quot;400&quot;</span></span>
<span class="line"><span style="color:#E6DB74;">          min=</span><span style="color:#F92672;">\${</span><span style="color:#FD971F;">this</span><span style="color:#F8F8F2;">.player.</span><span style="color:#A6E22E;">getSchema</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;frequency&#39;</span><span style="color:#F8F8F2;">).min</span><span style="color:#F92672;">}</span></span>
<span class="line"><span style="color:#E6DB74;">          max=</span><span style="color:#F92672;">\${</span><span style="color:#FD971F;">this</span><span style="color:#F8F8F2;">.player.</span><span style="color:#A6E22E;">getSchema</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;frequency&#39;</span><span style="color:#F8F8F2;">).max</span><span style="color:#F92672;">}</span></span>
<span class="line"><span style="color:#E6DB74;">          value=</span><span style="color:#F92672;">\${</span><span style="color:#FD971F;">this</span><span style="color:#F8F8F2;">.player.</span><span style="color:#A6E22E;">get</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;frequency&#39;</span><span style="color:#F8F8F2;">)</span><span style="color:#F92672;">}</span></span>
<span class="line"><span style="color:#E6DB74;">          @input=</span><span style="color:#F92672;">\${</span><span style="color:#FD971F;font-style:italic;">e</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">=&gt;</span><span style="color:#F8F8F2;"> </span><span style="color:#FD971F;">this</span><span style="color:#F8F8F2;">.player.</span><span style="color:#A6E22E;">set</span><span style="color:#F8F8F2;">({ frequency: e.detail.value })</span><span style="color:#F92672;">}</span></span>
<span class="line"><span style="color:#E6DB74;">        &gt;&lt;/sc-slider&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">      &lt;/div&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">      &lt;div style=&quot;padding-bottom: 4px;&quot;&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">        &lt;sc-text&gt;Start / Stop synth&lt;/sc-text&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">        &lt;sc-toggle</span></span>
<span class="line"><span style="color:#E6DB74;">          ?active=</span><span style="color:#F92672;">\${</span><span style="color:#FD971F;">this</span><span style="color:#F8F8F2;">.player.</span><span style="color:#A6E22E;">get</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;synthToggle&#39;</span><span style="color:#F8F8F2;">)</span><span style="color:#F92672;">}</span></span>
<span class="line"><span style="color:#E6DB74;">          @change=</span><span style="color:#F92672;">\${</span><span style="color:#FD971F;font-style:italic;">e</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">=&gt;</span><span style="color:#F8F8F2;"> </span><span style="color:#FD971F;">this</span><span style="color:#F8F8F2;">.player.</span><span style="color:#A6E22E;">set</span><span style="color:#F8F8F2;">({ synthToggle: e.detail.value })</span><span style="color:#F92672;">}</span></span>
<span class="line"><span style="color:#E6DB74;">        &gt;&lt;/sc-toggle&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">      &lt;/div&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">      &lt;div style=&quot;padding-bottom: 4px;&quot;&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">        &lt;sc-text&gt;Trigger Synth&lt;/sc-text&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">        &lt;sc-bang</span></span>
<span class="line"><span style="color:#E6DB74;">          ?active=</span><span style="color:#F92672;">\${</span><span style="color:#FD971F;">this</span><span style="color:#F8F8F2;">.player.</span><span style="color:#A6E22E;">get</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;synthTrigger&#39;</span><span style="color:#F8F8F2;">)</span><span style="color:#F92672;">}</span></span>
<span class="line"><span style="color:#E6DB74;">          @input=</span><span style="color:#F92672;">\${</span><span style="color:#FD971F;font-style:italic;">e</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">=&gt;</span><span style="color:#F8F8F2;"> </span><span style="color:#FD971F;">this</span><span style="color:#F8F8F2;">.player.</span><span style="color:#A6E22E;">set</span><span style="color:#F8F8F2;">({ synthTrigger: e.detail.value })</span><span style="color:#F92672;">}</span></span>
<span class="line"><span style="color:#E6DB74;">        &gt;&lt;/sc-bang&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">      &lt;/div&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">    \`</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;">// register the component into the custom elements registry</span></span>
<span class="line"><span style="color:#F8F8F2;">customElements.</span><span style="color:#A6E22E;">define</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;sw-player&#39;</span><span style="color:#F8F8F2;">, SwPlayer);</span></span></code></pre></div><p>Once done, we only need to import our new component and insert it into our application template:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki monokai has-diff"><code><span class="line"><span style="color:#88846F;">// src/clients/player/index.js</span></span>
<span class="line"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> { html, render } </span><span style="color:#F92672;">from</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;lit&#39;</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;../components/sw-credits.js&#39;</span><span style="color:#F8F8F2;">;</span></span>
<span class="line diff add"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;../components/sw-player.js&#39;</span><span style="color:#F8F8F2;">; </span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;">// ...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">function</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">renderApp</span><span style="color:#F8F8F2;">() {</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">render</span><span style="color:#F8F8F2;">(</span><span style="color:#A6E22E;">html</span><span style="color:#E6DB74;">\`</span></span>
<span class="line"><span style="color:#E6DB74;">    &lt;div class=&quot;simple-layout&quot;&gt;</span></span>
<span class="line diff add"><span style="color:#E6DB74;">      &lt;sw-player .player=</span><span style="color:#F92672;">\${</span><span style="color:#F8F8F2;">player</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;">&gt;&lt;/sw-player&gt; </span></span>
<span class="line"></span>
<span class="line"><span style="color:#E6DB74;">      &lt;h2&gt;Global&lt;/h2&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">      &lt;p&gt;Master: </span><span style="color:#F92672;">\${</span><span style="color:#F8F8F2;">global.</span><span style="color:#A6E22E;">get</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;master&#39;</span><span style="color:#F8F8F2;">)</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;">&lt;/p&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">      &lt;p&gt;Mute: </span><span style="color:#F92672;">\${</span><span style="color:#F8F8F2;">global.</span><span style="color:#A6E22E;">get</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;mute&#39;</span><span style="color:#F8F8F2;">)</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;">&lt;/p&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E6DB74;">      &lt;sw-credits .infos=&quot;</span><span style="color:#F92672;">\${</span><span style="color:#F8F8F2;">client.config.app</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;">&quot;&gt;&lt;/sw-credits&gt; </span></span>
<span class="line"><span style="color:#E6DB74;">    &lt;/div&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">  \`</span><span style="color:#F8F8F2;">, $container);</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre></div><p>After refreshing the page, your player should now look like the following:</p><p><img src="`+y+`" alt="player-full"></p><h2 id="creating-the-synthesizers" tabindex="-1">Creating the synthesizers <a class="header-anchor" href="#creating-the-synthesizers" aria-label="Permalink to &quot;Creating the synthesizers&quot;">​</a></h2><p>Everything is now ready to react to both the <code>player</code> and <code>global</code> states changes to play some sounds on our <em>player</em> clients.</p><h3 id="resume-the-context-with-the-platform-init-plugin" tabindex="-1">Resume the context with the <code>platform-init</code> plugin <a class="header-anchor" href="#resume-the-context-with-the-platform-init-plugin" aria-label="Permalink to &quot;Resume the context with the \`platform-init\` plugin&quot;">​</a></h3><p>First thing first, let&#39;s instantiate a new <code>AudioContext</code>:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki monokai has-diff"><code><span class="line"><span style="color:#88846F;">// src/clients/player/index.js</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> config </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> window.SOUNDWORKS_CONFIG;</span></span>
<span class="line diff add"><span style="color:#88846F;">// If multiple clients are emulated you might to want to share the audio context </span></span>
<span class="line diff add"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> audioContext </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">new</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">AudioContext</span><span style="color:#F8F8F2;">(); </span></span>
<span class="line"></span>
<span class="line"><span style="color:#F92672;">async</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">function</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">main</span><span style="color:#F8F8F2;">(</span><span style="color:#FD971F;font-style:italic;">$container</span><span style="color:#F8F8F2;">) {</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#88846F;">// ...</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>You can see that the <code>AudioContext</code> is created outside our <code>main</code> function, this allows to share the same context when we emulate several clients on the same page.</p></div><p>As seen in the <a href="./plugin-platform-init.html">platform-init plugin</a> tutorial, the audio context needs a user gesture to be resumed and be allowed to produce sound by the browser, so let&#39;s just import and configure it properly (remember that we have already asked the wizard to install it at the beginning of the tutorial).</p><p>Let&#39;s start with the server side:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki monokai has-diff"><code><span class="line"><span style="color:#88846F;">// src/server/index.js</span></span>
<span class="line diff add"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> pluginPlatformInit </span><span style="color:#F92672;">from</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;@soundworks/plugin-platform-init/server.js&#39;</span><span style="color:#F8F8F2;">; </span></span>
<span class="line"></span>
<span class="line"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> globalSchema </span><span style="color:#F92672;">from</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;./schemas/global.js&#39;</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> playerSchema </span><span style="color:#F92672;">from</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;./schemas/player.js&#39;</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;">// ...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> server </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">new</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">Server</span><span style="color:#F8F8F2;">(config);</span></span>
<span class="line"><span style="color:#F8F8F2;">server.</span><span style="color:#A6E22E;">useDefaultApplicationTemplate</span><span style="color:#F8F8F2;">();</span></span>
<span class="line"></span>
<span class="line diff add"><span style="color:#F8F8F2;">server.pluginManager.</span><span style="color:#A6E22E;">register</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;platform-init&#39;</span><span style="color:#F8F8F2;">, pluginPlatformInit); </span></span></code></pre></div><p>And do the same on the client side:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki monokai has-diff"><code><span class="line"><span style="color:#88846F;">// src/clients/player/index.js</span></span>
<span class="line"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> { Client } </span><span style="color:#F92672;">from</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;@soundworks/core/client.js&#39;</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> launcher </span><span style="color:#F92672;">from</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;@soundworks/helpers/launcher.js&#39;</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"></span>
<span class="line diff add"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> pluginPlatformInit </span><span style="color:#F92672;">from</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;@soundworks/plugin-platform-init/client.js&#39;</span><span style="color:#F8F8F2;">; </span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;">// ...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> client </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">new</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">Client</span><span style="color:#F8F8F2;">(config);</span></span>
<span class="line diff add"><span style="color:#88846F;">// register the platform-init plugin, and pass it the AudioContext instance </span></span>
<span class="line diff add"><span style="color:#88846F;">// so that it is resumed on the splashscreen user gesture </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">client.pluginManager.</span><span style="color:#A6E22E;">register</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;platform-init&#39;</span><span style="color:#F8F8F2;">, pluginPlatformInit, {  </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">  audioContext  </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">}); </span></span></code></pre></div><h3 id="create-the-master-chain" tabindex="-1">Create the master chain <a class="header-anchor" href="#create-the-master-chain" aria-label="Permalink to &quot;Create the master chain&quot;">​</a></h3><p>Then let&#39;s start by creating our &quot;master bus&quot; audio chain, which will be controlled by the <code>global</code> state: a <a href="https://developer.mozilla.org/en-US/docs/Web/API/GainNode" target="_blank" rel="noreferrer"><code>GainNode</code></a> for the <code>master</code> volume parameter, and another one for the <code>mute</code> parameter:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki monokai has-diff"><code><span class="line"><span style="color:#88846F;">// src/clients/player/index.js</span></span>
<span class="line diff add"><span style="color:#88846F;">// create the master bus chain </span></span>
<span class="line diff add"><span style="color:#88846F;">// [mute &lt;GainNode&gt;] -&gt; [master &lt;GainNode&gt;] -&gt; [destination] </span></span>
<span class="line diff add"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> master </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> audioContext.</span><span style="color:#A6E22E;">createGain</span><span style="color:#F8F8F2;">(); </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">master.gain.value </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> global.</span><span style="color:#A6E22E;">get</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;master&#39;</span><span style="color:#F8F8F2;">); </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">master.</span><span style="color:#A6E22E;">connect</span><span style="color:#F8F8F2;">(audioContext.destination); </span></span>
<span class="line diff add"><span style="color:#F8F8F2;"> </span></span>
<span class="line diff add"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> mute </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> audioContext.</span><span style="color:#A6E22E;">createGain</span><span style="color:#F8F8F2;">(); </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">mute.gain.value </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> global.</span><span style="color:#A6E22E;">get</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;mute&#39;</span><span style="color:#F8F8F2;">) </span><span style="color:#F92672;">?</span><span style="color:#F8F8F2;"> </span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#AE81FF;">1</span><span style="color:#F8F8F2;">; </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">mute.</span><span style="color:#A6E22E;">connect</span><span style="color:#F8F8F2;">(master); </span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;">// update the view each time the global state is changed</span></span>
<span class="line"><span style="color:#F8F8F2;">global.</span><span style="color:#A6E22E;">onUpdate</span><span style="color:#F8F8F2;">(() </span><span style="color:#66D9EF;font-style:italic;">=&gt;</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">renderApp</span><span style="color:#F8F8F2;">(), </span><span style="color:#AE81FF;">true</span><span style="color:#F8F8F2;">);</span></span></code></pre></div><p>Now, let&#39;s modify our <code>global.onUpdate</code> callback, so that all updates are applied on the audio nodes:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki monokai has-diff"><code><span class="line diff remove"><span style="color:#F8F8F2;">global.</span><span style="color:#A6E22E;">onUpdate</span><span style="color:#F8F8F2;">(() </span><span style="color:#66D9EF;font-style:italic;">=&gt;</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">renderApp</span><span style="color:#F8F8F2;">(), </span><span style="color:#AE81FF;">true</span><span style="color:#F8F8F2;">); </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">global.</span><span style="color:#A6E22E;">onUpdate</span><span style="color:#F8F8F2;">(</span><span style="color:#FD971F;font-style:italic;">updates</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">=&gt;</span><span style="color:#F8F8F2;"> {  </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">  </span><span style="color:#F92672;">for</span><span style="color:#F8F8F2;"> (</span><span style="color:#66D9EF;font-style:italic;">let</span><span style="color:#F8F8F2;"> key </span><span style="color:#F92672;">in</span><span style="color:#F8F8F2;"> updates) {  </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">    </span><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> value </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> updates[key];  </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">  </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">    </span><span style="color:#F92672;">switch</span><span style="color:#F8F8F2;"> (key) {  </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">      </span><span style="color:#F92672;">case</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;master&#39;</span><span style="color:#F8F8F2;">: {  </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">        </span><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> now </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> audioContext.currentTime;  </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">        master.gain.</span><span style="color:#A6E22E;">setTargetAtTime</span><span style="color:#F8F8F2;">(value, now, </span><span style="color:#AE81FF;">0.02</span><span style="color:#F8F8F2;">);  </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">        </span><span style="color:#F92672;">break</span><span style="color:#F8F8F2;">;  </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">      }  </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">      </span><span style="color:#F92672;">case</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;mute&#39;</span><span style="color:#F8F8F2;">: {  </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">        </span><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> gain </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> value </span><span style="color:#F92672;">?</span><span style="color:#F8F8F2;"> </span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#AE81FF;">1</span><span style="color:#F8F8F2;">;  </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">        </span><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> now </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> audioContext.currentTime;  </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">        mute.gain.</span><span style="color:#A6E22E;">setTargetAtTime</span><span style="color:#F8F8F2;">(gain, now, </span><span style="color:#AE81FF;">0.02</span><span style="color:#F8F8F2;">);  </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">        </span><span style="color:#F92672;">break</span><span style="color:#F8F8F2;">;  </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">      }  </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">    }  </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">  }  </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">  </span><span style="color:#88846F;">// update the view to log current global values  </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">renderApp</span><span style="color:#F8F8F2;">();  </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">}, </span><span style="color:#AE81FF;">true</span><span style="color:#F8F8F2;">);  </span></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>The <a href="https://developer.mozilla.org/en-US/docs/Web/API/AudioParam/setTargetAtTime" target="_blank" rel="noreferrer"><code>AudioParam:setTargetAtTime</code></a> method is a very useful automation method to control audio parameters in real-time without click and pops.</p></div><p>To test that everything works as expected, let&#39;s add a simple oscillator at the beginning of our master chain:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki monokai has-diff"><code><span class="line"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> mute </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> audioContext.</span><span style="color:#A6E22E;">createGain</span><span style="color:#F8F8F2;">();</span></span>
<span class="line"><span style="color:#F8F8F2;">mute.gain.value </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> global.</span><span style="color:#A6E22E;">get</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;mute&#39;</span><span style="color:#F8F8F2;">) </span><span style="color:#F92672;">?</span><span style="color:#F8F8F2;"> </span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#AE81FF;">1</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F8F8F2;">mute.</span><span style="color:#A6E22E;">connect</span><span style="color:#F8F8F2;">(master)</span></span>
<span class="line"></span>
<span class="line diff add"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> osc </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> audioContext.</span><span style="color:#A6E22E;">createOscillator</span><span style="color:#F8F8F2;">(); </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">osc.</span><span style="color:#A6E22E;">connect</span><span style="color:#F8F8F2;">(mute); </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">osc.</span><span style="color:#A6E22E;">start</span><span style="color:#F8F8F2;">(); </span></span></code></pre></div><p>If you open one or several <em>players</em>, <a href="http://127.0.0.1:8000" target="_blank" rel="noreferrer">http://127.0.0.1:8000</a>, and a <em>controller</em>, <a href="http://127.0.0.1:8000/controler" target="_blank" rel="noreferrer">http://127.0.0.1:8000/controller</a>, side by side, you should hear that you can control the general volume of the <em>player</em> client as well as mute them all at once!</p><p>Don&#39;t forget to remove this test snippet before going to the next step...</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki monokai has-diff"><code><span class="line diff remove"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> osc </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> audioContext.</span><span style="color:#A6E22E;">createOscillator</span><span style="color:#F8F8F2;">(); </span></span>
<span class="line diff remove"><span style="color:#F8F8F2;">osc.</span><span style="color:#A6E22E;">connect</span><span style="color:#F8F8F2;">(mute); </span></span>
<span class="line diff remove"><span style="color:#F8F8F2;">osc.</span><span style="color:#A6E22E;">start</span><span style="color:#F8F8F2;">(); </span></span></code></pre></div><h3 id="implement-the-two-synths" tabindex="-1">Implement the two synths <a class="header-anchor" href="#implement-the-two-synths" aria-label="Permalink to &quot;Implement the two synths&quot;">​</a></h3><p>Now that all the structure is ready, we can finally implement our two synths.</p><p>To keep things simple and focus on the general architecture we will only create simple synths based on oscillators, however the exact same principles could be used for more complex synthesizers with numerous parameters.</p><p>Let&#39;s then implement the <code>onUpdate</code> callback of our <code>player</code> shared state that will handle all the audio synthesis:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki monokai has-diff"><code><span class="line"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> mute </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> audioContext.</span><span style="color:#A6E22E;">createGain</span><span style="color:#F8F8F2;">();</span></span>
<span class="line"><span style="color:#F8F8F2;">mute.gain.value </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> global.</span><span style="color:#A6E22E;">get</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;mute&#39;</span><span style="color:#F8F8F2;">) </span><span style="color:#F92672;">?</span><span style="color:#F8F8F2;"> </span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#AE81FF;">1</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F8F8F2;">mute.</span><span style="color:#A6E22E;">connect</span><span style="color:#F8F8F2;">(master);</span></span>
<span class="line"></span>
<span class="line diff add"><span style="color:#66D9EF;font-style:italic;">let</span><span style="color:#F8F8F2;"> synthToggle </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#AE81FF;">null</span><span style="color:#F8F8F2;">; </span></span>
<span class="line diff add"><span style="color:#F8F8F2;"> </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">player.</span><span style="color:#A6E22E;">onUpdate</span><span style="color:#F8F8F2;">(</span><span style="color:#FD971F;font-style:italic;">updates</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">=&gt;</span><span style="color:#F8F8F2;"> { </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">  </span><span style="color:#F92672;">for</span><span style="color:#F8F8F2;"> (</span><span style="color:#66D9EF;font-style:italic;">let</span><span style="color:#F8F8F2;"> key </span><span style="color:#F92672;">in</span><span style="color:#F8F8F2;"> updates) { </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">    </span><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> value </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> updates[key]; </span></span>
<span class="line diff add"><span style="color:#F8F8F2;"> </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">    </span><span style="color:#F92672;">switch</span><span style="color:#F8F8F2;"> (key) { </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">      </span><span style="color:#F92672;">case</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;synthToggle&#39;</span><span style="color:#F8F8F2;">: { </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">        </span><span style="color:#F92672;">if</span><span style="color:#F8F8F2;"> (value </span><span style="color:#F92672;">===</span><span style="color:#F8F8F2;"> </span><span style="color:#AE81FF;">true</span><span style="color:#F8F8F2;">) { </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">          </span><span style="color:#88846F;">// start the synth </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">          synthToggle </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> audioContext.</span><span style="color:#A6E22E;">createOscillator</span><span style="color:#F8F8F2;">(); </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">          synthToggle.</span><span style="color:#A6E22E;">connect</span><span style="color:#F8F8F2;">(mute); </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">          synthToggle.frequency.value </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> player.</span><span style="color:#A6E22E;">get</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;frequency&#39;</span><span style="color:#F8F8F2;">); </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">          synthToggle.</span><span style="color:#A6E22E;">start</span><span style="color:#F8F8F2;">(); </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">        } </span><span style="color:#F92672;">else</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">if</span><span style="color:#F8F8F2;"> (synthToggle </span><span style="color:#F92672;">!==</span><span style="color:#F8F8F2;"> </span><span style="color:#AE81FF;">null</span><span style="color:#F8F8F2;">) { </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">          </span><span style="color:#88846F;">// stop the synth </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">          synthToggle.</span><span style="color:#A6E22E;">stop</span><span style="color:#F8F8F2;">(); </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">          synthToggle </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#AE81FF;">null</span><span style="color:#F8F8F2;">; </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">        } </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">        </span><span style="color:#F92672;">break</span><span style="color:#F8F8F2;">; </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">      } </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">      </span><span style="color:#F92672;">case</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;frequency&#39;</span><span style="color:#F8F8F2;">: { </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">        </span><span style="color:#88846F;">// update the start / stop synth frequency if it is runnings </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">        </span><span style="color:#F92672;">if</span><span style="color:#F8F8F2;"> (synthToggle </span><span style="color:#F92672;">!==</span><span style="color:#F8F8F2;"> </span><span style="color:#AE81FF;">null</span><span style="color:#F8F8F2;">) { </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">          </span><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> now </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> audioContext.currentTime; </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">          synthToggle.frequency.</span><span style="color:#A6E22E;">setTargetAtTime</span><span style="color:#F8F8F2;">(value, now, </span><span style="color:#AE81FF;">0.02</span><span style="color:#F8F8F2;">); </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">        } </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">        </span><span style="color:#F92672;">break</span><span style="color:#F8F8F2;">; </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">      } </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">      </span><span style="color:#F92672;">case</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;synthTrigger&#39;</span><span style="color:#F8F8F2;">: { </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">        </span><span style="color:#F92672;">if</span><span style="color:#F8F8F2;"> (value </span><span style="color:#F92672;">!==</span><span style="color:#F8F8F2;"> </span><span style="color:#AE81FF;">null</span><span style="color:#F8F8F2;">) { </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">          </span><span style="color:#88846F;">// trigger a 1 second sound at twice the frequency </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">          </span><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> now </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> audioContext.currentTime; </span></span>
<span class="line diff add"><span style="color:#F8F8F2;"> </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">          </span><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> env </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> audioContext.</span><span style="color:#A6E22E;">createGain</span><span style="color:#F8F8F2;">(); </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">          env.</span><span style="color:#A6E22E;">connect</span><span style="color:#F8F8F2;">(mute); </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">          env.gain.value </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">; </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">          env.gain.</span><span style="color:#A6E22E;">setValueAtTime</span><span style="color:#F8F8F2;">(</span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">, now); </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">          env.gain.</span><span style="color:#A6E22E;">linearRampToValueAtTime</span><span style="color:#F8F8F2;">(</span><span style="color:#AE81FF;">1</span><span style="color:#F8F8F2;">, now </span><span style="color:#F92672;">+</span><span style="color:#F8F8F2;"> </span><span style="color:#AE81FF;">0.01</span><span style="color:#F8F8F2;">); </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">          env.gain.</span><span style="color:#A6E22E;">exponentialRampToValueAtTime</span><span style="color:#F8F8F2;">(</span><span style="color:#AE81FF;">0.001</span><span style="color:#F8F8F2;">, now </span><span style="color:#F92672;">+</span><span style="color:#F8F8F2;"> </span><span style="color:#AE81FF;">1</span><span style="color:#F8F8F2;">); </span></span>
<span class="line diff add"><span style="color:#F8F8F2;"> </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">          </span><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> osc </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> audioContext.</span><span style="color:#A6E22E;">createOscillator</span><span style="color:#F8F8F2;">(); </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">          osc.</span><span style="color:#A6E22E;">connect</span><span style="color:#F8F8F2;">(env); </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">          osc.frequency.value </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> player.</span><span style="color:#A6E22E;">get</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;frequency&#39;</span><span style="color:#F8F8F2;">) </span><span style="color:#F92672;">*</span><span style="color:#F8F8F2;"> </span><span style="color:#AE81FF;">2</span><span style="color:#F8F8F2;">; </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">          osc.</span><span style="color:#A6E22E;">start</span><span style="color:#F8F8F2;">(now); </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">          osc.</span><span style="color:#A6E22E;">stop</span><span style="color:#F8F8F2;">(now </span><span style="color:#F92672;">+</span><span style="color:#F8F8F2;"> </span><span style="color:#AE81FF;">1</span><span style="color:#F8F8F2;">); </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">        } </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">        </span><span style="color:#F92672;">break</span><span style="color:#F8F8F2;">; </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">      } </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">    } </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">  } </span></span>
<span class="line diff add"><span style="color:#F8F8F2;"> </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">renderApp</span><span style="color:#F8F8F2;">(); </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">}, </span><span style="color:#AE81FF;">true</span><span style="color:#F8F8F2;">); </span></span></code></pre></div><p>And that&#39;s all! Our players are now fully functional, and their master chain can be controlled remotely from the controllers.</p><p>Let&#39;s now finish the project by enabling full remote control of any player client from a controller.</p><h2 id="remotely-control-players-from-the-controller" tabindex="-1">Remotely control players from the controller <a class="header-anchor" href="#remotely-control-players-from-the-controller" aria-label="Permalink to &quot;Remotely control players from the controller&quot;">​</a></h2><p>Let&#39;s go back to our controller and to get a list of all connected players. To that end, the soundworks state manager expose a <a href="https://soundworks.dev/soundworks/client.StateManager.html#getCollection" target="_blank" rel="noreferrer"><code>getCollection</code></a> method which allows to grab a collection of states that mirror all the states created on the network according to a given schema name. The returned collection is automatically kept synchronized with the states that are created and deleted on the network and offer several methods to work with the list.</p><p>First, we need to import new dependencies, among them the Web Component we created for the player client:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki monokai has-highlighted-lines has-diff"><code><span class="line"><span style="color:#88846F;">// src/clients/controller/index.js</span></span>
<span class="line"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> { html, nothing } </span><span style="color:#F92672;">from</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;lit&#39;</span><span style="color:#F8F8F2;">;</span></span>
<span class="line highlighted"><wbr></span>
<span class="line"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;@ircam/sc-components/sc-text.js&#39;</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;@ircam/sc-components/sc-slider.js&#39;</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;@ircam/sc-components/sc-toggle.js&#39;</span><span style="color:#F8F8F2;">;</span></span>
<span class="line diff add"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;../components/sw-player.js&#39;</span><span style="color:#F8F8F2;">; </span></span></code></pre></div><p>Then, let&#39;s create our <code>player</code> collection using the state manager:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki monokai has-highlighted-lines has-diff"><code><span class="line"><span style="color:#88846F;">// src/clients/controller/index.js</span></span>
<span class="line"><span style="color:#F92672;">await</span><span style="color:#F8F8F2;"> client.</span><span style="color:#A6E22E;">start</span><span style="color:#F8F8F2;">();</span></span>
<span class="line highlighted"><wbr></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> global </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">await</span><span style="color:#F8F8F2;"> client.stateManager.</span><span style="color:#A6E22E;">attach</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;global&#39;</span><span style="color:#F8F8F2;">);</span></span>
<span class="line diff add"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> players </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">await</span><span style="color:#F8F8F2;"> client.stateManager.</span><span style="color:#A6E22E;">getCollection</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;player&#39;</span><span style="color:#F8F8F2;">); </span></span></code></pre></div><p>Finally we just need to add to our interface a mirror interface for each of our connected <em>players</em>, and to refresh the interface if any player connects, disconnects or is updated:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki monokai has-highlighted-lines has-diff"><code><span class="line"><span style="color:#88846F;">// src/clients/controller/index.js</span></span>
<span class="line highlighted"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> players </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">await</span><span style="color:#F8F8F2;"> client.stateManager.</span><span style="color:#A6E22E;">getCollection</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;player&#39;</span><span style="color:#F8F8F2;">);</span></span>
<span class="line highlighted"><wbr></span>
<span class="line highlighted"><span style="color:#66D9EF;font-style:italic;">function</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">renderApp</span><span style="color:#F8F8F2;">() {</span></span>
<span class="line highlighted"><span style="color:#F8F8F2;">  </span><span style="color:#A6E22E;">render</span><span style="color:#F8F8F2;">(</span><span style="color:#A6E22E;">html</span><span style="color:#E6DB74;">\`</span></span>
<span class="line highlighted"><span style="color:#E6DB74;">    &lt;div class=&quot;controller-layout&quot;&gt;</span></span>
<span class="line highlighted"><span style="color:#E6DB74;">      &lt;header&gt;</span></span>
<span class="line highlighted"><span style="color:#E6DB74;">        &lt;h1&gt;</span><span style="color:#F92672;">\${</span><span style="color:#F8F8F2;">client.config.app.name</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;"> | </span><span style="color:#F92672;">\${</span><span style="color:#F8F8F2;">client.role</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;">&lt;/h1&gt;</span></span>
<span class="line highlighted"><span style="color:#E6DB74;">        &lt;sw-audit .client=&quot;</span><span style="color:#F92672;">\${</span><span style="color:#F8F8F2;">client</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;">&quot;&gt;&lt;/sw-audit&gt;</span></span>
<span class="line highlighted"><span style="color:#E6DB74;">      &lt;/header&gt;</span></span>
<span class="line highlighted"><span style="color:#E6DB74;">      &lt;section&gt;</span></span>
<span class="line highlighted"><span style="color:#E6DB74;">        &lt;h2&gt;Global&lt;/h2&gt;</span></span>
<span class="line highlighted"><span style="color:#E6DB74;">        // ...</span></span>
<span class="line highlighted"><wbr></span>
<span class="line diff add highlighted"><span style="color:#E6DB74;">        </span><span style="color:#F92672;">\${</span><span style="color:#F8F8F2;">players.</span><span style="color:#A6E22E;">map</span><span style="color:#F8F8F2;">(</span><span style="color:#FD971F;font-style:italic;">player</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;font-style:italic;">=&gt;</span><span style="color:#F8F8F2;"> { </span></span>
<span class="line diff add highlighted"><span style="color:#F8F8F2;">          </span><span style="color:#F92672;">return</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">html</span><span style="color:#E6DB74;">\`&lt;sw-player .player=</span><span style="color:#F92672;">\${</span><span style="color:#F8F8F2;">player</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;">&gt;&lt;/sw-player&gt;\`</span><span style="color:#F8F8F2;">; </span></span>
<span class="line diff add highlighted"><span style="color:#F8F8F2;">        })</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;"> </span></span>
<span class="line highlighted"><span style="color:#E6DB74;">      &lt;/section&gt;</span></span>
<span class="line highlighted"><span style="color:#E6DB74;">    &lt;/div&gt;</span></span>
<span class="line highlighted"><span style="color:#E6DB74;">  \`</span><span style="color:#F8F8F2;">, $container);</span></span>
<span class="line highlighted"><span style="color:#F8F8F2;">}</span></span>
<span class="line highlighted"><wbr></span>
<span class="line highlighted"><span style="color:#F8F8F2;">global.</span><span style="color:#A6E22E;">onUpdate</span><span style="color:#F8F8F2;">(() </span><span style="color:#66D9EF;font-style:italic;">=&gt;</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">renderApp</span><span style="color:#F8F8F2;">(), </span><span style="color:#AE81FF;">true</span><span style="color:#F8F8F2;">);</span></span>
<span class="line highlighted"><span style="color:#88846F;">// refresh the screen on each players collection event</span></span>
<span class="line diff add highlighted"><span style="color:#F8F8F2;">players.</span><span style="color:#A6E22E;">onAttach</span><span style="color:#F8F8F2;">(() </span><span style="color:#66D9EF;font-style:italic;">=&gt;</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">renderApp</span><span style="color:#F8F8F2;">()); </span></span>
<span class="line diff add highlighted"><span style="color:#F8F8F2;">players.</span><span style="color:#A6E22E;">onDetach</span><span style="color:#F8F8F2;">(() </span><span style="color:#66D9EF;font-style:italic;">=&gt;</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">renderApp</span><span style="color:#F8F8F2;">()); </span></span>
<span class="line diff add highlighted"><span style="color:#F8F8F2;">players.</span><span style="color:#A6E22E;">onUpdate</span><span style="color:#F8F8F2;">(() </span><span style="color:#66D9EF;font-style:italic;">=&gt;</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">renderApp</span><span style="color:#F8F8F2;">()); </span></span></code></pre></div><p>If you now open a controller (<a href="http://127.0.0.1:8000/controller" target="_blank" rel="noreferrer">http://127.0.0.1:8000/controller</a>) and emulate several clients in a different window ((<a href="http://127.0.0.1:8000?emulate=3" target="_blank" rel="noreferrer">http://127.0.0.1:8000?emulate=3</a>), you should now see the full application and how the <em>players</em> and <em>controller</em> are kept synchronized through the shared states:</p><p><img src="`+d+'" alt="todo-noise-full"></p><h2 id="conclusion" tabindex="-1">Conclusion <a class="header-anchor" href="#conclusion" aria-label="Permalink to &quot;Conclusion&quot;">​</a></h2><p>In this tutorial, you have learned an important pattern that soundworks aims to simplify: the ability to simply create remote control and monitoring of clients through shared states. Along the way, you have learned how to create a reusable Web Component using the <a href="https://lit.dev/" target="_blank" rel="noreferrer">Lit</a> library.</p><p>While the tutorial purposely simplified important aspects of the application to focus on these key points, a number of features could be improved with simple modifications to the structure. For example:</p><ul><li>Improve the start / stop synth so that no click occurs when it is stopped.</li><li>Create more complex synthesizers with more parameters and more complex audio chains.</li><li>Improve the master chain, e.g. use decibels for the master volume to make the slider behavior more natural, add low pass and high pass filters.</li><li>Refactor the synthesizers with classes to create reusable audio components.</li><li>etc.</li></ul>',129)]))}const v=a(h,[["render",f]]);export{D as __pageData,v as default};
