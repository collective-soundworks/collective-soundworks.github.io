<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Using the State Manager | soundworks</title>
    <meta name="description" content="Creative coding framework for distributed applications based on Web technologies">
    <meta name="generator" content="VitePress v2.0.0-alpha.16">
    <link rel="preload stylesheet" href="/assets/style.DklbAnHd.css" as="style">
    <link rel="preload stylesheet" href="/vp-icons.css" as="style">
    
    <script type="module" src="/assets/app.Crhjg3H6.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/theme.DKERbyZW.js">
    <link rel="modulepreload" href="/assets/chunks/framework.CRk2WtWN.js">
    <link rel="modulepreload" href="/assets/tutorials_state-manager.md.DL2GqnxU.lean.js">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-304c8b69><!--[--><!--]--><!--[--><span tabindex="-1" data-v-10d4d845></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-10d4d845>Skip to content</a><!--]--><!----><header class="VPNav" data-v-304c8b69 data-v-d5bf7c8e><div class="VPNavBar has-sidebar top" data-v-d5bf7c8e data-v-cc1d9f2e><div class="wrapper" data-v-cc1d9f2e><div class="container" data-v-cc1d9f2e><div class="title" data-v-cc1d9f2e><div class="VPNavBarTitle has-sidebar" data-v-cc1d9f2e data-v-d4488dd0><a class="title" href="/" data-v-d4488dd0><!--[--><!--]--><!--[--><img class="VPImage logo" src="/logo-nav.png" alt data-v-ab19afbb><!--]--><span data-v-d4488dd0>soundworks</span><!--[--><!--]--></a></div></div><div class="content" data-v-cc1d9f2e><div class="content-body" data-v-cc1d9f2e><!--[--><!--]--><div class="VPNavBarSearch search" data-v-cc1d9f2e data-v-bdd98725><!--[--><button type="button" class="VPNavBarSearchButton" aria-label="Search" aria-keyshortcuts="/ control+k meta+k" data-v-bdd98725 data-v-69351052><span class="vpi-search" aria-hidden="true" data-v-69351052></span><span class="text" data-v-69351052>Search</span><span class="keys" aria-hidden="true" data-v-69351052><kbd class="key-cmd" data-v-69351052>⌘</kbd><kbd class="key-ctrl" data-v-69351052>Ctrl</kbd><kbd data-v-69351052>K</kbd></span></button><!----><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-cc1d9f2e data-v-020be4db><span id="main-nav-aria-label" class="visually-hidden" data-v-020be4db> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/tutorials/getting-started.html" tabindex="0" data-v-020be4db data-v-81dba28a><!--[--><span data-v-81dba28a>Guide</span><!--]--></a><!--]--><!--[--><a class="VPLink link vp-external-link-icon VPNavBarMenuLink" href="https://soundworks.dev/soundworks" target="_blank" rel="noreferrer" tabindex="0" data-v-020be4db data-v-81dba28a><!--[--><span data-v-81dba28a>soundworks API</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/credits.html" tabindex="0" data-v-020be4db data-v-81dba28a><!--[--><span data-v-81dba28a>Credits</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-cc1d9f2e data-v-3f90c1a5><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-3f90c1a5 data-v-be9742d9 data-v-b4ccac88><span class="check" data-v-b4ccac88><span class="icon" data-v-b4ccac88><!--[--><span class="vpi-sun sun" data-v-be9742d9></span><span class="vpi-moon moon" data-v-be9742d9></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-cc1d9f2e data-v-ef6192dc data-v-a1a7286e><!--[--><a class="VPSocialLink no-icon" href="https://github.com/collective-soundworks/collective-soundworks.github.io" aria-label="github" target="_blank" rel="me noopener" data-v-a1a7286e data-v-32d78712><span class="vpi-social-github"></span></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-cc1d9f2e data-v-600b50c9 data-v-d8fae6e2><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-d8fae6e2><span class="vpi-more-horizontal icon" data-v-d8fae6e2></span></button><div class="menu" data-v-d8fae6e2><div class="VPMenu" data-v-d8fae6e2 data-v-fcd1d7a8><!----><!--[--><!--[--><!----><div class="group" data-v-600b50c9><div class="item appearance" data-v-600b50c9><p class="label" data-v-600b50c9>Appearance</p><div class="appearance-action" data-v-600b50c9><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-600b50c9 data-v-be9742d9 data-v-b4ccac88><span class="check" data-v-b4ccac88><span class="icon" data-v-b4ccac88><!--[--><span class="vpi-sun sun" data-v-be9742d9></span><span class="vpi-moon moon" data-v-be9742d9></span><!--]--></span></span></button></div></div></div><div class="group" data-v-600b50c9><div class="item social-links" data-v-600b50c9><div class="VPSocialLinks social-links-list" data-v-600b50c9 data-v-a1a7286e><!--[--><a class="VPSocialLink no-icon" href="https://github.com/collective-soundworks/collective-soundworks.github.io" aria-label="github" target="_blank" rel="me noopener" data-v-a1a7286e data-v-32d78712><span class="vpi-social-github"></span></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-cc1d9f2e data-v-6bee1efd><span class="container" data-v-6bee1efd><span class="top" data-v-6bee1efd></span><span class="middle" data-v-6bee1efd></span><span class="bottom" data-v-6bee1efd></span></span></button></div></div></div></div><div class="divider" data-v-cc1d9f2e><div class="divider-line" data-v-cc1d9f2e></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-304c8b69 data-v-73add737><div class="container" data-v-73add737><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-73add737><span class="vpi-align-left menu-icon" data-v-73add737></span><span class="menu-text" data-v-73add737>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-73add737 data-v-e28a51a6><button data-v-e28a51a6>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-304c8b69 data-v-49f51a23><div class="curtain" data-v-49f51a23></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-49f51a23><span class="visually-hidden" id="sidebar-aria-label" data-v-49f51a23> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-a84b7c21><section class="VPSidebarItem level-0" data-v-a84b7c21 data-v-6b36a2fd><!----><div class="items" data-v-6b36a2fd><!--[--><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/introduction.html" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Introduction</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-a84b7c21><section class="VPSidebarItem level-0 has-active" data-v-a84b7c21 data-v-6b36a2fd><div class="item" role="button" tabindex="0" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><h2 class="text" data-v-6b36a2fd>Tutorials</h2><!----></div><div class="items" data-v-6b36a2fd><!--[--><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/tutorials/getting-started.html" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Getting Started</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/tutorials/state-manager.html" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Using the State Manager</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/tutorials/plugin-platform-init.html" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Using Plugins 1 - <i>platform-init</i></p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/tutorials/todo-noise.html" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>The <i>Todo Noise</i> Application</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/tutorials/node-clients.html" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Working with Node Clients</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/tutorials/plugin-sync.html" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Using Plugins 2 - <i>sync</i></p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/tutorials/step-sequencer.html" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Distributed Step Sequencer</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-a84b7c21><section class="VPSidebarItem level-0" data-v-a84b7c21 data-v-6b36a2fd><div class="item" role="button" tabindex="0" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><h2 class="text" data-v-6b36a2fd>Recipes</h2><!----></div><div class="items" data-v-6b36a2fd><!--[--><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/recipes/working-with-max.html" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Working with Max</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-a84b7c21><section class="VPSidebarItem level-0" data-v-a84b7c21 data-v-6b36a2fd><div class="item" role="button" tabindex="0" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><h2 class="text" data-v-6b36a2fd>Documentation</h2><!----></div><div class="items" data-v-6b36a2fd><!--[--><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link vp-external-link-icon link" href="https://soundworks.dev/soundworks" target="_blank" rel="noreferrer" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>soundworks API</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/tools/helpers.html" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Helpers</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/plugins/platform-init.html" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Plugin Platform Init</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/plugins/sync.html" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Plugin Sync</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/plugins/filesystem.html" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Plugin Filesystem</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/plugins/scripting.html" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Plugin Scripting</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/plugins/checkin.html" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Plugin Checkin</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/plugins/position.html" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Plugin Position</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/plugins/logger.html" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Plugin Logger</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-a84b7c21><section class="VPSidebarItem level-0" data-v-a84b7c21 data-v-6b36a2fd><div class="item" role="button" tabindex="0" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><h2 class="text" data-v-6b36a2fd>Ecosystem</h2><!----></div><div class="items" data-v-6b36a2fd><!--[--><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link vp-external-link-icon link" href="https://github.com/ircam-ismm/node-web-audio-api/" target="_blank" rel="noreferrer" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>node-web-audio-api</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link vp-external-link-icon link" href="https://github.com/ircam-ismm/sc-components/" target="_blank" rel="noreferrer" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>@ircam/sc-components</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link vp-external-link-icon link" href="https://github.com/ircam-ismm/sc-utils" target="_blank" rel="noreferrer" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>@ircam/sc-utils</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link vp-external-link-icon link" href="https://github.com/ircam-ismm/sc-scheduling/" target="_blank" rel="noreferrer" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>@ircam/sc-scheduling</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link vp-external-link-icon link" href="https://github.com/ircam-ismm/devicemotion" target="_blank" rel="noreferrer" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>@ircam/devicemotion</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link vp-external-link-icon link" href="https://ircam-ismm.github.io/dotpi/" target="_blank" rel="noreferrer" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>dotpi tools</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-a84b7c21><section class="VPSidebarItem level-0" data-v-a84b7c21 data-v-6b36a2fd><div class="item" role="button" tabindex="0" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><h2 class="text" data-v-6b36a2fd>Misc</h2><!----></div><div class="items" data-v-6b36a2fd><!--[--><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/misc/websockets-101.html" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>WebSockets 101</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-304c8b69 data-v-bd4f21ea><div class="VPDoc has-sidebar has-aside" data-v-bd4f21ea data-v-d668f7cc><!--[--><!--]--><div class="container" data-v-d668f7cc><div class="aside" data-v-d668f7cc><div class="aside-curtain" data-v-d668f7cc></div><div class="aside-container" data-v-d668f7cc><div class="aside-content" data-v-d668f7cc><div class="VPDocAside" data-v-d668f7cc data-v-cb998dce><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-cb998dce data-v-c8b19031><div class="content" data-v-c8b19031><div class="outline-marker" data-v-c8b19031></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-c8b19031>On this page</div><ul class="VPDocOutlineItem root" data-v-c8b19031 data-v-63c57e50><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-cb998dce></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-d668f7cc><div class="content-container" data-v-d668f7cc><!--[--><!--]--><main class="main" data-v-d668f7cc><div style="position:relative;" class="vp-doc _tutorials_state-manager" data-v-d668f7cc><div><h1 id="using-the-state-manager" tabindex="-1">Using the State Manager <a class="header-anchor" href="#using-the-state-manager" aria-label="Permalink to “Using the State Manager”">​</a></h1><p>In this tutorial, we will dig into the distributed state management system proposed by <em>soundworks</em>. After a short introduction on the underlying concepts, we will see how to use shared states, and how this pattern can help you to implement remote control and monitoring in your applications. Additionally, we will see how the shared states simplify the development of distributed applications by abstracting the network communications and messages routing.</p><p>Along the way, we will discover a related library, <a href="https://ircam-ismm.github.io/sc-components/" target="_blank" rel="noreferrer">@ircam/sc-components</a>, to simply create usable (and hopefully elegant) graphical user interfaces.</p><blockquote><p>The final source code of this tutorial can be found <a href="https://github.com/collective-soundworks/tutorials/tree/main/state-manager" target="_blank" rel="noreferrer">here</a></p></blockquote><h3 id="relevant-documentation" tabindex="-1">Relevant documentation <a class="header-anchor" href="#relevant-documentation" aria-label="Permalink to “Relevant documentation”">​</a></h3><ul><li><a href="https://soundworks.dev/soundworks/ClientStateManager.html" target="_blank" rel="noreferrer">ClientStateManager</a></li><li><a href="https://soundworks.dev/soundworks/ServerStateManager.html" target="_blank" rel="noreferrer">ServerStateManager</a></li><li><a href="https://soundworks.dev/soundworks/SharedState.html" target="_blank" rel="noreferrer">SharedState</a></li><li><a href="https://soundworks.dev/soundworks/SharedStateCollection.html" target="_blank" rel="noreferrer">SharedStateCollection</a></li><li><a href="https://ircam-ismm.github.io/sc-components/" target="_blank" rel="noreferrer">@ircam/sc-components</a></li></ul><h2 id="introduction" tabindex="-1">Introduction <a class="header-anchor" href="#introduction" aria-label="Permalink to “Introduction”">​</a></h2><p>First of all, let&#39;s start with a bit of theory to understand the concepts and general logic behind the <em>soundworks</em>&#39; shared states.</p><h3 id="the-why" tabindex="-1">The &quot;Why&quot; <a class="header-anchor" href="#the-why" aria-label="Permalink to “The &quot;Why&quot;”">​</a></h3><p>Most of the time, we think of an application as &quot;something&quot; that runs on a computer with which a user can interact in some way. The idea of <em>distributed application</em> extends this definition to applications that run on several computers and where several users can interact at the same time. Or to say it in a more formal way:</p><blockquote><p><em>« A distributed system is a collection of autonomous computing elements that appears to its users as a single coherent system. »</em> Maarten van Steen, and Andrew S. Tanenbaum. “A Brief Introduction to Distributed Systems.” Computing 98, no. 10, October 2016.</p></blockquote><p><img src="/assets/distributed-application.BQpXDFHg.png" alt="distributed-application"></p><p>Additionally, in creative contexts, it&#39;s important to have very simple ways to monitor and/or control the state of distant clients. This is true both during the development of the artwork / application, e.g. to tweak some synthesizer on distant machines from a central point (even in the studio, modifying some parameters on several machines can get cumbersome quite quickly), as well as during a performance, e.g. to control the general volume, to switch between two sections of the piece, etc.</p><p>The <code>StateManager</code> and the <code>SharedState</code> abstractions proposed by <em>soundworks</em> provide a simple way to define and synchronize some sets of parameters that are of interest by multiple clients, while abstracting all the network communications involved.</p><h3 id="the-how" tabindex="-1">The &quot;How&quot; <a class="header-anchor" href="#the-how" aria-label="Permalink to “The &quot;How&quot;”">​</a></h3><p>From a more technical point of view, the distributed state management system proposed by <em>soundworks</em> is a circular data flow pattern adapted to the particular needs of real-time distributed applications.</p><p>To that end, the flow data is structured according to a circular path that is always synchronized with the server.</p><p><img src="/assets/distributed-state-management.CN1cDUsv.png" alt="distributed-state-management"></p><p>As illustrated in the figure above, when an input (e.g. some user gesture) triggers a change in the state of a client (arrow 1, red), the data is automatically synchronized with a server-side representation of the state through WebSockets (arrow 2), which once done triggers the change in the rendering, be it audio or visual (arrow 3).</p><p>This simple pattern enables an important feature: any other node of the network can make a change on the same server-side representation of the state (arrow 1&#39;, blue), which will trigger 2 (red) and 3 (red) in a completely transparent way.</p><div class="info custom-block"><p class="custom-block-title custom-block-title-default">INFO</p><p>In these tutorials, when we speak of a <strong><em>node of the network</em></strong>, we consider both the clients and the server.</p><p>Form the point of view of the distributed state management system, the server is indeed a <em>node</em> just as any client. However, its central role gives it particular abilities and features.</p></div><h2 id="scaffolding-the-application" tabindex="-1">Scaffolding the application <a class="header-anchor" href="#scaffolding-the-application" aria-label="Permalink to “Scaffolding the application”">​</a></h2><div class="info custom-block"><p class="custom-block-title custom-block-title-default">INFO</p><p>This section requires basic knowledge of the <em>soundworks</em> wizard, so please refer to the <a href="/tutorials/getting-started.html">getting started tutorial</a> if you didn&#39;t check it yet.</p></div><p>First thing first, let&#39;s generate a new empty application with the <code>@soundworks/create</code> wizard.</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki monokai" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#66D9EF;">cd</span><span style="color:#E6DB74;"> /path/to/working/directory</span></span>
<span class="line"><span style="color:#A6E22E;">npx</span><span style="color:#E6DB74;"> @soundworks/create@latest</span><span style="color:#E6DB74;"> state-manager</span></span></code></pre></div><p>When the wizard asks you for the configuration of the default client:</p><ul><li>Name it <code>player</code></li><li>Select the <code>browser</code> target</li><li>Select the <code>default</code> template</li></ul><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki monokai" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#86B42B;">~/tmp</span><span style="color:#F8F8F2;"> $ npx @soundworks/create@latest state-manager</span></span>
<span class="line"><span style="color:#666666;">[@soundworks/create#v5.0.3]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B3B42B;">&gt; welcome to soundworks</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">- documentation: </span><span style="color:#56ADBC;">https://soundworks.dev</span></span>
<span class="line"><span style="color:#F8F8F2;">- issues: </span><span style="color:#56ADBC;">https://github.com/collective-soundworks/soundworks/issues</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">- Scaffolding application in &quot;~/tmp/state-manager&quot; directory</span></span>
<span class="line"><span style="color:#F8F8F2;">- Installing dependencies</span></span>
<span class="line"></span>
<span class="line"><span style="color:#666666;">[@soundworks/wizard#v5.0.3]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#56ADBC;"># Install plugins</span></span>
<span class="line"><span style="color:#86B42B;">✔</span><span style="color:#F8F8F2;font-weight:bold;"> Select the plugins you would like to install/uninstall</span><span style="color:#666666;"> ›</span><span style="color:#F8F8F2;"> </span></span>
<span class="line"><span style="color:#B3B42B;">+ nothing to do, aborting...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#56ADBC;"># Install libraries</span></span>
<span class="line"><span style="color:#86B42B;">✔</span><span style="color:#F8F8F2;font-weight:bold;"> Select the libraries you would like to install/uninstall</span><span style="color:#666666;"> ›</span><span style="color:#F8F8F2;"> </span></span>
<span class="line"><span style="color:#B3B42B;">+ nothing to do, aborting...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#56ADBC;"># Create client</span></span>
<span class="line"><span style="color:#86B42B;">✔</span><span style="color:#F8F8F2;font-weight:bold;"> Name of your new client (lowercase, no-space):</span><span style="color:#666666;"> …</span><span style="color:#F8F8F2;"> player</span></span>
<span class="line"><span style="color:#86B42B;">✔</span><span style="color:#F8F8F2;font-weight:bold;"> Which runtime for your client?</span><span style="color:#666666;"> ›</span><span style="color:#F8F8F2;"> browser</span></span>
<span class="line"><span style="color:#86B42B;">✔</span><span style="color:#F8F8F2;font-weight:bold;"> Which template would you like to use?</span><span style="color:#666666;"> ›</span><span style="color:#F8F8F2;"> default</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">- Creating client &quot;player&quot; in file &quot;src/clients/player.js&quot;</span></span>
<span class="line"><span style="color:#F8F8F2;">- name: </span><span style="color:#56ADBC;">player</span></span>
<span class="line"><span style="color:#F8F8F2;">- runtime: </span><span style="color:#56ADBC;">browser</span></span>
<span class="line"><span style="color:#F8F8F2;">- template: </span><span style="color:#56ADBC;">default</span></span>
<span class="line"><span style="color:#F8F8F2;">- default: </span><span style="color:#56ADBC;">true</span></span>
<span class="line"></span>
<span class="line"><span style="color:#56ADBC;">?</span><span style="color:#F8F8F2;font-weight:bold;"> Confirm?</span><span style="color:#666666;"> ›</span><span style="color:#F8F8F2;"> no </span><span style="color:#666666;">/</span><span> </span><span style="color:#56ADBC;text-decoration:underline;">yes</span></span></code></pre></div><p>Then open the new <code>state-manager</code> directory in your favorite editor and launch the application in development mode:</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki monokai" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#66D9EF;">cd</span><span style="color:#E6DB74;"> state-manager</span></span>
<span class="line"><span style="color:#A6E22E;">npm</span><span style="color:#E6DB74;"> run</span><span style="color:#E6DB74;"> dev</span></span></code></pre></div><h2 id="describing-shared-state-classes" tabindex="-1">Describing shared state classes <a class="header-anchor" href="#describing-shared-state-classes" aria-label="Permalink to “Describing shared state classes”">​</a></h2><p>The <code>StateManager</code> component is configured with JavaScript objects that declare a set of attributes and their properties, called <a href="https://soundworks.dev/soundworks/global.html#SharedStateClassDescription" target="_blank" rel="noreferrer"><code>SharedStateClassDescription</code></a>. You can think of a <code>SharedStateClassDescription</code> as a kind of blueprint from which multiple <code>SharedState</code> instances can be created.</p><div class="tip custom-block"><p class="custom-block-title custom-block-title-default">TIP</p><p>If you are familiar with databases, you can think of <code>SharedStateClassDescription</code> has similar to the <em>schema</em> of a database table.</p><p>The syntax for declaring <code>SharedStateClassDescription</code> is documented <a href="https://soundworks.dev/soundworks/global.html#SharedStateClassDescription" target="_blank" rel="noreferrer"><code>here</code></a>.</p></div><p>In this application we will declare two different <code>SharedStateClassDescription</code>:</p><ul><li>A description called <code>global</code> which we will use to store information accessible by all nodes of the network. This shared state will be unique across the whole application, i.e. it will be created by the server and all <code>player</code> clients will &quot;attach&quot; to it.</li><li>A description called <code>player</code>, which we will use to describe the state of a single client of the application. All clients with the <code>player</code> role will create their own <code>SharedState</code> instance from this class.</li></ul><p>Let&#39;s then create the file <code>src/state-descriptions/global.js</code>, and push the following code into it:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki monokai" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#88846F;">// src/state-descriptions/global.js</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F92672;"> default</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#88846F;">  // volume volume in dB [-60, 6]</span></span>
<span class="line"><span style="color:#F8F8F2;">  volume: {</span></span>
<span class="line"><span style="color:#F8F8F2;">    type: </span><span style="color:#E6DB74;">&#39;float&#39;</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#F8F8F2;">    min: </span><span style="color:#F92672;">-</span><span style="color:#AE81FF;">60</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#F8F8F2;">    max: </span><span style="color:#AE81FF;">6</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#F8F8F2;">    default: </span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#F8F8F2;">  },</span></span>
<span class="line"><span style="color:#88846F;">  // mute [true, false]</span></span>
<span class="line"><span style="color:#F8F8F2;">  mute: {</span></span>
<span class="line"><span style="color:#F8F8F2;">    type: </span><span style="color:#E6DB74;">&#39;boolean&#39;</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#F8F8F2;">    default: </span><span style="color:#AE81FF;">false</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#F8F8F2;">  },</span></span>
<span class="line"><span style="color:#F8F8F2;">};</span></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title custom-block-title-default">TIP</p><p>Note that the <code>state-descriptions</code> directory you just created is just proposal to keep the code organized and is in anyway mandatory, i.e. such declarations could potentially live anywhere in your code...</p><p>Just keep in mind that this is your responsibility as a developer to keep things organized and to properly name them in way that minimize your cognitive load.</p></div><p>From this simple code we can see that this description, and its derived <code>SharedState</code> instance, will allow us to control the <em>volume</em> of all clients as well as to <em>mute/unmute</em> them.</p><p>Second, let&#39;s create the file <code>src/state-descriptions/player.js</code> containing the following code:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki monokai" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#88846F;">// src/state-descriptions/player.js</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F92672;"> default</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  frequency: {</span></span>
<span class="line"><span style="color:#F8F8F2;">    type: </span><span style="color:#E6DB74;">&#39;float&#39;</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#F8F8F2;">    min: </span><span style="color:#AE81FF;">50</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#F8F8F2;">    max: </span><span style="color:#AE81FF;">1000</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#F8F8F2;">    default: </span><span style="color:#AE81FF;">440</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#F8F8F2;">  },</span></span>
<span class="line"><span style="color:#F8F8F2;">};</span></span></code></pre></div><p>This description, that we will use to create a new <code>SharedState</code> on each client, will allow us to control the <em>frequency</em> of an oscillator.</p><p>Interestingly, we can already foresee from these two definitions, the structure of the audio graph that we will create on each client:</p><blockquote><p><code>[OscillatorNode] -&gt; [GainNode (mute)] -&gt; [GainNode (volume)] -&gt; [output]</code></p></blockquote><ul><li>The <code>OscillatorNode</code> will be controlled by the different <code>SharedState</code>s created from description declared in the <code>player.js</code> file, i.e. each client will be able to have a different oscillator <em>frequency</em>.</li><li>At contrary, the <code>GainNode</code>s (<em>mute</em> and <em>volume</em>) will be controlled globally for all clients by the common <code>SharedState</code> created from description declared in the <code>global.js</code> file,.</li></ul><div class="info custom-block"><p class="custom-block-title custom-block-title-default">INFO</p><p>To keep things focused on the distributed state management system, we won&#39;t actually create the audio graph in this tutorial, but this could be an interesting exercise to do on your own!</p></div><h2 id="defining-shared-state-classes" tabindex="-1">Defining shared state classes <a class="header-anchor" href="#defining-shared-state-classes" aria-label="Permalink to “Defining shared state classes”">​</a></h2><p>Let&#39;s first import the declarations into the <code>src/server.js</code> file:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki monokai has-diff" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#88846F;">// src/server.js</span></span>
<span class="line"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> { Server } </span><span style="color:#F92672;">from</span><span style="color:#E6DB74;"> &#39;@soundworks/core/server.js&#39;</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> { loadConfig, configureHttpRouter } </span><span style="color:#F92672;">from</span><span style="color:#E6DB74;"> &#39;@soundworks/helpers/server.js&#39;</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"></span>
<span class="line diff add"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> globalDescription </span><span style="color:#F92672;">from</span><span style="color:#E6DB74;"> &#39;./state-descriptions/global.js&#39;</span><span style="color:#F8F8F2;">; </span></span>
<span class="line diff add"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> playerDescription </span><span style="color:#F92672;">from</span><span style="color:#E6DB74;"> &#39;./state-descriptions/player.js&#39;</span><span style="color:#F8F8F2;">; </span></span></code></pre></div><p>Once done, we can define classes of <code>SharedState</code>s from these <code>SharedStateClassDescription</code> using the <code>stateManager</code> instance of the <em>soundworks</em> <code>server</code>:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki monokai has-diff" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#88846F;">// src/server.js</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> server </span><span style="color:#F92672;">=</span><span style="color:#F92672;"> new</span><span style="color:#A6E22E;"> Server</span><span style="color:#F8F8F2;">(config);</span></span>
<span class="line"><span style="color:#A6E22E;">configureHttpRouter</span><span style="color:#F8F8F2;">(server);</span></span>
<span class="line"></span>
<span class="line diff add"><span style="color:#88846F;">// define the shared state classes from our descriptions</span></span>
<span class="line diff add"><span style="color:#F8F8F2;">server.stateManager.</span><span style="color:#A6E22E;">defineClass</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;global&#39;</span><span style="color:#F8F8F2;">, globalDescription); </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">server.stateManager.</span><span style="color:#A6E22E;">defineClass</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;player&#39;</span><span style="color:#F8F8F2;">, playerDescription); </span></span></code></pre></div><p>Note that the <code>stateManager.defineClass</code> method takes 2 arguments:</p><ul><li>A <a href="https://soundworks.dev/soundworks/global.html#SharedStateClassName" target="_blank" rel="noreferrer"><code>SharedStateClassName</code></a>: a <em>user defined</em> string that acts as a sort of identifier for this class of shared states, here <code>&#39;global&#39;</code> and <code>&#39;player&#39;</code>.</li><li>A <a href="https://soundworks.dev/soundworks/global.html#SharedStateClassDescription" target="_blank" rel="noreferrer"><code>SharedStateClassDescription</code></a>: the <code>globalDescription</code> and <code>playerDescription</code> we defined in their own files and explained above.</li></ul><div class="tip custom-block"><p class="custom-block-title custom-block-title-default">TIP</p><p>While this signature allows to declare simple user-friendly names for creating and attaching shared state, it also allows to register the same schema under different names in more advanced use cases.</p></div><p>Now that our <code>SharedState</code> classes are defined within the <code>server.stateManager</code>, we can safely create new instances of <code>SharedState</code>s based on these names and descriptions.</p><h2 id="creating-shared-states" tabindex="-1">Creating shared states <a class="header-anchor" href="#creating-shared-states" aria-label="Permalink to “Creating shared states”">​</a></h2><p>Let&#39;s first create our <code>global</code> shared state instance from the class we just defined.</p><p>As explained above, we want this shared state to be unique across the entire application so that all clients share the same values. This can be simply achieved by:</p><ol><li><em>creating</em> the state on the server-side, i.e. the server is thus the <em>owner</em> of the state.</li><li><em>attaching</em> all our clients to this state, i.e. they have full access to the shared state values and can even update them but <em>they do not own the state</em>, which means that the state won&#39;t be deleted when they disconnect.</li></ol><p>While this distinction between <code>create</code> and <code>attach</code> can be a bit confusing at first, this will get more clear writing the code.</p><p>Let&#39;s thus add following lines into the <code>src/server.js</code> to create our <code>global</code> shared state instance, using the same <code>SharedStateClassName</code> we used when we defined the class:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki monokai has-diff" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#88846F;">// src/server.js</span></span>
<span class="line"><span style="color:#F92672;">await</span><span style="color:#F8F8F2;"> server.</span><span style="color:#A6E22E;">start</span><span style="color:#F8F8F2;">();</span></span>
<span class="line"></span>
<span class="line diff add"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> global </span><span style="color:#F92672;">=</span><span style="color:#F92672;"> await</span><span style="color:#F8F8F2;"> server.stateManager.</span><span style="color:#A6E22E;">create</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;global&#39;</span><span style="color:#F8F8F2;">); </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">console.</span><span style="color:#A6E22E;">log</span><span style="color:#F8F8F2;">(global.</span><span style="color:#A6E22E;">getValues</span><span style="color:#F8F8F2;">()); </span></span></code></pre></div><p>In your <code>Terminal</code> window, you should now see the default values of the state logged:</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki monokai" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#56ADBC;">+ http server listening on</span></span>
<span class="line"><span style="color:#F8F8F2;">    http://127.0.0.1:</span><span style="color:#86B42B;">8000</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">&gt; press &quot;</span><span style="color:#F8F8F2;font-weight:bold;">Ctrl + C</span><span style="color:#F8F8F2;">&quot; to exit</span></span>
<span class="line"><span style="color:#F8F8F2;">{ volume: </span><span style="color:#B3B42B;">0</span><span style="color:#F8F8F2;">, mute: </span><span style="color:#B3B42B;">false</span><span style="color:#F8F8F2;"> }</span></span></code></pre></div><p>Let &#39;s now <em>attach</em> all our <code>player</code> clients to the <code>global</code> state created by the server.</p><p>To that end, open the file <code>src/clients/player.js</code> and add the following lines of code:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki monokai has-diff" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#88846F;">// src/clients/player.js</span></span>
<span class="line"><span style="color:#F92672;">await</span><span style="color:#F8F8F2;"> client.</span><span style="color:#A6E22E;">start</span><span style="color:#F8F8F2;">();</span></span>
<span class="line"></span>
<span class="line highlighted diff add"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> global </span><span style="color:#F92672;">=</span><span style="color:#F92672;"> await</span><span style="color:#F8F8F2;"> client.stateManager.</span><span style="color:#A6E22E;">attach</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;global&#39;</span><span style="color:#F8F8F2;">); </span></span>
<span class="line highlighted diff add"><span style="color:#F8F8F2;">console.</span><span style="color:#A6E22E;">log</span><span style="color:#F8F8F2;">(global.</span><span style="color:#A6E22E;">getValues</span><span style="color:#F8F8F2;">()); </span></span></code></pre></div><p>Note that, instead of the method <code>stateManager.create</code> used on the server side, we use its counterpart <code>stateManager.attach</code> on the client side. Hence only one instance of the state exists on the network (it is owned by the server which created it), but <em>all nodes</em> of the network have access to the different values of the shared state.</p><p>If you open the URL <a href="http://127.0.0.0:8000" target="_blank" rel="noreferrer">http://127.0.0.1:8000</a> in your browser of choice and open the JavaScript console, you should see the current values of the <code>global</code> state displayed in the console just as for the server:</p><p><img src="/assets/global-client-log.RpX9Qsgk.png" alt="global-client-log"></p><div class="tip custom-block"><p class="custom-block-title custom-block-title-default">TIP</p><p>To open the <em>JavaScript</em> console in your browser, you can press <code>Cmd + Alt + I</code> and then select the <code>Console</code> tab.</p></div><p>While we are on the client-side code of our &quot;player&quot; clients, let&#39;s create the <code>player</code> shared state for each of them. To that end, add the following line of code in the <code>src/clients/player.js</code> file:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki monokai has-diff" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#88846F;">// src/clients/player.js</span></span>
<span class="line"><span style="color:#F92672;">await</span><span style="color:#F8F8F2;"> client.</span><span style="color:#A6E22E;">start</span><span style="color:#F8F8F2;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> global </span><span style="color:#F92672;">=</span><span style="color:#F92672;"> await</span><span style="color:#F8F8F2;"> client.stateManager.</span><span style="color:#A6E22E;">attach</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;global&#39;</span><span style="color:#F8F8F2;">);</span></span>
<span class="line diff add"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> player </span><span style="color:#F92672;">=</span><span style="color:#F92672;"> await</span><span style="color:#F8F8F2;"> client.stateManager.</span><span style="color:#A6E22E;">create</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;player&#39;</span><span style="color:#F8F8F2;">); </span></span></code></pre></div><p>Here, you can see side-by-side the <code>stateManager.create</code> and <code>stateManager.attach</code> methods and how they relate:</p><ul><li><code>stateManager.create</code> creates a new instance of a shared state that is owned by the node (either client or server).</li><li><code>stateManager.attach</code> attach to an existing shared state instance created and owned by another node.</li></ul><h2 id="display-the-states-values" tabindex="-1">Display the states values <a class="header-anchor" href="#display-the-states-values" aria-label="Permalink to “Display the states values”">​</a></h2><p>Now that our shared states are setup, let&#39;s continue on our client-side code to display the current values of the different shared states and update the screen when their values change.</p><div class="info custom-block"><p class="custom-block-title custom-block-title-default">INFO</p><p>In these series, all HTML rendering will be achieved by using the <a href="https://lit.dev/" target="_blank" rel="noreferrer">Lit</a> library proposed by <em>Google</em> and the <a href="https://ircam-ismm.github.io/sc-components/" target="_blank" rel="noreferrer">@ircam/sc-components</a> library. Both libraries are installed by default when you create a new application using the soundworks wizard.</p></div><p>Let&#39;s first modify the <code>renderApp</code> provided by the &quot;player&quot; boilerplate code to display the values of our two states:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki monokai" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#88846F;">// src/clients/player.js</span></span>
<span class="line"><span style="color:#F92672;">await</span><span style="color:#F8F8F2;"> client.</span><span style="color:#A6E22E;">start</span><span style="color:#F8F8F2;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> global </span><span style="color:#F92672;">=</span><span style="color:#F92672;"> await</span><span style="color:#F8F8F2;"> client.stateManager.</span><span style="color:#A6E22E;">attach</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;global&#39;</span><span style="color:#F8F8F2;">);</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> player </span><span style="color:#F92672;">=</span><span style="color:#F92672;"> await</span><span style="color:#F8F8F2;"> client.stateManager.</span><span style="color:#A6E22E;">create</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;player&#39;</span><span style="color:#F8F8F2;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">function</span><span style="color:#A6E22E;"> renderApp</span><span style="color:#F8F8F2;">() {</span></span>
<span class="line"><span style="color:#A6E22E;">  render</span><span style="color:#F8F8F2;">(</span><span style="color:#A6E22E;">html</span><span style="color:#E6DB74;">`</span></span>
<span class="line"><span style="color:#E6DB74;">    &lt;div class=&quot;simple-layout&quot;&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">      &lt;p&gt;Hello </span><span style="color:#F92672;">${</span><span style="color:#F8F8F2;">client.config.app.name</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;">!&lt;/p&gt; // [!code --]</span></span>
<span class="line"><span style="color:#E6DB74;">      &lt;h2&gt;Global&lt;/h2&gt; // [!code ++]</span></span>
<span class="line"><span style="color:#E6DB74;">      &lt;ul&gt; // [!code ++]</span></span>
<span class="line"><span style="color:#E6DB74;">        &lt;li&gt;volume: </span><span style="color:#F92672;">${</span><span style="color:#F8F8F2;">global.</span><span style="color:#A6E22E;">get</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;volume&#39;</span><span style="color:#F8F8F2;">)</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;">&lt;/li&gt; // [!code ++]</span></span>
<span class="line"><span style="color:#E6DB74;">        &lt;li&gt;mute: </span><span style="color:#F92672;">${</span><span style="color:#F8F8F2;">global.</span><span style="color:#A6E22E;">get</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;mute&#39;</span><span style="color:#F8F8F2;">)</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;">&lt;/li&gt; // [!code ++]</span></span>
<span class="line"><span style="color:#E6DB74;">      &lt;/ul&gt; // [!code ++]</span></span>
<span class="line"><span style="color:#E6DB74;">      &lt;h2&gt;Player&lt;/h2&gt; // [!code ++]</span></span>
<span class="line"><span style="color:#E6DB74;">      &lt;ul&gt; // [!code ++]</span></span>
<span class="line"><span style="color:#E6DB74;">        &lt;li&gt;frequency: </span><span style="color:#F92672;">${</span><span style="color:#F8F8F2;">player.</span><span style="color:#A6E22E;">get</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;frequency&#39;</span><span style="color:#F8F8F2;">)</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;">&lt;/li&gt; // [!code ++]</span></span>
<span class="line"><span style="color:#E6DB74;">      &lt;/ul&gt; // [!code ++]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E6DB74;">      &lt;sw-credits .infos=&quot;</span><span style="color:#F92672;">${</span><span style="color:#F8F8F2;">client.config.app</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;">&quot;&gt;&lt;/sw-credits&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">    &lt;/div&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">  `</span><span style="color:#F8F8F2;">, $container);</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6E22E;">renderApp</span><span style="color:#F8F8F2;">();</span></span></code></pre></div><p>If you refresh your web page (<code>Cmd + Shift + R</code>), you should now see the following:</p><p><img src="/assets/states-in-html.Byef7v6E.png" alt="states-in-html"></p><p>So far so good, we have all our states set up and some display of their values.</p><div class="info custom-block"><p class="custom-block-title custom-block-title-default">INFO</p><p>In this tutorial the rendering will be only graphical and we won&#39;t go into the audio details to keep things focused on the shared states. Just keep in mind that the general idea and logic would be exactly the same with some audio rendering instead of graphics.</p></div><p>However, what we miss now is a way to change the values of the states. While we could implement it directly in our <code>player</code> clients, we will go a bit deeper with the <code>StateManager</code> and create a new &quot;controller&quot; client dedicated to this task.</p><h2 id="remote-control-and-monitoring" tabindex="-1">Remote control and monitoring <a class="header-anchor" href="#remote-control-and-monitoring" aria-label="Permalink to “Remote control and monitoring”">​</a></h2><p>In this section we will implement a second client with a specific role dedicated to control and monitor the general state of the application, we will call <code>controller</code>.</p><h3 id="scaffolding-the-controller-client" tabindex="-1">Scaffolding the <em>controller</em> client <a class="header-anchor" href="#scaffolding-the-controller-client" aria-label="Permalink to “Scaffolding the controller client”">​</a></h3><p>Let&#39;s use the soundworks wizard to configure our new client and to create all the boilerplate code.</p><p>Go to the <code>Terminal</code>, shutdown your server (<code>Ctrl + C</code>) and enter the following command:</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki monokai" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#A6E22E;">npx</span><span style="color:#E6DB74;"> soundworks</span><span style="color:#AE81FF;"> --create-client</span></span></code></pre></div><p>Just as when you created the application at the beginning of the tutorial, the soundworks wizard will ask you some questions to configure the client:</p><ol><li>Name this new client <code>controller</code></li><li>Select the <code>browser</code> target</li><li>But this time select the <code>controller</code> template</li></ol><p>Additionally, the wizard will ask you if you want to use this client as the default one (meaning it will be accessible at the root of your website), choose <code>no</code> and confirm.</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki monokai" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#86B42B;">~/tmp/state-manager</span><span style="color:#F8F8F2;"> $ npx soundworks --create-client</span></span>
<span class="line"><span style="color:#666666;">[@soundworks/wizard#v5.0.3]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#56ADBC;"># Create client</span></span>
<span class="line"><span style="color:#86B42B;">✔</span><span style="color:#F8F8F2;font-weight:bold;"> Name of your new client (lowercase, no-space):</span><span style="color:#666666;"> …</span><span style="color:#F8F8F2;"> controller</span></span>
<span class="line"><span style="color:#86B42B;">✔</span><span style="color:#F8F8F2;font-weight:bold;"> Which runtime for your client?</span><span style="color:#666666;"> ›</span><span style="color:#F8F8F2;"> browser</span></span>
<span class="line"><span style="color:#86B42B;">✔</span><span style="color:#F8F8F2;font-weight:bold;"> Which template would you like to use?</span><span style="color:#666666;"> ›</span><span style="color:#F8F8F2;"> controller</span></span>
<span class="line"><span style="color:#86B42B;">✔</span><span style="color:#F8F8F2;font-weight:bold;"> Use this client as default?</span><span style="color:#666666;"> …</span><span> </span><span style="color:#56ADBC;text-decoration:underline;">no</span><span style="color:#666666;"> /</span><span style="color:#F8F8F2;"> yes</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">- Creating client &quot;controller&quot; in file &quot;src/clients/controller.js&quot;</span></span>
<span class="line"><span style="color:#F8F8F2;">- name: </span><span style="color:#56ADBC;">controller</span></span>
<span class="line"><span style="color:#F8F8F2;">- runtime: </span><span style="color:#56ADBC;">browser</span></span>
<span class="line"><span style="color:#F8F8F2;">- template: </span><span style="color:#56ADBC;">controller</span></span>
<span class="line"><span style="color:#F8F8F2;">- default: </span><span style="color:#56ADBC;">false</span></span>
<span class="line"></span>
<span class="line"><span style="color:#86B42B;">✔</span><span style="color:#F8F8F2;font-weight:bold;"> Confirm?</span><span style="color:#666666;"> …</span><span style="color:#F8F8F2;"> no </span><span style="color:#666666;">/</span><span> </span><span style="color:#56ADBC;text-decoration:underline;">yes</span></span>
<span class="line"><span style="color:#86B42B;">+ client controller created and configured</span></span></code></pre></div><p>In your editor you can see that new file <code>src/clients/controller.js</code> has been created by the wizard. This is where we will implement the logic for our &quot;controller&quot; client.</p><p>Now that everything is set up, we can restart our development server and go back to the implementation of our <code>controller</code> client:</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki monokai" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#A6E22E;">npm</span><span style="color:#E6DB74;"> run</span><span style="color:#E6DB74;"> dev</span></span></code></pre></div><p>The controller client will be accessible via the following URL: <a href="http://127.0.0.1:8000/controller" target="_blank" rel="noreferrer">http://127.0.0.1:8000/controller</a></p><div class="tip custom-block"><p class="custom-block-title custom-block-title-default">TIP</p><p>Note that the <code>/controller</code> part of the URL is automatically created by the default router configuration using to the names of the clients.</p></div><h3 id="binding-the-global-state" tabindex="-1">Binding the <code>global</code> state <a class="header-anchor" href="#binding-the-global-state" aria-label="Permalink to “Binding the global state”">​</a></h3><p>Let&#39;s first start with creating the controls for the <code>global</code> shared state. Open the <code>src/clients/controller.js</code> file and add the following code to import all the components provided by the <a href="https://ircam-ismm.github.io/sc-components/" target="_blank" rel="noreferrer">@ircam/sc-components</a> library:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki monokai has-diff" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#88846F;">// src/clients/controller.js</span></span>
<span class="line"><span style="color:#F92672;">import</span><span style="color:#E6DB74;"> &#39;@soundworks/helpers/polyfills.js&#39;</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> { Client } </span><span style="color:#F92672;">from</span><span style="color:#E6DB74;"> &#39;@soundworks/core/client.js&#39;</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> { loadConfig, launcher } </span><span style="color:#F92672;">from</span><span style="color:#E6DB74;"> &#39;@soundworks/helpers/browser.js&#39;</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> { html, render } </span><span style="color:#F92672;">from</span><span style="color:#E6DB74;"> &#39;lit&#39;</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"></span>
<span class="line highlighted diff add"><span style="color:#F92672;">import</span><span style="color:#E6DB74;"> &#39;@ircam/sc-components&#39;</span><span style="color:#F8F8F2;">; </span></span></code></pre></div><p>Importing this file will register new HTML elements that we can now use in our HTML templates. For example, a text element to display parameter names, a slider to control the volume, a toggle button to control the mute parameter, and a number box to control the players&#39; frequencies.</p><div class="info custom-block"><p class="custom-block-title custom-block-title-default">INFO</p><p>Such HTML components are defined using a Web standard called Web Components. See <a href="https://developer.mozilla.org/en-US/docs/Web/Web_Components" target="_blank" rel="noreferrer">https://developer.mozilla.org/en-US/docs/Web/Web_Components</a> for more information.</p></div><p>Then, such as for the <code>player</code>, let&#39;s first attach to the <code>global</code> state</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki monokai has-diff" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#88846F;">// src/clients/controller.js</span></span>
<span class="line"><span style="color:#F92672;">await</span><span style="color:#F8F8F2;"> client.</span><span style="color:#A6E22E;">start</span><span style="color:#F8F8F2;">();</span></span>
<span class="line diff add"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> global </span><span style="color:#F92672;">=</span><span style="color:#F92672;"> await</span><span style="color:#F8F8F2;"> client.stateManager.</span><span style="color:#A6E22E;">attach</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;global&#39;</span><span style="color:#F8F8F2;">); </span></span></code></pre></div><p>Then, let&#39;s create an interface that displays the <code>global</code> state current values using the <a href="https://soundworks.dev/soundworks/SharedState.html#get" target="_blank" rel="noreferrer"><code>global.get</code></a> method:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki monokai has-diff" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#88846F;">// src/clients/controller.js</span></span>
<span class="line"><span style="color:#F92672;">await</span><span style="color:#F8F8F2;"> client.</span><span style="color:#A6E22E;">start</span><span style="color:#F8F8F2;">();</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> global </span><span style="color:#F92672;">=</span><span style="color:#F92672;"> await</span><span style="color:#F8F8F2;"> client.stateManager.</span><span style="color:#A6E22E;">attach</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;global&#39;</span><span style="color:#F8F8F2;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">function</span><span style="color:#A6E22E;"> renderApp</span><span style="color:#F8F8F2;">() {</span></span>
<span class="line"><span style="color:#A6E22E;">  render</span><span style="color:#F8F8F2;">(</span><span style="color:#A6E22E;">html</span><span style="color:#E6DB74;">`</span></span>
<span class="line"><span style="color:#E6DB74;">    &lt;div class=&quot;controller-layout&quot;&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">      &lt;header&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">        &lt;h1&gt;</span><span style="color:#F92672;">${</span><span style="color:#F8F8F2;">client.config.app.name</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;"> | </span><span style="color:#F92672;">${</span><span style="color:#F8F8F2;">client.role</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;">&lt;/h1&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">        &lt;sw-audit .client=&quot;</span><span style="color:#F92672;">${</span><span style="color:#F8F8F2;">client</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;">&quot;&gt;&lt;/sw-audit&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">      &lt;/header&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">      &lt;section&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">        &lt;p&gt;Hello </span><span style="color:#F92672;">${</span><span style="color:#F8F8F2;">client.config.app.name</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;">!&lt;/p&gt; // [!code --]</span></span>
<span class="line"><span style="color:#E6DB74;">        &lt;div&gt; // [!code ++]</span></span>
<span class="line"><span style="color:#E6DB74;">          &lt;h2&gt;Global&lt;/h2&gt; // [!code ++]</span></span>
<span class="line"><span style="color:#E6DB74;">          &lt;div style=&quot;padding-bottom: 4px;&quot;&gt; // [!code ++]</span></span>
<span class="line"><span style="color:#E6DB74;">            &lt;sc-text readonly&gt;volume (dB)&lt;/sc-text&gt; // [!code ++]</span></span>
<span class="line"><span style="color:#E6DB74;">            &lt;sc-slider // [!code ++]</span></span>
<span class="line"><span style="color:#E6DB74;">              min=&quot;-60&quot; // [!code ++]</span></span>
<span class="line"><span style="color:#E6DB74;">              max=&quot;6&quot; // [!code ++]</span></span>
<span class="line diff add"><span style="color:#E6DB74;">              value=</span><span style="color:#F92672;">${</span><span style="color:#F8F8F2;">global.</span><span style="color:#A6E22E;">get</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;volume&#39;</span><span style="color:#F8F8F2;">)</span><span style="color:#F92672;">}</span></span>
<span class="line"><span style="color:#E6DB74;">            &gt;&lt;/sc-slider&gt; // [!code ++]</span></span>
<span class="line"><span style="color:#E6DB74;">          &lt;/div&gt; // [!code ++]</span></span>
<span class="line"><span style="color:#E6DB74;">          &lt;div style=&quot;padding-bottom: 4px;&quot;&gt; // [!code ++]</span></span>
<span class="line"><span style="color:#E6DB74;">            &lt;sc-text readonly&gt;mute&lt;/sc-text&gt; // [!code ++]</span></span>
<span class="line"><span style="color:#E6DB74;">            &lt;sc-toggle // [!code ++]</span></span>
<span class="line diff add"><span style="color:#E6DB74;">              ?active=</span><span style="color:#F92672;">${</span><span style="color:#F8F8F2;">global.</span><span style="color:#A6E22E;">get</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;mute&#39;</span><span style="color:#F8F8F2;">)</span><span style="color:#F92672;">}</span></span>
<span class="line"><span style="color:#E6DB74;">            &gt;&lt;/sc-toggle&gt; // [!code ++]</span></span>
<span class="line"><span style="color:#E6DB74;">          &lt;/div&gt; // [!code ++]</span></span>
<span class="line"><span style="color:#E6DB74;">        &lt;/div&gt; // [!code ++]</span></span>
<span class="line"><span style="color:#E6DB74;">      &lt;/section&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">    &lt;/div&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">  `</span><span style="color:#F8F8F2;">, $container);</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6E22E;">renderApp</span><span style="color:#F8F8F2;">();</span></span></code></pre></div><p>If you refresh your <code>controller</code> page, you should now see the following interface displayed with the <code>global</code> shared state default values correctly displayed:</p><p><img src="/assets/controller-1.xvEyDZNG.png" alt="controller-1"></p><p>However, the binding between the state and the interface is still missing: interacting the interface (e.g. moving the slider or clicking the toggle) does not yet update the shared state values. To fix that, we simply need to use the <a href="https://soundworks.dev/soundworks/SharedState.html#set" target="_blank" rel="noreferrer"><code>global.set</code></a> method and add the following lines of code to update the state when interacting with the interface:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki monokai has-diff" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#88846F;">// src/clients/controller.js</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">function</span><span style="color:#A6E22E;"> renderApp</span><span style="color:#F8F8F2;">() {</span></span>
<span class="line"><span style="color:#A6E22E;">    render</span><span style="color:#F8F8F2;">(</span><span style="color:#A6E22E;">html</span><span style="color:#E6DB74;">`</span></span>
<span class="line"><span style="color:#E6DB74;">      &lt;div class=&quot;controller-layout&quot;&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">        &lt;header&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">          &lt;h1&gt;</span><span style="color:#F92672;">${</span><span style="color:#F8F8F2;">client.config.app.name</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;"> | </span><span style="color:#F92672;">${</span><span style="color:#F8F8F2;">client.role</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;">&lt;/h1&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">          &lt;sw-audit .client=&quot;</span><span style="color:#F92672;">${</span><span style="color:#F8F8F2;">client</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;">&quot;&gt;&lt;/sw-audit&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">        &lt;/header&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">        &lt;section&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">          &lt;div&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">            &lt;h2&gt;Global&lt;/h2&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">            &lt;div style=&quot;padding-bottom: 4px;&quot;&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">              &lt;sc-text readonly&gt;volume (dB)&lt;/sc-text&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">              &lt;sc-slider</span></span>
<span class="line"><span style="color:#E6DB74;">                min=&quot;-60&quot;</span></span>
<span class="line"><span style="color:#E6DB74;">                max=&quot;6&quot;</span></span>
<span class="line"><span style="color:#E6DB74;">                value=</span><span style="color:#F92672;">${</span><span style="color:#F8F8F2;">global.</span><span style="color:#A6E22E;">get</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;volume&#39;</span><span style="color:#F8F8F2;">)</span><span style="color:#F92672;">}</span></span>
<span class="line diff add"><span style="color:#E6DB74;">                @input=</span><span style="color:#F92672;">${</span><span style="color:#FD971F;font-style:italic;">e</span><span style="color:#66D9EF;font-style:italic;"> =&gt;</span><span style="color:#F8F8F2;"> global.</span><span style="color:#A6E22E;">set</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;volume&#39;</span><span style="color:#F8F8F2;">, e.detail.value)</span><span style="color:#F92672;">}</span></span>
<span class="line"><span style="color:#E6DB74;">              &gt;&lt;/sc-slider&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">            &lt;/div&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">            &lt;div style=&quot;padding-bottom: 4px;&quot;&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">              &lt;sc-text readonly&gt;mute&lt;/sc-text&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">              &lt;sc-toggle</span></span>
<span class="line"><span style="color:#E6DB74;">                ?active=</span><span style="color:#F92672;">${</span><span style="color:#F8F8F2;">global.</span><span style="color:#A6E22E;">get</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;mute&#39;</span><span style="color:#F8F8F2;">)</span><span style="color:#F92672;">}</span></span>
<span class="line diff add"><span style="color:#E6DB74;">                @change=</span><span style="color:#F92672;">${</span><span style="color:#FD971F;font-style:italic;">e</span><span style="color:#66D9EF;font-style:italic;"> =&gt;</span><span style="color:#F8F8F2;"> global.</span><span style="color:#A6E22E;">set</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;mute&#39;</span><span style="color:#F8F8F2;">, e.detail.value)</span><span style="color:#F92672;">}</span></span>
<span class="line"><span style="color:#E6DB74;">              &gt;&lt;/sc-toggle&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">            &lt;/div&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">          &lt;/div&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">        &lt;/section&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">      &lt;/div&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">    `</span><span style="color:#F8F8F2;">, $container);</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span></code></pre></div><p>Finally, we just need to tell your interface to re-render itself when the <code>global</code> shared state is updated, using the <a href="https://soundworks.dev/soundworks/SharedState.html#onUpdate" target="_blank" rel="noreferrer"><code>global.onUpdate</code></a> method:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki monokai has-diff" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> global </span><span style="color:#F92672;">=</span><span style="color:#F92672;"> await</span><span style="color:#F8F8F2;"> client.stateManager.</span><span style="color:#A6E22E;">attach</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;global&#39;</span><span style="color:#F8F8F2;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">function</span><span style="color:#A6E22E;"> renderApp</span><span style="color:#F8F8F2;">() {</span></span>
<span class="line"><span style="color:#88846F;">  // ...</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;">// update interface when the shared state values are updated</span></span>
<span class="line diff add"><span style="color:#F8F8F2;">global.</span><span style="color:#A6E22E;">onUpdate</span><span style="color:#F8F8F2;">(() </span><span style="color:#66D9EF;font-style:italic;">=&gt;</span><span style="color:#A6E22E;"> renderApp</span><span style="color:#F8F8F2;">()); </span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6E22E;">renderApp</span><span style="color:#F8F8F2;">();</span></span></code></pre></div><p>Now, if you open <a href="http://127.0.0.1:8000/controller?emulate=2" target="_blank" rel="noreferrer">http://127.0.0.1:8000/controller?emulate=2</a> to emulate two <code>controller</code> clients side by side (see the <code>?emulate=2</code> at the end of the URL), you should see that both interfaces are fully synchronized through the <code>global</code> shared state.</p><p><img src="/assets/controller-2.Bo8RcYUA.png" alt="controller-2"></p><p>Now that our &quot;controller&quot; is ready, let&#39;s go back to our <code>player</code> clients to implement a similar logic to update the screen when the shared states are updated. So let&#39;s re-open the <code>src/clients/player.js</code> file and add the following lines of code:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki monokai has-diff" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#88846F;">// src/clients/player.js</span></span>
<span class="line"><span style="color:#F92672;">await</span><span style="color:#F8F8F2;"> client.</span><span style="color:#A6E22E;">start</span><span style="color:#F8F8F2;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> global </span><span style="color:#F92672;">=</span><span style="color:#F92672;"> await</span><span style="color:#F8F8F2;"> client.stateManager.</span><span style="color:#A6E22E;">attach</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;global&#39;</span><span style="color:#F8F8F2;">);</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> player </span><span style="color:#F92672;">=</span><span style="color:#F92672;"> await</span><span style="color:#F8F8F2;"> client.stateManager.</span><span style="color:#A6E22E;">create</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;player&#39;</span><span style="color:#F8F8F2;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">function</span><span style="color:#A6E22E;"> renderApp</span><span style="color:#F8F8F2;">() {</span></span>
<span class="line"><span style="color:#88846F;">  // ...</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"></span>
<span class="line diff add"><span style="color:#F8F8F2;">global.</span><span style="color:#A6E22E;">onUpdate</span><span style="color:#F8F8F2;">(() </span><span style="color:#66D9EF;font-style:italic;">=&gt;</span><span style="color:#A6E22E;"> renderApp</span><span style="color:#F8F8F2;">()); </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">player.</span><span style="color:#A6E22E;">onUpdate</span><span style="color:#F8F8F2;">(() </span><span style="color:#66D9EF;font-style:italic;">=&gt;</span><span style="color:#A6E22E;"> renderApp</span><span style="color:#F8F8F2;">()); </span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6E22E;">renderApp</span><span style="color:#F8F8F2;">();</span></span></code></pre></div><p>With these two simple lines of code, all the players interfaces are now automatically updated every time a parameter of a shared state is updated.</p><p>To see this in action, open two browser windows side by side and, launch some controller(s) in one of them <a href="http://127.0.0.1:8000/controller?emulate=2" target="_blank" rel="noreferrer">http://127.0.0.1:8000/controller?emulate=2</a> and some players in the other one <a href="http://127.0.0.1:8000/?emulate=2" target="_blank" rel="noreferrer">http://127.0.0.1:8000/?emulate=2</a>. If you manipulate one of the controller you can see that all clients are synced and updated as expected.</p><p><img src="/assets/controller-and-clients-1.Cnt0uv_4.png" alt="controller-and-clients-1"></p><h3 id="observing-and-controlling-collections-of-states" tabindex="-1">Observing and controlling collections of states <a class="header-anchor" href="#observing-and-controlling-collections-of-states" aria-label="Permalink to “Observing and controlling collections of states”">​</a></h3><p>The final thing we want to do is to be able to control the frequency of each player individually from our <code>controller</code> interfaces. To that end, the controller needs to be able to track the creation (and deletion) of all <code>player</code> states in the distributed application. Fortunately, the <code>StateManager</code> gives you access to such functionality.</p><p>Let&#39;s thus create a new <a href="https://soundworks.dev/soundworks/SharedStateCollection.html" target="_blank" rel="noreferrer"><code>SharedStateCollection</code></a> of players and make sure the interface is updated each time a &quot;player&quot; state is created (i.e. when a client connects to the application), deleted (i.e. when a client disconnects from the application), or when a state is updated:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki monokai has-diff" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#88846F;">// src/clients/controller.js</span></span>
<span class="line"><span style="color:#F92672;">await</span><span style="color:#F8F8F2;"> client.</span><span style="color:#A6E22E;">start</span><span style="color:#F8F8F2;">();</span></span>
<span class="line"></span>
<span class="line highlighted"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> global </span><span style="color:#F92672;">=</span><span style="color:#F92672;"> await</span><span style="color:#F8F8F2;"> client.stateManager.</span><span style="color:#A6E22E;">attach</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;global&#39;</span><span style="color:#F8F8F2;">);</span></span>
<span class="line highlighted"><span style="color:#88846F;">// Create a new collection that contains all the player states</span></span>
<span class="line highlighted diff add"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> players </span><span style="color:#F92672;">=</span><span style="color:#F92672;"> await</span><span style="color:#F8F8F2;"> client.stateManager.</span><span style="color:#A6E22E;">getCollection</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;player&#39;</span><span style="color:#F8F8F2;">); </span></span>
<span class="line highlighted"><wbr></span>
<span class="line highlighted"><span style="color:#66D9EF;font-style:italic;">function</span><span style="color:#A6E22E;"> renderApp</span><span style="color:#F8F8F2;">() {</span></span>
<span class="line highlighted"><span style="color:#88846F;">  // ...</span></span>
<span class="line highlighted"><span style="color:#F8F8F2;">}</span></span>
<span class="line highlighted"><wbr></span>
<span class="line highlighted"><span style="color:#88846F;">// update interface when the shared state values are updated</span></span>
<span class="line highlighted"><span style="color:#F8F8F2;">global.</span><span style="color:#A6E22E;">onUpdate</span><span style="color:#F8F8F2;">(() </span><span style="color:#66D9EF;font-style:italic;">=&gt;</span><span style="color:#A6E22E;"> renderApp</span><span style="color:#F8F8F2;">());</span></span>
<span class="line highlighted diff add"><span style="color:#F8F8F2;">players.</span><span style="color:#A6E22E;">onChange</span><span style="color:#F8F8F2;">(() </span><span style="color:#66D9EF;font-style:italic;">=&gt;</span><span style="color:#A6E22E;"> renderApp</span><span style="color:#F8F8F2;">()); </span><span style="color:#88846F;">// when a state is created, deleted or updated</span></span></code></pre></div><p>Finally, let&#39;s just update our HTML template to display the frequency control for all <code>player</code> shared states:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki monokai has-diff" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#A6E22E;">render</span><span style="color:#F8F8F2;">(</span><span style="color:#A6E22E;">html</span><span style="color:#E6DB74;">`</span></span>
<span class="line"><span style="color:#E6DB74;">  &lt;header&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">    // ...</span></span>
<span class="line"><span style="color:#E6DB74;">  &lt;/header&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">  &lt;section&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">    &lt;div&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">      &lt;h2&gt;Global&lt;/h2&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">      // ...</span></span>
<span class="line"><span style="color:#E6DB74;">    &lt;/div&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">    &lt;div&gt; // [!code ++]</span></span>
<span class="line"><span style="color:#E6DB74;">      &lt;h2&gt;Players&lt;/h2&gt; // [!code ++]</span></span>
<span class="line diff add"><span style="color:#F92672;">      ${</span><span style="color:#F8F8F2;">players.</span><span style="color:#A6E22E;">map</span><span style="color:#F8F8F2;">(</span><span style="color:#FD971F;font-style:italic;">player</span><span style="color:#66D9EF;font-style:italic;"> =&gt;</span><span style="color:#F8F8F2;"> { </span></span>
<span class="line"><span style="color:#F92672;">        return</span><span style="color:#A6E22E;"> html</span><span style="color:#E6DB74;">` // [!code ++]</span></span>
<span class="line"><span style="color:#E6DB74;">          &lt;div&gt; // [!code ++]</span></span>
<span class="line"><span style="color:#E6DB74;">            &lt;sc-text&gt;frequency&lt;/sc-text&gt; // [!code ++]</span></span>
<span class="line"><span style="color:#E6DB74;">            &lt;sc-number // [!code ++]</span></span>
<span class="line diff add"><span style="color:#E6DB74;">              min=</span><span style="color:#F92672;">${</span><span style="color:#F8F8F2;">player.</span><span style="color:#A6E22E;">getDescription</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;frequency&#39;</span><span style="color:#F8F8F2;">).min</span><span style="color:#F92672;">}</span></span>
<span class="line diff add"><span style="color:#E6DB74;">              max=</span><span style="color:#F92672;">${</span><span style="color:#F8F8F2;">player.</span><span style="color:#A6E22E;">getDescription</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;frequency&#39;</span><span style="color:#F8F8F2;">).max</span><span style="color:#F92672;">}</span></span>
<span class="line diff add"><span style="color:#E6DB74;">              value=</span><span style="color:#F92672;">${</span><span style="color:#F8F8F2;">player.</span><span style="color:#A6E22E;">get</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;frequency&#39;</span><span style="color:#F8F8F2;">)</span><span style="color:#F92672;">}</span></span>
<span class="line diff add"><span style="color:#E6DB74;">              @input=</span><span style="color:#F92672;">${</span><span style="color:#FD971F;font-style:italic;">e</span><span style="color:#66D9EF;font-style:italic;"> =&gt;</span><span style="color:#F8F8F2;"> player.</span><span style="color:#A6E22E;">set</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;frequency&#39;</span><span style="color:#F8F8F2;">, e.detail.value)</span><span style="color:#F92672;">}</span></span>
<span class="line"><span style="color:#E6DB74;">            &gt;&lt;/sc-number&gt; // [!code ++]</span></span>
<span class="line"><span style="color:#E6DB74;">          &lt;/div&gt; // [!code ++]</span></span>
<span class="line diff add"><span style="color:#E6DB74;">        `</span></span>
<span class="line diff add"><span style="color:#F8F8F2;">      })</span><span style="color:#F92672;">}</span></span>
<span class="line"><span style="color:#E6DB74;">    &lt;/div&gt; // [!code ++]</span></span>
<span class="line"><span style="color:#E6DB74;">  &lt;/section&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">`</span><span style="color:#F8F8F2;">, $container);</span></span></code></pre></div><p>Now if you open two browser windows and launch a controller <a href="http://127.0.0.1:8000/controller" target="_blank" rel="noreferrer">http://127.0.0.1:8000/controller</a> and a player <a href="http://127.0.0.1:8000/" target="_blank" rel="noreferrer">http://127.0.0.1:8000/</a>, you will see that you can control the frequency of the player from the controller.</p><p><img src="/assets/controller-and-clients-2.BwCT7Ojw.png" alt="controller-and-clients-2"></p><p>However, there is still an issue with our interface: if we emulate several <code>player</code> clients, e.g. <a href="http://127.0.0.1:8000/?emulate=5" target="_blank" rel="noreferrer">http://127.0.0.1:8000/?emulate=5</a>, we can see that we have no way to know which control corresponds to which player:</p><p><img src="/assets/badly-defined-players.Cv7T2oo5.png" alt="badly-defined-players"></p><p>Let&#39;s review our code a bit to handle this problem.</p><h3 id="using-the-client-id-to-enhance-the-control-interface" tabindex="-1">Using the client id to enhance the control interface <a class="header-anchor" href="#using-the-client-id-to-enhance-the-control-interface" aria-label="Permalink to “Using the client id to enhance the control interface”">​</a></h3><p>To fix this problem, let&#39;s just use the id that is automatically given by <em>soundworks</em> to each client when it connects, to share it within the <code>player</code> state.</p><p>So first, let&#39;s add a new parameter called <code>id</code> of type <code>integer</code> to our <code>player</code> schema to store this value:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki monokai has-diff" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#88846F;">// src/state-descriptions/player.js</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F92672;"> default</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line highlighted diff add"><span style="color:#F8F8F2;">  id: { </span></span>
<span class="line highlighted diff add"><span style="color:#F8F8F2;">    type: </span><span style="color:#E6DB74;">&#39;integer&#39;</span><span style="color:#F8F8F2;">, </span></span>
<span class="line highlighted diff add"><span style="color:#F8F8F2;">    default: </span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">, </span></span>
<span class="line highlighted diff add"><span style="color:#F8F8F2;">  }, </span></span>
<span class="line"><span style="color:#F8F8F2;">  frequency: {</span></span>
<span class="line"><span style="color:#F8F8F2;">    type: </span><span style="color:#E6DB74;">&#39;float&#39;</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#F8F8F2;">    min: </span><span style="color:#AE81FF;">50</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#F8F8F2;">    max: </span><span style="color:#AE81FF;">1000</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#F8F8F2;">    default: </span><span style="color:#AE81FF;">440</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#F8F8F2;">  },</span></span>
<span class="line"><span style="color:#F8F8F2;">};</span></span></code></pre></div><p>Second, let&#39;s review our <code>player</code> client code to:</p><ol><li>pass the client id to the shared state when it is created by the client</li></ol><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki monokai has-diff" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#88846F;">// src/clients/player/index.js</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> global </span><span style="color:#F92672;">=</span><span style="color:#F92672;"> await</span><span style="color:#F8F8F2;"> client.stateManager.</span><span style="color:#A6E22E;">attach</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;global&#39;</span><span style="color:#F8F8F2;">);</span></span>
<span class="line"><span style="color:#88846F;">// create the player state with the client id</span></span>
<span class="line diff remove"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> player </span><span style="color:#F92672;">=</span><span style="color:#F92672;"> await</span><span style="color:#F8F8F2;"> client.stateManager.</span><span style="color:#A6E22E;">create</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;player&#39;</span><span style="color:#F8F8F2;">) </span></span>
<span class="line diff add"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> player </span><span style="color:#F92672;">=</span><span style="color:#F92672;"> await</span><span style="color:#F8F8F2;"> client.stateManager.</span><span style="color:#A6E22E;">create</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;player&#39;</span><span style="color:#F8F8F2;">, { id: client.id }); </span></span></code></pre></div><ol start="2"><li>and display the <code>client.id</code> in the player interface:</li></ol><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki monokai" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#88846F;">// src/clients/player/index.js</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">function</span><span style="color:#A6E22E;"> renderApp</span><span style="color:#F8F8F2;">() {</span></span>
<span class="line"><span style="color:#A6E22E;">  render</span><span style="color:#F8F8F2;">(</span><span style="color:#A6E22E;">html</span><span style="color:#E6DB74;">`</span></span>
<span class="line"><span style="color:#E6DB74;">    &lt;div class=&quot;simple-layout&quot;&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">      &lt;h1&gt;Player </span><span style="color:#F92672;">${</span><span style="color:#F8F8F2;">player.</span><span style="color:#A6E22E;">get</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;id&#39;</span><span style="color:#F8F8F2;">)</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;">&lt;/h1&gt; // [!code ++]</span></span>
<span class="line"><span style="color:#E6DB74;">      &lt;h2&gt;Global&lt;/h2&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">      // ...</span></span>
<span class="line"><span style="color:#E6DB74;">    &lt;/div&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">  `</span><span style="color:#F8F8F2;">, $container);</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre></div><p>Finally, let&#39;s just display this information in the controller interface:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki monokai" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#88846F;">// src/clients/controller/index.js</span></span>
<span class="line"><span style="color:#F8F8F2;">${players.</span><span style="color:#A6E22E;">map</span><span style="color:#F8F8F2;">(</span><span style="color:#FD971F;font-style:italic;">player</span><span style="color:#66D9EF;font-style:italic;"> =&gt;</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F92672;">  return</span><span style="color:#A6E22E;"> html</span><span style="color:#E6DB74;">`</span></span>
<span class="line"><span style="color:#E6DB74;">    &lt;div&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">      &lt;sc-text&gt;frequency&lt;/sc-text&gt; // [!code --]</span></span>
<span class="line"><span style="color:#E6DB74;">      &lt;sc-text&gt;player </span><span style="color:#F92672;">${</span><span style="color:#F8F8F2;">player.</span><span style="color:#A6E22E;">get</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;id&#39;</span><span style="color:#F8F8F2;">)</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;"> - frequency&lt;/sc-text&gt; // [!code ++]</span></span>
<span class="line"><span style="color:#E6DB74;">      &lt;sc-number</span></span>
<span class="line"><span style="color:#E6DB74;">        min=</span><span style="color:#F92672;">${</span><span style="color:#F8F8F2;">player.</span><span style="color:#A6E22E;">getDescription</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;frequency&#39;</span><span style="color:#F8F8F2;">).min</span><span style="color:#F92672;">}</span></span>
<span class="line"><span style="color:#E6DB74;">        max=</span><span style="color:#F92672;">${</span><span style="color:#F8F8F2;">player.</span><span style="color:#A6E22E;">getDescription</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;frequency&#39;</span><span style="color:#F8F8F2;">).max</span><span style="color:#F92672;">}</span></span>
<span class="line"><span style="color:#E6DB74;">        value=</span><span style="color:#F92672;">${</span><span style="color:#F8F8F2;">player.</span><span style="color:#A6E22E;">get</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;frequency&#39;</span><span style="color:#F8F8F2;">)</span><span style="color:#F92672;">}</span></span>
<span class="line"><span style="color:#E6DB74;">        @input=</span><span style="color:#F92672;">${</span><span style="color:#FD971F;font-style:italic;">e</span><span style="color:#66D9EF;font-style:italic;"> =&gt;</span><span style="color:#F8F8F2;"> player.</span><span style="color:#A6E22E;">set</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;frequency&#39;</span><span style="color:#F8F8F2;">, e.detail.value)</span><span style="color:#F92672;">}</span></span>
<span class="line"><span style="color:#E6DB74;">      &gt;&lt;/sc-number&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">    &lt;/div&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">  `</span></span>
<span class="line"><span style="color:#F8F8F2;">})}</span></span></code></pre></div><p>Now, if you open a controller (<a href="http://127.0.0.1:8000/controller" target="_blank" rel="noreferrer">http://127.0.0.1:8000/controller</a>) and several players (<a href="http://127.0.0.1:8000/?emulate=3" target="_blank" rel="noreferrer">http://127.0.0.1:8000/?emulate=3</a>) side by side, you should see a more useful interface:</p><p><img src="/assets/controller-player-final.DRG7lytw.png" alt="controller-player-final"></p><h2 id="conclusion" tabindex="-1">Conclusion <a class="header-anchor" href="#conclusion" aria-label="Permalink to “Conclusion”">​</a></h2><p>In this tutorial, you learned how to use the <em>soundworks</em> distributed state management system which we consider one of its most powerful and versatile feature.</p><p>You have seen how to create global states that are common to all clients of the application, how to use them to describe the state of each client and how use them to implement remote control and monitoring interfaces using shared state collections. Along the way, you have seen how to use the <em>soundworks</em> wizard within your application (i.e. <code>npx soundworks</code>).</p><p>In the next tutorial, we will see how to extend the possibilities of <em>soundworks</em> with plugins. For this first dive into plugins we will use the <code>@soundworks/plugin-platform-init</code> plugin that is meant to simplify some redundant and cumbersome tasks such as resuming the audio context, etc.</p></div></div></main><footer class="VPDocFooter" data-v-d668f7cc data-v-1bcd8184><!--[--><!--]--><!----><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-1bcd8184><span class="visually-hidden" id="doc-footer-aria-label" data-v-1bcd8184>Pager</span><div class="pager" data-v-1bcd8184><a class="VPLink link pager-link prev" href="/tutorials/getting-started.html" data-v-1bcd8184><!--[--><span class="desc" data-v-1bcd8184>Previous page</span><span class="title" data-v-1bcd8184>Getting Started</span><!--]--></a></div><div class="pager" data-v-1bcd8184><a class="VPLink link pager-link next" href="/tutorials/plugin-platform-init.html" data-v-1bcd8184><!--[--><span class="desc" data-v-1bcd8184>Next page</span><span class="title" data-v-1bcd8184>Using Plugins 1 - <i>platform-init</i></span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"api.md\":\"Hy3wBnac\",\"credits.md\":\"BrA1Pzee\",\"ecosystem_ecosystem.md\":\"BA_RphpA\",\"index.md\":\"C18x0pat\",\"introduction.md\":\"1VoA1VB0\",\"misc__contributing-to-this-site.md\":\"CYeTkNSK\",\"misc__deployment.md\":\"BngYWeyB\",\"misc__local-deployment.md\":\"GnHl-ltB\",\"misc__todo_electron-applications.md\":\"CC5baAKP\",\"misc_websockets-101.md\":\"C-gXDMS3\",\"plugins_checkin.md\":\"C6RM-Tm2\",\"plugins_filesystem.md\":\"FMZlAHa5\",\"plugins_license.md\":\"BACUdzM4\",\"plugins_logger.md\":\"WkoUpJQD\",\"plugins_platform-init.md\":\"CpKNubvr\",\"plugins_position.md\":\"IHw_x8tv\",\"plugins_scripting.md\":\"BmalzbyY\",\"plugins_soundworks-helpers.md\":\"Csh1b2RR\",\"plugins_sync.md\":\"BcOxYxrv\",\"recipes_working-with-max.md\":\"B376Sw62\",\"tools_helpers.md\":\"CZZB8W_o\",\"tools_license.md\":\"BbonFmD2\",\"tutorials__connected-lamp.md\":\"BNjt-enF\",\"tutorials__context.md\":\"BjuHZuxh\",\"tutorials_getting-started.md\":\"BpaQKx_Z\",\"tutorials_node-clients.md\":\"C9rZi5xs\",\"tutorials_plugin-platform-init.md\":\"CVSQ4ZSt\",\"tutorials_plugin-sync.md\":\"BD1vtBCG\",\"tutorials_state-manager.md\":\"DL2GqnxU\",\"tutorials_step-sequencer.md\":\"CBp3A5Ak\",\"tutorials_todo-noise.md\":\"C57Po1TH\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"soundworks\",\"description\":\"Creative coding framework for distributed applications based on Web technologies\",\"base\":\"/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"logo\":\"/logo-nav.png\",\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/collective-soundworks/collective-soundworks.github.io\"}],\"search\":{\"provider\":\"local\"},\"nav\":[{\"text\":\"Guide\",\"link\":\"/tutorials/getting-started\"},{\"text\":\"soundworks API\",\"link\":\"https://soundworks.dev/soundworks\"},{\"text\":\"Credits\",\"link\":\"/credits\"}],\"sidebar\":[{\"text\":\"Introduction\",\"link\":\"/introduction\"},{\"text\":\"Tutorials\",\"items\":[{\"text\":\"Getting Started\",\"link\":\"/tutorials/getting-started\"},{\"text\":\"Using the State Manager\",\"link\":\"/tutorials/state-manager\"},{\"text\":\"Using Plugins 1 - <i>platform-init</i>\",\"link\":\"/tutorials/plugin-platform-init\"},{\"text\":\"The <i>Todo Noise</i> Application\",\"link\":\"/tutorials/todo-noise\"},{\"text\":\"Working with Node Clients\",\"link\":\"/tutorials/node-clients\"},{\"text\":\"Using Plugins 2 - <i>sync</i>\",\"link\":\"/tutorials/plugin-sync\"},{\"text\":\"Distributed Step Sequencer\",\"link\":\"/tutorials/step-sequencer\"}]},{\"text\":\"Recipes\",\"items\":[{\"text\":\"Working with Max\",\"link\":\"/recipes/working-with-max\"}]},{\"text\":\"Documentation\",\"items\":[{\"text\":\"soundworks API\",\"link\":\"https://soundworks.dev/soundworks\"},{\"text\":\"Helpers\",\"link\":\"/tools/helpers\"},{\"text\":\"Plugin Platform Init\",\"link\":\"/plugins/platform-init\"},{\"text\":\"Plugin Sync\",\"link\":\"/plugins/sync\"},{\"text\":\"Plugin Filesystem\",\"link\":\"/plugins/filesystem\"},{\"text\":\"Plugin Scripting\",\"link\":\"/plugins/scripting\"},{\"text\":\"Plugin Checkin\",\"link\":\"/plugins/checkin\"},{\"text\":\"Plugin Position\",\"link\":\"/plugins/position\"},{\"text\":\"Plugin Logger\",\"link\":\"/plugins/logger\"}]},{\"text\":\"Ecosystem\",\"items\":[{\"text\":\"node-web-audio-api\",\"link\":\"https://github.com/ircam-ismm/node-web-audio-api/\"},{\"text\":\"@ircam/sc-components\",\"link\":\"https://github.com/ircam-ismm/sc-components/\"},{\"text\":\"@ircam/sc-utils\",\"link\":\"https://github.com/ircam-ismm/sc-utils\"},{\"text\":\"@ircam/sc-scheduling\",\"link\":\"https://github.com/ircam-ismm/sc-scheduling/\"},{\"text\":\"@ircam/devicemotion\",\"link\":\"https://github.com/ircam-ismm/devicemotion\"},{\"text\":\"dotpi tools\",\"link\":\"https://ircam-ismm.github.io/dotpi/\"}]},{\"text\":\"Misc\",\"items\":[{\"text\":\"WebSockets 101\",\"link\":\"/misc/websockets-101\"}]}]},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false,\"additionalConfig\":{}}");</script>
    
  </body>
</html>