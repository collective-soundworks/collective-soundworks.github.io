<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Using the StateManager and SharedStates | soundworks</title>
    <meta name="description" content="Creative coding framework for distributed applications based on Web technologies">
    <link rel="stylesheet" href="/assets/style.318fd275.css">
    <link rel="modulepreload" href="/assets/chunks/virtual_search-data.5eb2330c.js">
    <link rel="modulepreload" href="/assets/app.9503f83c.js">
    <link rel="modulepreload" href="/assets/tutorials_state-manager.md.b8c04c58.lean.js">
    
    <script id="check-dark-light">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-f44a984a><!--[--><!--]--><!--[--><span tabindex="-1" data-v-151f2593></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-151f2593> Skip to content </a><!--]--><!----><header class="VPNav" data-v-f44a984a data-v-a50780ff><div class="VPNavBar has-sidebar" data-v-a50780ff data-v-6f1d18b5><div class="container" data-v-6f1d18b5><div class="VPNavBarTitle has-sidebar" data-v-6f1d18b5 data-v-d5925166><a class="title" href="/" data-v-d5925166><!--[--><!--]--><!--[--><img class="VPImage logo" src="/logo-nav.png" alt data-v-b7ac6bd3><!--]--><!--[-->soundworks<!--]--><!--[--><!--]--></a></div><div class="content" data-v-6f1d18b5><!--[--><!--]--><div class="VPNavBarSearch search" data-v-6f1d18b5><!----><div id="docsearch"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><span class="DocSearch-Button-Key">Meta</span><span class="DocSearch-Button-Key">K</span></span></button></div></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-6f1d18b5 data-v-f83db6ba><span id="main-nav-aria-label" class="visually-hidden" data-v-f83db6ba>Main Navigation</span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/guide/getting-started.html" data-v-f83db6ba data-v-47a2263e data-v-3c355974><!--[-->Guide<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="https://soundworks.dev/soundworks" target="_blank" rel="noreferrer" data-v-f83db6ba data-v-47a2263e data-v-3c355974><!--[-->API Reference<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/credits.html" data-v-f83db6ba data-v-47a2263e data-v-3c355974><!--[-->Credits<!--]--><!----></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-6f1d18b5 data-v-a3e7452b><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-label="toggle dark mode" aria-checked="false" data-v-a3e7452b data-v-481098f9 data-v-eba7420e><span class="check" data-v-eba7420e><span class="icon" data-v-eba7420e><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-481098f9><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-481098f9><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-6f1d18b5 data-v-738bef5a data-v-f6988cfb><!--[--><a class="VPSocialLink" href="https://github.com/collective-soundworks/soundworks" target="_blank" rel="noopener" data-v-f6988cfb data-v-e57698f6><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-6f1d18b5 data-v-e4361c82 data-v-6ffb57d3><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-6ffb57d3><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-6ffb57d3><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-6ffb57d3><div class="VPMenu" data-v-6ffb57d3 data-v-1c5d0cfc><!----><!--[--><!--[--><!----><div class="group" data-v-e4361c82><div class="item appearance" data-v-e4361c82><p class="label" data-v-e4361c82>Appearance</p><div class="appearance-action" data-v-e4361c82><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-label="toggle dark mode" aria-checked="false" data-v-e4361c82 data-v-481098f9 data-v-eba7420e><span class="check" data-v-eba7420e><span class="icon" data-v-eba7420e><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-481098f9><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-481098f9><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div></div></div><div class="group" data-v-e4361c82><div class="item social-links" data-v-e4361c82><div class="VPSocialLinks social-links-list" data-v-e4361c82 data-v-f6988cfb><!--[--><a class="VPSocialLink" href="https://github.com/collective-soundworks/soundworks" target="_blank" rel="noopener" data-v-f6988cfb data-v-e57698f6><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-6f1d18b5 data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div><!----></header><div class="VPLocalNav" data-v-f44a984a data-v-b6162a8b><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-b6162a8b><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="menu-icon" data-v-b6162a8b><path d="M17,11H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,11,17,11z"></path><path d="M21,7H3C2.4,7,2,6.6,2,6s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,7,21,7z"></path><path d="M21,15H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,15,21,15z"></path><path d="M17,19H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,19,17,19z"></path></svg><span class="menu-text" data-v-b6162a8b>Menu</span></button><a class="top-link" href="#" data-v-b6162a8b> Return to top </a></div><aside class="VPSidebar" data-v-f44a984a data-v-a186aa16><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-a186aa16><span class="visually-hidden" id="sidebar-aria-label" data-v-a186aa16> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="group" data-v-a186aa16><section class="VPSidebarGroup" data-v-a186aa16 data-v-6e45c352><!----><div class="items" data-v-6e45c352><!--[--><!--[--><a class="VPLink link link" href="/guide/getting-started.html" style="padding-left:0px;" data-v-36b976d1 data-v-3c355974><!--[--><span class="link-text" data-v-36b976d1>Getting Started</span><!--]--><!----></a><!----><!--]--><!--]--></div></section></div><div class="group" data-v-a186aa16><section class="VPSidebarGroup" data-v-a186aa16 data-v-6e45c352><div class="title" data-v-6e45c352><h2 class="title-text" data-v-6e45c352>Tutorials</h2><div class="action" data-v-6e45c352><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-6e45c352><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-6e45c352><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-6e45c352><!--[--><!--[--><a class="VPLink link link active" href="/tutorials/state-manager.html" style="padding-left:0px;" data-v-36b976d1 data-v-3c355974><!--[--><span class="link-text" data-v-36b976d1>Using the State Manager</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/tutorials/contexts.html" style="padding-left:0px;" data-v-36b976d1 data-v-3c355974><!--[--><span class="link-text" data-v-36b976d1>Using Contexts</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/tutorials/plugin-platform.html" style="padding-left:0px;" data-v-36b976d1 data-v-3c355974><!--[--><span class="link-text" data-v-36b976d1>Using Plugins 1 - Platform</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/tutorials/todo-noise.html" style="padding-left:0px;" data-v-36b976d1 data-v-3c355974><!--[--><span class="link-text" data-v-36b976d1>The "Todo Noise" App</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/tutorials/plugin-sync.html" style="padding-left:0px;" data-v-36b976d1 data-v-3c355974><!--[--><span class="link-text" data-v-36b976d1>Using Plugins 2 - Sync</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/tutorials/synchronized-audio-scheduling.html" style="padding-left:0px;" data-v-36b976d1 data-v-3c355974><!--[--><span class="link-text" data-v-36b976d1>Synchronized Scheduling</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/tutorials/plugin-scripting.html" style="padding-left:0px;" data-v-36b976d1 data-v-3c355974><!--[--><span class="link-text" data-v-36b976d1>Using Plugins 3 - Scripting</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/tutorials/node-clients.html" style="padding-left:0px;" data-v-36b976d1 data-v-3c355974><!--[--><span class="link-text" data-v-36b976d1>Working with Node Clients</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/tutorials/customizing-init-screens.html" style="padding-left:0px;" data-v-36b976d1 data-v-3c355974><!--[--><span class="link-text" data-v-36b976d1>Customize the Init Screens</span><!--]--><!----></a><!----><!--]--><!--]--></div></section></div><div class="group" data-v-a186aa16><section class="VPSidebarGroup" data-v-a186aa16 data-v-6e45c352><div class="title" data-v-6e45c352><h2 class="title-text" data-v-6e45c352>Ecosystem</h2><div class="action" data-v-6e45c352><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-6e45c352><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-6e45c352><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-6e45c352><!--[--><!--[--><a class="VPLink link link" href="/ecosystem/soundworks.html" style="padding-left:0px;" data-v-36b976d1 data-v-3c355974><!--[--><span class="link-text" data-v-36b976d1>Soundworks Ecosystem</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/tutorials/related-libraries.html" style="padding-left:0px;" data-v-36b976d1 data-v-3c355974><!--[--><span class="link-text" data-v-36b976d1>Related Libraries and Tools</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/tutorials/generic%20applications.html" style="padding-left:0px;" data-v-36b976d1 data-v-3c355974><!--[--><span class="link-text" data-v-36b976d1>Generic Applications</span><!--]--><!----></a><!----><!--]--><!--]--></div></section></div><div class="group" data-v-a186aa16><section class="VPSidebarGroup" data-v-a186aa16 data-v-6e45c352><div class="title" data-v-6e45c352><h2 class="title-text" data-v-6e45c352>Misc</h2><div class="action" data-v-6e45c352><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-6e45c352><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-6e45c352><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-6e45c352><!--[--><!--[--><a class="VPLink link link active" href="/tutorials/state-manager.html" style="padding-left:0px;" data-v-36b976d1 data-v-3c355974><!--[--><span class="link-text" data-v-36b976d1>Using the State Manager</span><!--]--><!----></a><!----><!--]--><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-f44a984a data-v-d981fe29><div class="VPDoc has-sidebar has-aside" data-v-d981fe29 data-v-cfb513e0><div class="container" data-v-cfb513e0><div class="aside" data-v-cfb513e0><div class="aside-curtain" data-v-cfb513e0></div><div class="aside-container" data-v-cfb513e0><div class="aside-content" data-v-cfb513e0><div class="VPDocAside" data-v-cfb513e0 data-v-afc4c1a1><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline" data-v-afc4c1a1 data-v-2865c0b0><div class="content" data-v-2865c0b0><div class="outline-marker" data-v-2865c0b0></div><div class="outline-title" data-v-2865c0b0>On this page</div><nav aria-labelledby="doc-outline-aria-label" data-v-2865c0b0><span class="visually-hidden" id="doc-outline-aria-label" data-v-2865c0b0> Table of Contents for current page </span><ul class="root" data-v-2865c0b0 data-v-1188541a><!--[--><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-afc4c1a1></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-cfb513e0><div class="content-container" data-v-cfb513e0><!--[--><!--]--><main class="main" data-v-cfb513e0><div style="position:relative;" class="vp-doc _tutorials_state-manager" data-v-cfb513e0><div><h1 id="using-the-statemanager-and-sharedstates" tabindex="-1">Using the <code>StateManager</code> and <code>SharedState</code>s <a class="header-anchor" href="#using-the-statemanager-and-sharedstates" aria-hidden="true">#</a></h1><p>In this tutorial, we learn the why and how of the <code>soundworks</code> state manager and shared states. More precisely, we will see how the create shared global and local states, and how this pattern helps to implement remote control and monitoring of clients of your application.</p><p>Along the way, you will see how <code>StateManager</code> component can simplify the development of application by abstracting in large parts the network communications and routing.</p><p><strong>Relevant API documentation pages</strong></p><ul><li><a href="./.html">client.StateManager</a></li><li><a href="./.html">client.SharedState</a></li><li><a href="./.html">server.StateManager</a></li><li><a href="./.html">server.SharedState</a></li></ul><h2 id="overview" tabindex="-1">Overview <a class="header-anchor" href="#overview" aria-hidden="true">#</a></h2><h3 id="the-why" tabindex="-1">The &quot;Why&quot; <a class="header-anchor" href="#the-why" aria-hidden="true">#</a></h3><p>First of all, let&#39;s start with a bit of theory to understand the concepts and general logic behind the <code>soundworks</code>&#39; shared states.</p><p>Most of the time, we think of an application as &quot;something&quot; that runs on a computer with which a user can interact in some way. The idea of <em>distributed application</em> -- which is what <code>soundworks</code> aims at promoting and supporting -- extends this idea to an application that runs at the same time on several computer and where several users can interact at the same time.</p><p><img src="/assets/distributed-application.7e2a461a.png" alt="distributed-application"></p><p>Additionnaly, in the context of creative applications, it can be very important to be able to have some simple way to monitor and/or control the state of a distant client. This is true both during the development of the artwork / application, e.g. to tweak some synthesizer on distant machines from a central point (even in the studio, modifying some parameters on several machines can get very cumbersome), as well as during the performance, e.g. to control the general volume, to change the color of the screen of every clients at the same time etc.</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>When we speak of a &quot;node of the network&quot;, we mean both the clients and the server. Indeed, from the point of the of the distrubuted state management system proposed by <code>soundworks</code>, the server is a node just as the clients, which has certain additionnal features allowed by its central role.</p></div><p>The <code>SharedManager</code> and the <code>SharedState</code> abstraction provided by <code>soundworks</code> provide a simple way to define and synchronize some sets of parameters, that are of interest by multiple clients, while abstracting all the network communications involved.</p><h3 id="the-how" tabindex="-1">The &quot;How&quot; <a class="header-anchor" href="#the-how" aria-hidden="true">#</a></h3><p>From a more technical point of view, the <code>SharedState</code> can be seen as circular dataflow pattern (loosely inspired by the <a href="https://facebook.github.io/flux/docs/in-depth-overview" target="_blank" rel="noreferrer"><em>flux</em></a> pattern proposed by <em>Facebook</em>) adapted to the particular needs of real-time distributed applications.</p><p>Hence, in soundworks <code>SharedState</code>s, the dataflow follows a circular path that is always synchronized with the server. For example, if we follow the flow of data in the graph below, we can see that when an input (e.g. some user gesture) triggers a change in the state of a client (arrow 1, red), a data synchronization is automatically made with a server-side representation of the state through WebSockets (arrow 2), which in turn triggers a change in the rendering (be it audio or visual).</p><p>This simple pattern enables an important feature: any other node can make a change on the same server-side representation of the state (arrow 1&#39;, blue), while triggering 2 and 3 in a completely transparent way.</p><p><img src="/assets/distributed-state-management.d09470bb.png" alt="distributed-application"></p><p>--&gt; review after this point</p><h2 id="declaring-schemas" tabindex="-1">Declaring Schemas <a class="header-anchor" href="#declaring-schemas" aria-hidden="true">#</a></h2><p>The <code>stateManager</code> component makes use of schemas that declare a set of attributes and their properties (you can think of it has the schema of a database table). The schema syntax follows the format described in <a href="https://github.com/ircam-jstools/parameters" target="_blank" rel="noreferrer">https://github.com/ircam-jstools/parameters</a>.</p><p>In this application two schemas are declared (cf. <code>src/server/schemas/</code>, note that the <code>schema</code> directory is not mandatory but looks like a good practice to keep things clean).</p><ul><li>the <code>globals</code> schema (cf. <code>src/server/schemas/globals.js</code>) is meant to declare a state that will be created by the server, and will thus be unique across the whole application. Every client will be able to attach to the created state, but we guarantee that this state will be kept identical across all of the clients. Here, the schema declares a global <code>master</code> volume and a <code>mute</code> flag.</li></ul><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki"><code><span class="line"><span style="color:#88846F;">// `src/server/schemas/globals.js`</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">default</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#88846F;">// master volume in dB [-60, 6]</span></span>
<span class="line"><span style="color:#F8F8F2;">  master: {</span></span>
<span class="line"><span style="color:#F8F8F2;">    type: </span><span style="color:#E6DB74;">&#39;integer&#39;</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#F8F8F2;">    min: </span><span style="color:#F92672;">-</span><span style="color:#AE81FF;">60</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#F8F8F2;">    max: </span><span style="color:#AE81FF;">6</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#F8F8F2;">    step: </span><span style="color:#AE81FF;">1</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#F8F8F2;">    default: </span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#F8F8F2;">  },</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#88846F;">// mute [true, false]</span></span>
<span class="line"><span style="color:#F8F8F2;">  mute: {</span></span>
<span class="line"><span style="color:#F8F8F2;">    type: </span><span style="color:#E6DB74;">&#39;boolean&#39;</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#F8F8F2;">    default: </span><span style="color:#AE81FF;">false</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#F8F8F2;">  },</span></span>
<span class="line"><span style="color:#F8F8F2;">};</span></span>
<span class="line"></span></code></pre></div><ul><li>the <code>player</code> schema is dedicated to describing the state of a single player client, meaning that each player will instantiate its own instance of the schema. Other clients (typically a controller) can attach to the player&#39;s state to monitor and remotely control the client. Here the schema declares two oscillator parameters: <code>type</code> and <code>frequency</code></li></ul><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki"><code><span class="line"><span style="color:#88846F;">// `src/server/schemas/player.js`</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">default</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#88846F;">// dummy oscillator params</span></span>
<span class="line"><span style="color:#F8F8F2;">  type: {</span></span>
<span class="line"><span style="color:#F8F8F2;">    type: </span><span style="color:#E6DB74;">&#39;enum&#39;</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#F8F8F2;">    list: [</span><span style="color:#E6DB74;">&#39;sine&#39;</span><span style="color:#F8F8F2;">, </span><span style="color:#E6DB74;">&#39;square&#39;</span><span style="color:#F8F8F2;">, </span><span style="color:#E6DB74;">&#39;sawtooth&#39;</span><span style="color:#F8F8F2;">, </span><span style="color:#E6DB74;">&#39;triangle&#39;</span><span style="color:#F8F8F2;">],</span></span>
<span class="line"><span style="color:#F8F8F2;">    default: </span><span style="color:#E6DB74;">&#39;sine&#39;</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#F8F8F2;">  },</span></span>
<span class="line"><span style="color:#F8F8F2;">  frequency: {</span></span>
<span class="line"><span style="color:#F8F8F2;">    type: </span><span style="color:#E6DB74;">&#39;integer&#39;</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#F8F8F2;">    min: </span><span style="color:#AE81FF;">50</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#F8F8F2;">    max: </span><span style="color:#AE81FF;">1000</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#F8F8F2;">    default: </span><span style="color:#AE81FF;">440</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#F8F8F2;">  },</span></span>
<span class="line"><span style="color:#F8F8F2;">};</span></span>
<span class="line"></span></code></pre></div><h2 id="registering-schemas" tabindex="-1">Registering Schemas <a class="header-anchor" href="#registering-schemas" aria-hidden="true">#</a></h2><ul><li><a href="http://collective-soundworks.github.io/soundworks/server.SharedStateManagerServer.html#registerSchema" target="_blank" rel="noreferrer">server.SharedStateManagerServer#registerSchema</a></li></ul><p>Once the schemas have been declared, we must register them server-side into the soundworks&#39; <code>stateManager</code>. Indeed, the server keeps a local instance of every state created in the application and acts as the only source of ground truth.</p><p>A good practice is to do that after the server initialization (<code>await server.init(...)</code>, so that the state manager is ready to be used, but before the server start (<code>await server.start()</code>), so that we accept client connections when everything is properly configured.</p><p>In order to register the schemas, you have to follow the two following steps:</p><ol><li>import the files where the schemas are declared:</li></ol><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki"><code><span class="line"><span style="color:#88846F;">// src/server/index.js (line 15-16)</span></span>
<span class="line"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> globalsSchema </span><span style="color:#F92672;">from</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;./schemas/globals&#39;</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> playerSchema </span><span style="color:#F92672;">from</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;./schemas/player&#39;</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"></span></code></pre></div><ol start="2"><li>register the schema to the <code>stateManager</code>:</li></ol><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki"><code><span class="line"><span style="color:#88846F;">// src/server/index.js (line 59-60)</span></span>
<span class="line"><span style="color:#F8F8F2;">server.stateManager.</span><span style="color:#A6E22E;">registerSchema</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;globals&#39;</span><span style="color:#F8F8F2;">, globalsSchema);</span></span>
<span class="line"><span style="color:#F8F8F2;">server.stateManager.</span><span style="color:#A6E22E;">registerSchema</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;player&#39;</span><span style="color:#F8F8F2;">, playerSchema);</span></span>
<span class="line"></span></code></pre></div><h2 id="creating-states" tabindex="-1">Creating States <a class="header-anchor" href="#creating-states" aria-hidden="true">#</a></h2><ul><li><a href="http://collective-soundworks.github.io/soundworks/server.SharedStateManagerServer.html#create" target="_blank" rel="noreferrer">server.SharedStateManagerServer#create</a></li><li><a href="http://collective-soundworks.github.io/soundworks/client.SharedStateManagerClient.html#create" target="_blank" rel="noreferrer">client.SharedStateManagerClient#create</a></li></ul><p>Once schemas are registered, they can be instantiated by any server or clients <code>stateManager</code> (<em>note: internally the <code>server.stateManager</code> is itself a client of the shared state system, except for <code>registerState</code> method, its API is thus the same as the client side API</em>).</p><p>Typically, creating a state server-side will allow to share a common state to all the clients of the application. While creating a state client side will create a novel instance of the state for every client, simplifying remote control and monitoring.</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki"><code><span class="line"><span style="color:#88846F;">// server-side</span></span>
<span class="line"><span style="color:#66D9EF;">const</span><span style="color:#F8F8F2;"> state </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">await</span><span style="color:#F8F8F2;"> server.stateManager.</span><span style="color:#A6E22E;">create</span><span style="color:#F8F8F2;">(schemaName, [defaultValues]);</span></span>
<span class="line"><span style="color:#88846F;">// or client-side</span></span>
<span class="line"><span style="color:#66D9EF;">const</span><span style="color:#F8F8F2;"> state </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">await</span><span style="color:#F8F8F2;"> client.stateManager.</span><span style="color:#A6E22E;">create</span><span style="color:#F8F8F2;">(schemaName, [defaultValues]);</span></span>
<span class="line"></span></code></pre></div><p>In the example application the <code>globals</code> state is created by the server:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki"><code><span class="line"><span style="color:#88846F;">// src/server/index.js (line 62)</span></span>
<span class="line"><span style="color:#66D9EF;">const</span><span style="color:#F8F8F2;"> globalsState </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">await</span><span style="color:#F8F8F2;"> server.stateManager.</span><span style="color:#A6E22E;">create</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;globals&#39;</span><span style="color:#F8F8F2;">);</span></span>
<span class="line"><span style="color:#F8F8F2;">console.</span><span style="color:#A6E22E;">log</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;globalsState:&#39;</span><span style="color:#F8F8F2;">, globalsState.</span><span style="color:#A6E22E;">getValues</span><span style="color:#F8F8F2;">());</span></span>
<span class="line"><span style="color:#88846F;">// &gt; globalsState: { master: 0, mute: false }</span></span>
<span class="line"></span></code></pre></div><p>While each player creates its own instance of the <code>player</code> schema:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki"><code><span class="line"><span style="color:#88846F;">// src/clients/player/PlayerExperience.js (line 22-24)</span></span>
<span class="line"><span style="color:#66D9EF;">const</span><span style="color:#F8F8F2;"> playerState </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">await</span><span style="color:#F8F8F2;"> </span><span style="color:#FD971F;">this</span><span style="color:#F8F8F2;">.client.stateManager.</span><span style="color:#A6E22E;">create</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;player&#39;</span><span style="color:#F8F8F2;">, {</span></span>
<span class="line"><span style="color:#F8F8F2;">  frequency: Math.</span><span style="color:#A6E22E;">round</span><span style="color:#F8F8F2;">(</span><span style="color:#AE81FF;">50</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">+</span><span style="color:#F8F8F2;"> Math.</span><span style="color:#A6E22E;">random</span><span style="color:#F8F8F2;">() </span><span style="color:#F92672;">*</span><span style="color:#F8F8F2;"> </span><span style="color:#AE81FF;">950</span><span style="color:#F8F8F2;">),</span></span>
<span class="line"><span style="color:#F8F8F2;">});</span></span>
<span class="line"><span style="color:#F8F8F2;">console.</span><span style="color:#A6E22E;">log</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;playerState:&#39;</span><span style="color:#F8F8F2;">, playerState.</span><span style="color:#A6E22E;">getValues</span><span style="color:#F8F8F2;">());</span></span>
<span class="line"><span style="color:#88846F;">// &gt; playerState: {type: &quot;sine&quot;, frequency: 513}</span></span>
<span class="line"></span></code></pre></div><p>As we want every client connecting to play a different frequency, we initialize the state with a random value.</p><h2 id="attaching-to-states" tabindex="-1">Attaching to States <a class="header-anchor" href="#attaching-to-states" aria-hidden="true">#</a></h2><ul><li><a href="http://collective-soundworks.github.io/soundworks/server.SharedStateManagerServer.html#attach" target="_blank" rel="noreferrer">server.SharedStateManagerServer#attach</a></li><li><a href="http://collective-soundworks.github.io/soundworks/client.SharedStateManagerClient.html#attach" target="_blank" rel="noreferrer">client.SharedStateManagerClient#attach</a></li></ul><p>Any node of the network (client or server) can attach to a state created by another node.</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki"><code><span class="line"><span style="color:#88846F;">// on server-side</span></span>
<span class="line"><span style="color:#66D9EF;">const</span><span style="color:#F8F8F2;"> state </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">await</span><span style="color:#F8F8F2;"> server.stateManager.</span><span style="color:#A6E22E;">attach</span><span style="color:#F8F8F2;">(schemaName, [stateId]);</span></span>
<span class="line"><span style="color:#88846F;">// or client-side</span></span>
<span class="line"><span style="color:#66D9EF;">const</span><span style="color:#F8F8F2;"> state </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">await</span><span style="color:#F8F8F2;"> client.stateManager.</span><span style="color:#A6E22E;">attach</span><span style="color:#F8F8F2;">(schemaName, [stateId]);</span></span>
<span class="line"></span></code></pre></div><p>In our example, we want every player be informed of the current values of the <code>globalsState</code> created by the server, the player clients must thus <code>attach</code> to this state.</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki"><code><span class="line"><span style="color:#88846F;">// src/clients/player/PlayerExperience.js (line 22-24)</span></span>
<span class="line"><span style="color:#66D9EF;">const</span><span style="color:#F8F8F2;"> globalsState </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">await</span><span style="color:#F8F8F2;"> </span><span style="color:#FD971F;">this</span><span style="color:#F8F8F2;">.client.stateManager.</span><span style="color:#A6E22E;">attach</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;globals&#39;</span><span style="color:#F8F8F2;">);</span></span>
<span class="line"><span style="color:#F8F8F2;">console.</span><span style="color:#A6E22E;">log</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;globalsState:&#39;</span><span style="color:#F8F8F2;">, globalsState.</span><span style="color:#A6E22E;">getValues</span><span style="color:#F8F8F2;">());</span></span>
<span class="line"><span style="color:#88846F;">// &gt; globalsState: { master: 0, mute: false }</span></span>
<span class="line"></span></code></pre></div><p>Every player client is now attached to the <code>globals</code> state created by the server and will be notified if any update occur (more on that in <em>Subscribing to updates and updating states</em>).</p><h2 id="observing-the-creation-of-states-on-the-network" tabindex="-1">Observing the Creation of States on the Network <a class="header-anchor" href="#observing-the-creation-of-states-on-the-network" aria-hidden="true">#</a></h2><ul><li><a href="http://collective-soundworks.github.io/soundworks/server.SharedStateManagerServer.html#observe" target="_blank" rel="noreferrer">server.SharedStateManagerServer#observe</a></li><li><a href="http://collective-soundworks.github.io/soundworks/client.SharedStateManagerClient.html#observe" target="_blank" rel="noreferrer">client.SharedStateManagerClient#observe</a></li><li><a href="http://collective-soundworks.github.io/soundworks/client.SharedStateManagerClient.html#~observeCallback" target="_blank" rel="noreferrer">client.SharedStateManagerClient~observeCallback</a></li></ul><p>As states can be dynamically created by any node, we need a way to monitor the newly created state in the application (e.g. when a <code>player</code> client connect to the application, the <code>controller</code> client wants to be notified so it can attach to the newly created state and monitor or control it).</p><p>This can be achived using the <code>observe</code> method :</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki"><code><span class="line"><span style="color:#88846F;">// on server-side</span></span>
<span class="line"><span style="color:#F8F8F2;">server.stateManager.</span><span style="color:#A6E22E;">observe</span><span style="color:#F8F8F2;">(observeCallback);</span></span>
<span class="line"><span style="color:#88846F;">// or client-side</span></span>
<span class="line"><span style="color:#F8F8F2;">client.stateManager.</span><span style="color:#A6E22E;">observe</span><span style="color:#F8F8F2;">(observeCallback);</span></span>
<span class="line"></span></code></pre></div><p>In our example, the controller wants to track every <code>player</code> states created by <code>player</code> clients, to be able to monitor and control them remotely, it thus <code>observe</code> and attach to the state when notified:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki"><code><span class="line"><span style="color:#88846F;">// src/clients/controller/ControllerExperience (line 23)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;">// create a list to store the player states</span></span>
<span class="line"><span style="color:#FD971F;">this</span><span style="color:#F8F8F2;">.playerStates </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">new</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">Set</span><span style="color:#F8F8F2;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FD971F;">this</span><span style="color:#F8F8F2;">.client.stateManager.</span><span style="color:#A6E22E;">observe</span><span style="color:#F8F8F2;">(</span><span style="color:#F92672;">async</span><span style="color:#F8F8F2;"> (</span><span style="color:#FD971F;">schemaName</span><span style="color:#F8F8F2;">, </span><span style="color:#FD971F;">stateId</span><span style="color:#F8F8F2;">, </span><span style="color:#FD971F;">nodeId</span><span style="color:#F8F8F2;">) </span><span style="color:#66D9EF;">=&gt;</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  console.</span><span style="color:#A6E22E;">log</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;arguments:&#39;</span><span style="color:#F8F8F2;">, schemaName, stateId, nodeId);</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#88846F;">// the callback is called twice, for the global and player states</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#88846F;">// &gt; arguments: &#39;globals&#39; 0 -1</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#88846F;">// &gt; arguments: &#39;player&#39; 2 1</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#F92672;">switch</span><span style="color:#F8F8F2;">(schemaName) {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#F92672;">case</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&#39;player&#39;</span><span style="color:#F8F8F2;">:</span></span>
<span class="line"><span style="color:#F8F8F2;">      </span><span style="color:#66D9EF;">const</span><span style="color:#F8F8F2;"> playerState </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">await</span><span style="color:#F8F8F2;"> </span><span style="color:#FD971F;">this</span><span style="color:#F8F8F2;">.client.stateManager.</span><span style="color:#A6E22E;">attach</span><span style="color:#F8F8F2;">(schemaName, stateId);</span></span>
<span class="line"><span style="color:#F8F8F2;">      console.</span><span style="color:#A6E22E;">log</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;playerState:&#39;</span><span style="color:#F8F8F2;">, playerState.</span><span style="color:#A6E22E;">getValues</span><span style="color:#F8F8F2;">());</span></span>
<span class="line"><span style="color:#F8F8F2;">      </span><span style="color:#88846F;">// &gt; playerState: {type: &quot;sine&quot;, frequency: 513}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">      </span><span style="color:#88846F;">// logic to do when the state is deleted</span></span>
<span class="line"><span style="color:#F8F8F2;">      </span><span style="color:#88846F;">// (e.g. when the player disconnects)</span></span>
<span class="line"><span style="color:#F8F8F2;">      playerState.</span><span style="color:#A6E22E;">onDetach</span><span style="color:#F8F8F2;">(() </span><span style="color:#66D9EF;">=&gt;</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">        </span><span style="color:#88846F;">// clean things</span></span>
<span class="line"><span style="color:#F8F8F2;">        </span><span style="color:#FD971F;">this</span><span style="color:#F8F8F2;">.playerStates.</span><span style="color:#A6E22E;">delete</span><span style="color:#F8F8F2;">(playerState);</span></span>
<span class="line"><span style="color:#F8F8F2;">      });</span></span>
<span class="line"><span style="color:#F8F8F2;">      </span><span style="color:#88846F;">// store the player state into a list</span></span>
<span class="line"><span style="color:#F8F8F2;">      </span><span style="color:#FD971F;">this</span><span style="color:#F8F8F2;">.playerStates.</span><span style="color:#A6E22E;">add</span><span style="color:#F8F8F2;">(playerState);</span></span>
<span class="line"><span style="color:#F8F8F2;">      </span><span style="color:#F92672;">break</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"><span style="color:#F8F8F2;">});</span></span>
<span class="line"></span></code></pre></div><h2 id="updating-values-and-subscribing-to-updates" tabindex="-1">Updating Values and Subscribing to Updates <a class="header-anchor" href="#updating-values-and-subscribing-to-updates" aria-hidden="true">#</a></h2><p>Once we have a local instance of state (through <code>create</code> or <code>attach</code>), we need to be notified of any change that may occur and to be able to change its values.</p><p>The <code>set</code> method allows for updating the values of a state</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki"><code><span class="line"><span style="color:#F8F8F2;">state.</span><span style="color:#A6E22E;">set</span><span style="color:#F8F8F2;">(updates);</span></span>
<span class="line"></span></code></pre></div><ul><li><a href="http://collective-soundworks.github.io/soundworks/common.SharedState.html#set" target="_blank" rel="noreferrer">common.SharedState#set</a></li></ul><p>In our example, the controller, once attached to a player state will update the <code>frequency</code> to a new random value every second (practically, this does not make a lot of sense, but for now it explains the concept...):</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki"><code><span class="line"><span style="color:#88846F;">// src/clients/controller/ControllerExperience (line 33)</span></span>
<span class="line"><span style="color:#66D9EF;">const</span><span style="color:#F8F8F2;"> intervalId </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">setInterval</span><span style="color:#F8F8F2;">(() </span><span style="color:#66D9EF;">=&gt;</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#66D9EF;">const</span><span style="color:#F8F8F2;"> frequency </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> Math.</span><span style="color:#A6E22E;">round</span><span style="color:#F8F8F2;">(</span><span style="color:#AE81FF;">50</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">+</span><span style="color:#F8F8F2;"> Math.</span><span style="color:#A6E22E;">random</span><span style="color:#F8F8F2;">() </span><span style="color:#F92672;">*</span><span style="color:#F8F8F2;"> </span><span style="color:#AE81FF;">950</span><span style="color:#F8F8F2;">);</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#F92672;">await</span><span style="color:#F8F8F2;"> playerState.</span><span style="color:#A6E22E;">set</span><span style="color:#F8F8F2;">({ frequency });</span></span>
<span class="line"><span style="color:#F8F8F2;">});</span></span>
<span class="line"></span></code></pre></div><p><em>Note: we wouldn&#39;t implement this kind of logic in a real world situation. Indeed, if we open 2 controllers each one will set a new value to the frequency every second</em></p><p>The <code>subscribe</code> method allows to be notified when an update occur on the state:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki"><code><span class="line"><span style="color:#F8F8F2;">state.</span><span style="color:#A6E22E;">subscribe</span><span style="color:#F8F8F2;">(callback);</span></span>
<span class="line"></span></code></pre></div><ul><li><a href="http://collective-soundworks.github.io/soundworks/common.SharedState.html#subscribe" target="_blank" rel="noreferrer">common.SharedState#subscribe</a></li></ul><p>In our example, the player can <code>subscribe</code> to the updates triggered by the controller and react accordingly. The callback is thus called every second (if we ignore the network latency):</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki"><code><span class="line"><span style="color:#88846F;">// src/clients/controller/ControllerExperience (line 30)</span></span>
<span class="line"><span style="color:#F8F8F2;">playerState.</span><span style="color:#A6E22E;">subscribe</span><span style="color:#F8F8F2;">(</span><span style="color:#F92672;">async</span><span style="color:#F8F8F2;"> </span><span style="color:#FD971F;">updates</span><span style="color:#F8F8F2;"> </span><span style="color:#66D9EF;">=&gt;</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  console.</span><span style="color:#A6E22E;">log</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;updates:&#39;</span><span style="color:#F8F8F2;">, updates);</span></span>
<span class="line"><span style="color:#F8F8F2;">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;">// updates: { frequency: 288 }</span></span>
<span class="line"><span style="color:#88846F;">// updates: { frequency: 965 }</span></span>
<span class="line"><span style="color:#88846F;">// updates: { frequency: 540 }</span></span>
<span class="line"><span style="color:#88846F;">// updates: { frequency: 120 }</span></span>
<span class="line"><span style="color:#88846F;">// updates: { frequency: 678 }</span></span>
<span class="line"><span style="color:#88846F;">// ...</span></span>
<span class="line"></span></code></pre></div><p>The same logic could be done with the <code>globals</code> state, at the difference that every player client would be notified of the update.</p></div></div></main><!--[--><!--]--><footer class="VPDocFooter" data-v-cfb513e0 data-v-21f75714><!----><div class="prev-next" data-v-21f75714><div class="pager" data-v-21f75714><a class="pager-link prev" href="/guide/getting-started.html" data-v-21f75714><span class="desc" data-v-21f75714>Previous page</span><span class="title" data-v-21f75714>Getting Started</span></a></div><div class="has-prev pager" data-v-21f75714><a class="pager-link next" href="/tutorials/contexts.html" data-v-21f75714><span class="desc" data-v-21f75714>Next page</span><span class="title" data-v-21f75714>Using Contexts</span></a></div></div></footer><!--[--><!--]--></div></div></div></div></div><!----><!--[--><!--]--></div></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"api.md\":\"12e3744f\",\"credits.md\":\"95abc573\",\"guide__ecosystem.md\":\"c15ff441\",\"guide_getting-started.md\":\"3d65190e\",\"guide_introduction.md\":\"db60faae\",\"index.md\":\"329d4f12\",\"misc__todo_electron-applications.md\":\"25583486\",\"misc_contributing-to-this-site.md\":\"e99f2351\",\"misc_future-works.md\":\"ec731ec6\",\"misc_index.md\":\"26f00762\",\"misc_local-deployment.md\":\"a5ff3e39\",\"misc_online-deployment.md\":\"13e78b8f\",\"misc_setting-up-environment.md\":\"1dd31b08\",\"tutorials_index.md\":\"d8ef4578\",\"tutorials_state-manager.md\":\"b8c04c58\"}")</script>
    <script type="module" async src="/assets/app.9503f83c.js"></script>
    
  </body>
</html>