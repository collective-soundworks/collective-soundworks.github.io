<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Building a Distributed Step Sequencer | soundworks</title>
    <meta name="description" content="Creative coding framework for distributed applications based on Web technologies">
    <meta name="generator" content="VitePress v2.0.0-alpha.16">
    <link rel="preload stylesheet" href="/assets/style.DklbAnHd.css" as="style">
    <link rel="preload stylesheet" href="/vp-icons.css" as="style">
    
    <script type="module" src="/assets/app.Crhjg3H6.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/theme.DKERbyZW.js">
    <link rel="modulepreload" href="/assets/chunks/framework.CRk2WtWN.js">
    <link rel="modulepreload" href="/assets/tutorials_step-sequencer.md.CBp3A5Ak.lean.js">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-304c8b69><!--[--><!--]--><!--[--><span tabindex="-1" data-v-10d4d845></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-10d4d845>Skip to content</a><!--]--><!----><header class="VPNav" data-v-304c8b69 data-v-d5bf7c8e><div class="VPNavBar has-sidebar top" data-v-d5bf7c8e data-v-cc1d9f2e><div class="wrapper" data-v-cc1d9f2e><div class="container" data-v-cc1d9f2e><div class="title" data-v-cc1d9f2e><div class="VPNavBarTitle has-sidebar" data-v-cc1d9f2e data-v-d4488dd0><a class="title" href="/" data-v-d4488dd0><!--[--><!--]--><!--[--><img class="VPImage logo" src="/logo-nav.png" alt data-v-ab19afbb><!--]--><span data-v-d4488dd0>soundworks</span><!--[--><!--]--></a></div></div><div class="content" data-v-cc1d9f2e><div class="content-body" data-v-cc1d9f2e><!--[--><!--]--><div class="VPNavBarSearch search" data-v-cc1d9f2e data-v-bdd98725><!--[--><button type="button" class="VPNavBarSearchButton" aria-label="Search" aria-keyshortcuts="/ control+k meta+k" data-v-bdd98725 data-v-69351052><span class="vpi-search" aria-hidden="true" data-v-69351052></span><span class="text" data-v-69351052>Search</span><span class="keys" aria-hidden="true" data-v-69351052><kbd class="key-cmd" data-v-69351052>⌘</kbd><kbd class="key-ctrl" data-v-69351052>Ctrl</kbd><kbd data-v-69351052>K</kbd></span></button><!----><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-cc1d9f2e data-v-020be4db><span id="main-nav-aria-label" class="visually-hidden" data-v-020be4db> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/tutorials/getting-started.html" tabindex="0" data-v-020be4db data-v-81dba28a><!--[--><span data-v-81dba28a>Guide</span><!--]--></a><!--]--><!--[--><a class="VPLink link vp-external-link-icon VPNavBarMenuLink" href="https://soundworks.dev/soundworks" target="_blank" rel="noreferrer" tabindex="0" data-v-020be4db data-v-81dba28a><!--[--><span data-v-81dba28a>soundworks API</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/credits.html" tabindex="0" data-v-020be4db data-v-81dba28a><!--[--><span data-v-81dba28a>Credits</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-cc1d9f2e data-v-3f90c1a5><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-3f90c1a5 data-v-be9742d9 data-v-b4ccac88><span class="check" data-v-b4ccac88><span class="icon" data-v-b4ccac88><!--[--><span class="vpi-sun sun" data-v-be9742d9></span><span class="vpi-moon moon" data-v-be9742d9></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-cc1d9f2e data-v-ef6192dc data-v-a1a7286e><!--[--><a class="VPSocialLink no-icon" href="https://github.com/collective-soundworks/collective-soundworks.github.io" aria-label="github" target="_blank" rel="me noopener" data-v-a1a7286e data-v-32d78712><span class="vpi-social-github"></span></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-cc1d9f2e data-v-600b50c9 data-v-d8fae6e2><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-d8fae6e2><span class="vpi-more-horizontal icon" data-v-d8fae6e2></span></button><div class="menu" data-v-d8fae6e2><div class="VPMenu" data-v-d8fae6e2 data-v-fcd1d7a8><!----><!--[--><!--[--><!----><div class="group" data-v-600b50c9><div class="item appearance" data-v-600b50c9><p class="label" data-v-600b50c9>Appearance</p><div class="appearance-action" data-v-600b50c9><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-600b50c9 data-v-be9742d9 data-v-b4ccac88><span class="check" data-v-b4ccac88><span class="icon" data-v-b4ccac88><!--[--><span class="vpi-sun sun" data-v-be9742d9></span><span class="vpi-moon moon" data-v-be9742d9></span><!--]--></span></span></button></div></div></div><div class="group" data-v-600b50c9><div class="item social-links" data-v-600b50c9><div class="VPSocialLinks social-links-list" data-v-600b50c9 data-v-a1a7286e><!--[--><a class="VPSocialLink no-icon" href="https://github.com/collective-soundworks/collective-soundworks.github.io" aria-label="github" target="_blank" rel="me noopener" data-v-a1a7286e data-v-32d78712><span class="vpi-social-github"></span></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-cc1d9f2e data-v-6bee1efd><span class="container" data-v-6bee1efd><span class="top" data-v-6bee1efd></span><span class="middle" data-v-6bee1efd></span><span class="bottom" data-v-6bee1efd></span></span></button></div></div></div></div><div class="divider" data-v-cc1d9f2e><div class="divider-line" data-v-cc1d9f2e></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-304c8b69 data-v-73add737><div class="container" data-v-73add737><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-73add737><span class="vpi-align-left menu-icon" data-v-73add737></span><span class="menu-text" data-v-73add737>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-73add737 data-v-e28a51a6><button data-v-e28a51a6>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-304c8b69 data-v-49f51a23><div class="curtain" data-v-49f51a23></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-49f51a23><span class="visually-hidden" id="sidebar-aria-label" data-v-49f51a23> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-a84b7c21><section class="VPSidebarItem level-0" data-v-a84b7c21 data-v-6b36a2fd><!----><div class="items" data-v-6b36a2fd><!--[--><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/introduction.html" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Introduction</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-a84b7c21><section class="VPSidebarItem level-0 has-active" data-v-a84b7c21 data-v-6b36a2fd><div class="item" role="button" tabindex="0" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><h2 class="text" data-v-6b36a2fd>Tutorials</h2><!----></div><div class="items" data-v-6b36a2fd><!--[--><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/tutorials/getting-started.html" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Getting Started</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/tutorials/state-manager.html" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Using the State Manager</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/tutorials/plugin-platform-init.html" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Using Plugins 1 - <i>platform-init</i></p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/tutorials/todo-noise.html" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>The <i>Todo Noise</i> Application</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/tutorials/node-clients.html" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Working with Node Clients</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/tutorials/plugin-sync.html" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Using Plugins 2 - <i>sync</i></p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/tutorials/step-sequencer.html" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Distributed Step Sequencer</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-a84b7c21><section class="VPSidebarItem level-0" data-v-a84b7c21 data-v-6b36a2fd><div class="item" role="button" tabindex="0" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><h2 class="text" data-v-6b36a2fd>Recipes</h2><!----></div><div class="items" data-v-6b36a2fd><!--[--><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/recipes/working-with-max.html" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Working with Max</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-a84b7c21><section class="VPSidebarItem level-0" data-v-a84b7c21 data-v-6b36a2fd><div class="item" role="button" tabindex="0" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><h2 class="text" data-v-6b36a2fd>Documentation</h2><!----></div><div class="items" data-v-6b36a2fd><!--[--><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link vp-external-link-icon link" href="https://soundworks.dev/soundworks" target="_blank" rel="noreferrer" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>soundworks API</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/tools/helpers.html" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Helpers</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/plugins/platform-init.html" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Plugin Platform Init</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/plugins/sync.html" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Plugin Sync</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/plugins/filesystem.html" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Plugin Filesystem</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/plugins/scripting.html" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Plugin Scripting</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/plugins/checkin.html" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Plugin Checkin</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/plugins/position.html" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Plugin Position</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/plugins/logger.html" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Plugin Logger</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-a84b7c21><section class="VPSidebarItem level-0" data-v-a84b7c21 data-v-6b36a2fd><div class="item" role="button" tabindex="0" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><h2 class="text" data-v-6b36a2fd>Ecosystem</h2><!----></div><div class="items" data-v-6b36a2fd><!--[--><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link vp-external-link-icon link" href="https://github.com/ircam-ismm/node-web-audio-api/" target="_blank" rel="noreferrer" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>node-web-audio-api</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link vp-external-link-icon link" href="https://github.com/ircam-ismm/sc-components/" target="_blank" rel="noreferrer" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>@ircam/sc-components</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link vp-external-link-icon link" href="https://github.com/ircam-ismm/sc-utils" target="_blank" rel="noreferrer" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>@ircam/sc-utils</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link vp-external-link-icon link" href="https://github.com/ircam-ismm/sc-scheduling/" target="_blank" rel="noreferrer" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>@ircam/sc-scheduling</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link vp-external-link-icon link" href="https://github.com/ircam-ismm/devicemotion" target="_blank" rel="noreferrer" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>@ircam/devicemotion</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link vp-external-link-icon link" href="https://ircam-ismm.github.io/dotpi/" target="_blank" rel="noreferrer" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>dotpi tools</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-a84b7c21><section class="VPSidebarItem level-0" data-v-a84b7c21 data-v-6b36a2fd><div class="item" role="button" tabindex="0" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><h2 class="text" data-v-6b36a2fd>Misc</h2><!----></div><div class="items" data-v-6b36a2fd><!--[--><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/misc/websockets-101.html" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>WebSockets 101</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-304c8b69 data-v-bd4f21ea><div class="VPDoc has-sidebar has-aside" data-v-bd4f21ea data-v-d668f7cc><!--[--><!--]--><div class="container" data-v-d668f7cc><div class="aside" data-v-d668f7cc><div class="aside-curtain" data-v-d668f7cc></div><div class="aside-container" data-v-d668f7cc><div class="aside-content" data-v-d668f7cc><div class="VPDocAside" data-v-d668f7cc data-v-cb998dce><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-cb998dce data-v-c8b19031><div class="content" data-v-c8b19031><div class="outline-marker" data-v-c8b19031></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-c8b19031>On this page</div><ul class="VPDocOutlineItem root" data-v-c8b19031 data-v-63c57e50><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-cb998dce></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-d668f7cc><div class="content-container" data-v-d668f7cc><!--[--><!--]--><main class="main" data-v-d668f7cc><div style="position:relative;" class="vp-doc _tutorials_step-sequencer" data-v-d668f7cc><div><h1 id="building-a-distributed-step-sequencer" tabindex="-1">Building a Distributed Step Sequencer <a class="header-anchor" href="#building-a-distributed-step-sequencer" aria-label="Permalink to “Building a Distributed Step Sequencer”">​</a></h1><p>In this tutorial, we will use the soundworks&#39; <em>sync</em> plugin we just learned to build a more advanced application: a distributed step sequencer.</p><p>The step sequencer will be based on <em>Node.js</em> clients, representing each a track of our step sequencer, i.e. one the kick, one for the snare, etc. and one browser controller client to rule them all:</p><p><img src="/assets/architecture.DjS2qzuh.png" alt="architecture"></p><p>Along the way we will use another plugin, the <em>checkin</em> plugin, which allows us to assign a unique index to each clients.</p><h3 id="related-documentation" tabindex="-1">Related documentation <a class="header-anchor" href="#related-documentation" aria-label="Permalink to “Related documentation”">​</a></h3><ul><li><a href="https://github.com/collective-soundworks/soundworks-plugin-sync" target="_blank" rel="noreferrer">@soundworks/plugin-sync</a></li><li><a href="https://github.com/collective-soundworks/soundworks-plugin-checkin" target="_blank" rel="noreferrer">@soundworks/plugin-checkin</a></li><li><a href="https://github.com/ircam-ismm/sc-scheduling" target="_blank" rel="noreferrer">@ircam/sc-scheduling</a></li><li><a href="https://github.com/ircam-ismm/sc-loader" target="_blank" rel="noreferrer">@ircam/sc-loader</a></li></ul><h2 id="scaffolding-application" tabindex="-1">Scaffolding application <a class="header-anchor" href="#scaffolding-application" aria-label="Permalink to “Scaffolding application”">​</a></h2><p>Let&#39;s start with scaffolding our application using the soundworks wizard:</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki monokai" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#66D9EF;">cd</span><span style="color:#E6DB74;"> path/to/tutorials</span></span>
<span class="line"><span style="color:#A6E22E;">npx</span><span style="color:#E6DB74;"> @soundworks/create@latest</span><span style="color:#E6DB74;"> step-sequencer</span></span></code></pre></div><p>When the wizard ask to select the plugin, let&#39;s then select <code>@soundworks/plugin-sync</code> and the <code>@soundworks/plugin-checkin</code> plugins:</p><p><img src="/assets/select-plugins.BmhHayu-.png" alt="select-plugins"></p><p>And let&#39;s define our default client as a controller:</p><p><img src="/assets/create-default-client.BniPeTgk.png" alt="create-default-client"></p><p>Once done, let&#39;s go into our <code>step-sequencer</code> directory and install a few more dependencies we will need using <code>npm</code>:</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki monokai" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#66D9EF;">cd</span><span style="color:#E6DB74;"> step-sequencer</span></span>
<span class="line"><span style="color:#A6E22E;">npm</span><span style="color:#E6DB74;"> install</span><span style="color:#AE81FF;"> --save</span><span style="color:#E6DB74;"> @ircam/sc-scheduling</span><span style="color:#E6DB74;"> @ircam/sc-loader</span><span style="color:#E6DB74;"> node-web-audio-api</span></span></code></pre></div><p>Finally, let&#39;s just create our node client, we will name <code>thing</code>:</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki monokai" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#A6E22E;">npx</span><span style="color:#E6DB74;"> soundworks</span><span style="color:#AE81FF;"> --create-client</span></span></code></pre></div><p><img src="/assets/create-thing-client.DlU2JtuU.png" alt="create-thing-client"></p><p>We can now start our server:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki monokai" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#F8F8F2;">npm run dev</span></span></code></pre></div><p>And, in different &quot;Terminal&quot;, emulate 5 thing clients:</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki monokai" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#66D9EF;">cd</span><span style="color:#E6DB74;"> path/to/tutorials/step-sequencer</span></span>
<span class="line"><span style="color:#F8F8F2;">EMULATE</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">5</span><span style="color:#A6E22E;"> npm</span><span style="color:#E6DB74;"> run</span><span style="color:#E6DB74;"> watch</span><span style="color:#E6DB74;"> thing</span></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title custom-block-title-default">TIP</p><p>To easily get the current directory in &quot;Terminal&quot; you can use the <code>pwd</code> command</p></div><h2 id="defining-the-global-state" tabindex="-1">Defining the global state <a class="header-anchor" href="#defining-the-global-state" aria-label="Permalink to “Defining the global state”">​</a></h2><p>Now that everything is set up, let&#39;s continue with defining the different parameters that describe our application and declare them in a global state.</p><p>Indeed, we will need several parameters to control our step sequencer:</p><ul><li>A variable which will define if our step sequencer is running or not (&quot;start / stop&quot;).</li><li>A timestamp (in synchronized time) associated to the start / stop event to make sure all our clients start at the same exact time.</li><li>A BPM value for our step sequencer.</li><li>A score.</li></ul><p>To keep things simple, we won&#39;t allow to change the BPM while the step sequencer is running. Indeed, having such functionality would imply to also synchronize our BPM change among every clients, which would lead to over complicate this tutorial.</p><p>Let&#39;s thus create a file named <code>global.js</code> in the <code>src/server/schemas</code> directory and translate these information into a schema definition:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki monokai" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#88846F;">// src/server/schemas/global.js</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F92672;"> default</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  running: {</span></span>
<span class="line"><span style="color:#F8F8F2;">    type: </span><span style="color:#E6DB74;">&#39;boolean&#39;</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#F8F8F2;">    default: </span><span style="color:#AE81FF;">false</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#F8F8F2;">  },</span></span>
<span class="line"><span style="color:#F8F8F2;">  startTime: {</span></span>
<span class="line"><span style="color:#F8F8F2;">    type: </span><span style="color:#E6DB74;">&#39;float&#39;</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#F8F8F2;">    default: </span><span style="color:#AE81FF;">null</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#F8F8F2;">    nullable: </span><span style="color:#AE81FF;">true</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#F8F8F2;">  },</span></span>
<span class="line"><span style="color:#F8F8F2;">  BPM: {</span></span>
<span class="line"><span style="color:#F8F8F2;">    type: </span><span style="color:#E6DB74;">&#39;integer&#39;</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#F8F8F2;">    default: </span><span style="color:#AE81FF;">120</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#F8F8F2;">  },</span></span>
<span class="line"><span style="color:#F8F8F2;">  score: {</span></span>
<span class="line"><span style="color:#F8F8F2;">    type: </span><span style="color:#E6DB74;">&#39;any&#39;</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#F8F8F2;">    default: [],</span></span>
<span class="line"><span style="color:#F8F8F2;">  },</span></span>
<span class="line"><span style="color:#F8F8F2;">};</span></span></code></pre></div><p>Let&#39;s then register this schema in our server:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki monokai has-diff" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#88846F;">// src/server/index.js</span></span>
<span class="line"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> { loadConfig } </span><span style="color:#F92672;">from</span><span style="color:#E6DB74;"> &#39;../utils/load-config.js&#39;</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F92672;">import</span><span style="color:#E6DB74;"> &#39;../utils/catch-unhandled-errors.js&#39;</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"></span>
<span class="line diff add"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> globalSchema </span><span style="color:#F92672;">from</span><span style="color:#E6DB74;"> &#39;./schemas/global.js&#39;</span><span style="color:#F8F8F2;">; </span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;">// ...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> server </span><span style="color:#F92672;">=</span><span style="color:#F92672;"> new</span><span style="color:#A6E22E;"> Server</span><span style="color:#F8F8F2;">(config);</span></span>
<span class="line"><span style="color:#F8F8F2;">server.</span><span style="color:#A6E22E;">useDefaultApplicationTemplate</span><span style="color:#F8F8F2;">();</span></span>
<span class="line"></span>
<span class="line diff add"><span style="color:#F8F8F2;">server.stateManager.</span><span style="color:#A6E22E;">registerSchema</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;global&#39;</span><span style="color:#F8F8F2;">, globalSchema); </span></span></code></pre></div><p>And define some default values for our tracks. Note that we will consider that our step sequencer has 5 different tracks with 8 steps each, and that we will create a branch to initialize our score in debug mode (with some values filled) according to a <code>debug</code> flag to ease the development:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki monokai has-diff" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#F92672;">await</span><span style="color:#F8F8F2;"> server.</span><span style="color:#A6E22E;">start</span><span style="color:#F8F8F2;">();</span></span>
<span class="line diff add"><span style="color:#88846F;">// change this flag to false to empty score by default</span></span>
<span class="line diff add"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> debug </span><span style="color:#F92672;">=</span><span style="color:#AE81FF;"> true</span><span style="color:#F8F8F2;">; </span></span>
<span class="line diff add"><span style="color:#66D9EF;font-style:italic;">let</span><span style="color:#F8F8F2;"> score; </span></span>
<span class="line diff add"><span style="color:#F92672;">if</span><span style="color:#F8F8F2;"> (debug) { </span></span>
<span class="line diff add"><span style="color:#88846F;">  // if debug, fill score with default values</span></span>
<span class="line diff add"><span style="color:#F8F8F2;">  score </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> [ </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">    [</span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">, </span><span style="color:#AE81FF;">1</span><span style="color:#F8F8F2;">, </span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">, </span><span style="color:#AE81FF;">1</span><span style="color:#F8F8F2;">, </span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">, </span><span style="color:#AE81FF;">1</span><span style="color:#F8F8F2;">, </span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">, </span><span style="color:#AE81FF;">1</span><span style="color:#F8F8F2;">], </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">    [</span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">, </span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">, </span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">, </span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">, </span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">, </span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">, </span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">, </span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">], </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">    [</span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">, </span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">, </span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">, </span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">, </span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">, </span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">, </span><span style="color:#AE81FF;">1</span><span style="color:#F8F8F2;">, </span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">], </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">    [</span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">, </span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">, </span><span style="color:#AE81FF;">1</span><span style="color:#F8F8F2;">, </span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">, </span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">, </span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">, </span><span style="color:#AE81FF;">1</span><span style="color:#F8F8F2;">, </span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">], </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">    [</span><span style="color:#AE81FF;">1</span><span style="color:#F8F8F2;">, </span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">, </span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">, </span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">, </span><span style="color:#AE81FF;">1</span><span style="color:#F8F8F2;">, </span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">, </span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">, </span><span style="color:#AE81FF;">1</span><span style="color:#F8F8F2;">], </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">  ]; </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">} </span><span style="color:#F92672;">else</span><span style="color:#F8F8F2;"> { </span></span>
<span class="line diff add"><span style="color:#88846F;">  // if not debug, empty score</span></span>
<span class="line diff add"><span style="color:#F8F8F2;">  score </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> [ </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">    [</span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">, </span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">, </span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">, </span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">, </span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">, </span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">, </span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">, </span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">], </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">    [</span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">, </span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">, </span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">, </span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">, </span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">, </span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">, </span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">, </span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">], </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">    [</span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">, </span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">, </span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">, </span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">, </span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">, </span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">, </span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">, </span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">], </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">    [</span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">, </span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">, </span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">, </span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">, </span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">, </span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">, </span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">, </span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">], </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">    [</span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">, </span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">, </span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">, </span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">, </span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">, </span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">, </span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">, </span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">], </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">  ]; </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">} </span></span>
<span class="line diff add"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> global </span><span style="color:#F92672;">=</span><span style="color:#F92672;"> await</span><span style="color:#F8F8F2;"> server.stateManager.</span><span style="color:#A6E22E;">create</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;global&#39;</span><span style="color:#F8F8F2;">, { </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">  score, </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">}); </span></span></code></pre></div><h2 id="registering-the-plugins" tabindex="-1">Registering the plugins <a class="header-anchor" href="#registering-the-plugins" aria-label="Permalink to “Registering the plugins”">​</a></h2><p>Now that our state is set up, let&#39;s install and configure our different plugins.</p><p>First let&#39;s register the plugins in the server side:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki monokai has-diff" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#F92672;">import</span><span style="color:#E6DB74;"> &#39;@soundworks/helpers/polyfills.js&#39;</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> { Server } </span><span style="color:#F92672;">from</span><span style="color:#E6DB74;"> &#39;@soundworks/core/server.js&#39;</span><span style="color:#F8F8F2;">;</span></span>
<span class="line diff add"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> pluginSync </span><span style="color:#F92672;">from</span><span style="color:#E6DB74;"> &#39;@soundworks/plugin-sync/server.js&#39;</span><span style="color:#F8F8F2;">; </span></span>
<span class="line diff add"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> pluginCheckin </span><span style="color:#F92672;">from</span><span style="color:#E6DB74;"> &#39;@soundworks/plugin-checkin/server.js&#39;</span><span style="color:#F8F8F2;">; </span></span>
<span class="line"></span>
<span class="line"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> { loadConfig } </span><span style="color:#F92672;">from</span><span style="color:#E6DB74;"> &#39;../utils/load-config.js&#39;</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;">// ...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> server </span><span style="color:#F92672;">=</span><span style="color:#F92672;"> new</span><span style="color:#A6E22E;"> Server</span><span style="color:#F8F8F2;">(config);</span></span>
<span class="line"><span style="color:#F8F8F2;">server.</span><span style="color:#A6E22E;">useDefaultApplicationTemplate</span><span style="color:#F8F8F2;">();</span></span>
<span class="line"></span>
<span class="line diff add"><span style="color:#F8F8F2;">server.pluginManager.</span><span style="color:#A6E22E;">register</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;sync&#39;</span><span style="color:#F8F8F2;">, pluginSync); </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">server.pluginManager.</span><span style="color:#A6E22E;">register</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;checkin&#39;</span><span style="color:#F8F8F2;">, pluginCheckin); </span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">server.stateManager.</span><span style="color:#A6E22E;">registerSchema</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;global&#39;</span><span style="color:#F8F8F2;">, globalSchema);</span></span></code></pre></div><p>And in our two &quot;controller&quot; and &quot;thing&quot; clients. Note that as we will use the checkin to get a unique index which will allow us to get a track from the score to be played, we will only register the <em>checkin</em> plugin on the &quot;thing&quot; client.</p><p>Let&#39;s start with the &quot;controller&quot;:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki monokai has-diff" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#88846F;">// src/clients/controller/index.js</span></span>
<span class="line"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> launcher </span><span style="color:#F92672;">from</span><span style="color:#E6DB74;"> &#39;@soundworks/helpers/launcher.js&#39;</span><span style="color:#F8F8F2;">;</span></span>
<span class="line diff add"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> pluginSync </span><span style="color:#F92672;">from</span><span style="color:#E6DB74;"> &#39;@soundworks/plugin-sync/client.js&#39;</span><span style="color:#F8F8F2;">; </span></span>
<span class="line"></span>
<span class="line"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> { html, render } </span><span style="color:#F92672;">from</span><span style="color:#E6DB74;"> &#39;lit&#39;</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;">// ...</span></span>
<span class="line"></span>
<span class="line diff add"><span style="color:#F8F8F2;">client.pluginManager.</span><span style="color:#A6E22E;">register</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;sync&#39;</span><span style="color:#F8F8F2;">, pluginSync); </span></span>
<span class="line"></span>
<span class="line"><span style="color:#F92672;">await</span><span style="color:#F8F8F2;"> client.</span><span style="color:#A6E22E;">start</span><span style="color:#F8F8F2;">();</span></span></code></pre></div><p>Then let&#39;s install our two plugins in our &quot;thing&quot; clients, as you may recall in the last tutorial, in this case we will want to synchronize the audio clock, which will thus require a bit more configuration:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki monokai has-diff" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#88846F;">// src/clients/thing/index.js</span></span>
<span class="line"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> { Client } </span><span style="color:#F92672;">from</span><span style="color:#E6DB74;"> &#39;@soundworks/core/client.js&#39;</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> launcher </span><span style="color:#F92672;">from</span><span style="color:#E6DB74;"> &#39;@soundworks/helpers/launcher.js&#39;</span><span style="color:#F8F8F2;">;</span></span>
<span class="line diff add"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> pluginSync </span><span style="color:#F92672;">from</span><span style="color:#E6DB74;"> &#39;@soundworks/plugin-sync/client.js&#39;</span><span style="color:#F8F8F2;">; </span></span>
<span class="line diff add"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> pluginCheckin </span><span style="color:#F92672;">from</span><span style="color:#E6DB74;"> &#39;@soundworks/plugin-checkin/client.js&#39;</span><span style="color:#F8F8F2;">; </span></span>
<span class="line diff add"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> { AudioContext } </span><span style="color:#F92672;">from</span><span style="color:#E6DB74;"> &#39;node-web-audio-api&#39;</span><span style="color:#F8F8F2;">; </span></span>
<span class="line"></span>
<span class="line"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> { loadConfig } </span><span style="color:#F92672;">from</span><span style="color:#E6DB74;"> &#39;../../utils/load-config.js&#39;</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;">// ...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> client </span><span style="color:#F92672;">=</span><span style="color:#F92672;"> new</span><span style="color:#A6E22E;"> Client</span><span style="color:#F8F8F2;">(config);</span></span>
<span class="line diff add"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> audioContext </span><span style="color:#F92672;">=</span><span style="color:#F92672;"> new</span><span style="color:#A6E22E;"> AudioContext</span><span style="color:#F8F8F2;">(); </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">client.pluginManager.</span><span style="color:#A6E22E;">register</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;checkin&#39;</span><span style="color:#F8F8F2;">, pluginCheckin); </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">client.pluginManager.</span><span style="color:#A6E22E;">register</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;sync&#39;</span><span style="color:#F8F8F2;">, pluginSync, { </span></span>
<span class="line diff add"><span style="color:#A6E22E;">  getTimeFunction</span><span style="color:#F8F8F2;">: () </span><span style="color:#66D9EF;font-style:italic;">=&gt;</span><span style="color:#F8F8F2;"> audioContext.currentTime, </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">}); </span></span></code></pre></div><h2 id="implementing-the-controller" tabindex="-1">Implementing the controller <a class="header-anchor" href="#implementing-the-controller" aria-label="Permalink to “Implementing the controller”">​</a></h2><p>Now that everything is set up, it is time to implement our controller logic.</p><p>Let&#39;s first import a few components, attach to our <code>global</code> state and sketch our graphical user interface:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki monokai has-diff" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#88846F;">// src/clients/controller/index.js</span></span>
<span class="line"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> { html, render } </span><span style="color:#F92672;">from</span><span style="color:#E6DB74;"> &#39;lit&#39;</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F92672;">import</span><span style="color:#E6DB74;"> &#39;../components/sw-audit.js&#39;</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"></span>
<span class="line diff add"><span style="color:#F92672;">import</span><span style="color:#E6DB74;"> &#39;@ircam/sc-components/sc-matrix.js&#39;</span><span style="color:#F8F8F2;">; </span></span>
<span class="line diff add"><span style="color:#F92672;">import</span><span style="color:#E6DB74;"> &#39;@ircam/sc-components/sc-text.js&#39;</span><span style="color:#F8F8F2;">; </span></span>
<span class="line diff add"><span style="color:#F92672;">import</span><span style="color:#E6DB74;"> &#39;@ircam/sc-components/sc-transport.js&#39;</span><span style="color:#F8F8F2;">; </span></span>
<span class="line diff add"><span style="color:#F92672;">import</span><span style="color:#E6DB74;"> &#39;@ircam/sc-components/sc-number.js&#39;</span><span style="color:#F8F8F2;">; </span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;">// ... </span></span>
<span class="line"></span>
<span class="line"><span style="color:#F92672;">await</span><span style="color:#F8F8F2;"> client.</span><span style="color:#A6E22E;">start</span><span style="color:#F8F8F2;">();</span></span>
<span class="line"></span>
<span class="line diff add"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> global </span><span style="color:#F92672;">=</span><span style="color:#F92672;"> await</span><span style="color:#F8F8F2;"> client.stateManager.</span><span style="color:#A6E22E;">attach</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;global&#39;</span><span style="color:#F8F8F2;">); </span></span>
<span class="line diff add"><span style="color:#88846F;">// update screen on update</span></span>
<span class="line diff add"><span style="color:#F8F8F2;">global.</span><span style="color:#A6E22E;">onUpdate</span><span style="color:#F8F8F2;">(() </span><span style="color:#66D9EF;font-style:italic;">=&gt;</span><span style="color:#A6E22E;"> renderApp</span><span style="color:#F8F8F2;">()); </span></span>
<span class="line"></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">function</span><span style="color:#A6E22E;"> renderApp</span><span style="color:#F8F8F2;">() {</span></span>
<span class="line"><span style="color:#A6E22E;">  render</span><span style="color:#F8F8F2;">(</span><span style="color:#A6E22E;">html</span><span style="color:#E6DB74;">`</span></span>
<span class="line"><span style="color:#E6DB74;">    &lt;div class=&quot;controller-layout&quot;&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">      &lt;header&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">        &lt;h1&gt;</span><span style="color:#F92672;">${</span><span style="color:#F8F8F2;">client.config.app.name</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;"> | </span><span style="color:#F92672;">${</span><span style="color:#F8F8F2;">client.role</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;">&lt;/h1&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">        &lt;sw-audit .client=&quot;</span><span style="color:#F92672;">${</span><span style="color:#F8F8F2;">client</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;">&quot;&gt;&lt;/sw-audit&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">      &lt;/header&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">      &lt;section&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">        &lt;p&gt;Hello </span><span style="color:#F92672;">${</span><span style="color:#F8F8F2;">client.config.app.name</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;">!&lt;/p&gt; // [!code --]</span></span>
<span class="line"><span style="color:#E6DB74;">        &lt;div&gt; // [!code ++]</span></span>
<span class="line"><span style="color:#E6DB74;">          &lt;div style=&quot;margin-bottom: 4px;&quot;&gt; // [!code ++]</span></span>
<span class="line"><span style="color:#E6DB74;">            &lt;sc-transport  // [!code ++]</span></span>
<span class="line diff add"><span style="color:#E6DB74;">              .buttons=</span><span style="color:#F92672;">${</span><span style="color:#F8F8F2;">[</span><span style="color:#E6DB74;">&#39;play&#39;</span><span style="color:#F8F8F2;">, </span><span style="color:#E6DB74;">&#39;stop&#39;</span><span style="color:#F8F8F2;">]</span><span style="color:#F92672;">}</span></span>
<span class="line diff add"><span style="color:#E6DB74;">              value=</span><span style="color:#F92672;">${</span><span style="color:#F8F8F2;">global.</span><span style="color:#A6E22E;">get</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;running&#39;</span><span style="color:#F8F8F2;">) </span><span style="color:#F92672;">?</span><span style="color:#E6DB74;"> &#39;play&#39;</span><span style="color:#F92672;"> :</span><span style="color:#E6DB74;"> &#39;stop&#39;</span><span style="color:#F92672;">}</span></span>
<span class="line"><span style="color:#E6DB74;">            &gt;&lt;/sc-transport&gt; // [!code ++]</span></span>
<span class="line"><span style="color:#E6DB74;">          &lt;/div&gt; // [!code ++]</span></span>
<span class="line"><span style="color:#E6DB74;">          &lt;div style=&quot;margin-bottom: 4px;&quot;&gt; // [!code ++]</span></span>
<span class="line"><span style="color:#E6DB74;">            &lt;sc-text&gt;BPM&lt;/sc-text&gt; // [!code ++]</span></span>
<span class="line"><span style="color:#E6DB74;">            &lt;sc-number // [!code ++]</span></span>
<span class="line"><span style="color:#E6DB74;">              min=&quot;50&quot; // [!code ++]</span></span>
<span class="line"><span style="color:#E6DB74;">              max=&quot;240&quot; // [!code ++]</span></span>
<span class="line diff add"><span style="color:#E6DB74;">              value=</span><span style="color:#F92672;">${</span><span style="color:#F8F8F2;">global.</span><span style="color:#A6E22E;">get</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;BPM&#39;</span><span style="color:#F8F8F2;">)</span><span style="color:#F92672;">}</span></span>
<span class="line"><span style="color:#E6DB74;">            &gt;&lt;/sc-number&gt; // [!code ++]</span></span>
<span class="line"><span style="color:#E6DB74;">          &lt;/div&gt; // [!code ++]</span></span>
<span class="line"><span style="color:#E6DB74;">          &lt;div style=&quot;margin-bottom: 4px;&quot;&gt; // [!code ++]</span></span>
<span class="line"><span style="color:#E6DB74;">            &lt;sc-matrix // [!code ++]</span></span>
<span class="line diff add"><span style="color:#E6DB74;">              .value=</span><span style="color:#F92672;">${</span><span style="color:#F8F8F2;">global.</span><span style="color:#A6E22E;">get</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;score&#39;</span><span style="color:#F8F8F2;">)</span><span style="color:#F92672;">}</span></span>
<span class="line"><span style="color:#E6DB74;">            &gt;&lt;/sc-matrix&gt; // [!code ++]</span></span>
<span class="line"><span style="color:#E6DB74;">          &lt;/div&gt; // [!code ++]</span></span>
<span class="line"><span style="color:#E6DB74;">        &lt;/div&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">      &lt;/section&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">    &lt;/div&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">  `</span><span style="color:#F8F8F2;">, $container);</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre></div><p>If you open your controller in a Web browser, you should now see the following interface:</p><p><img src="/assets/controller-interface.DPTg6hIm.png" alt="controller-interface"></p><p>Now let&#39;s just change a bit our code to propagate the changes made in our interface in the <code>global</code> state:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki monokai has-diff" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#F92672;">await</span><span style="color:#F8F8F2;"> client.</span><span style="color:#A6E22E;">start</span><span style="color:#F8F8F2;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">  const</span><span style="color:#F8F8F2;"> global </span><span style="color:#F92672;">=</span><span style="color:#F92672;"> await</span><span style="color:#F8F8F2;"> client.stateManager.</span><span style="color:#A6E22E;">attach</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;global&#39;</span><span style="color:#F8F8F2;">);</span></span>
<span class="line"><span style="color:#88846F;">  // update screen on update</span></span>
<span class="line"><span style="color:#F8F8F2;">  global.</span><span style="color:#A6E22E;">onUpdate</span><span style="color:#F8F8F2;">(() </span><span style="color:#66D9EF;font-style:italic;">=&gt;</span><span style="color:#A6E22E;"> renderApp</span><span style="color:#F8F8F2;">());</span></span>
<span class="line"></span>
<span class="line diff add"><span style="color:#66D9EF;font-style:italic;">  const</span><span style="color:#F8F8F2;"> sync </span><span style="color:#F92672;">=</span><span style="color:#F92672;"> await</span><span style="color:#F8F8F2;"> client.pluginManager.</span><span style="color:#A6E22E;">get</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;sync&#39;</span><span style="color:#F8F8F2;">); </span></span>
<span class="line"></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">  function</span><span style="color:#A6E22E;"> renderApp</span><span style="color:#F8F8F2;">() {</span></span>
<span class="line"><span style="color:#A6E22E;">    render</span><span style="color:#F8F8F2;">(</span><span style="color:#A6E22E;">html</span><span style="color:#E6DB74;">`</span></span>
<span class="line"><span style="color:#E6DB74;">      &lt;div class=&quot;controller-layout&quot;&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">        &lt;header&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">          &lt;h1&gt;</span><span style="color:#F92672;">${</span><span style="color:#F8F8F2;">client.config.app.name</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;"> | </span><span style="color:#F92672;">${</span><span style="color:#F8F8F2;">client.role</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;">&lt;/h1&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">          &lt;sw-audit .client=&quot;</span><span style="color:#F92672;">${</span><span style="color:#F8F8F2;">client</span><span style="color:#F92672;">}</span><span style="color:#E6DB74;">&quot;&gt;&lt;/sw-audit&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">        &lt;/header&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">        &lt;section&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">          &lt;div&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">            &lt;div style=&quot;margin-bottom: 4px;&quot;&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">              &lt;sc-transport</span></span>
<span class="line"><span style="color:#E6DB74;">                .buttons=</span><span style="color:#F92672;">${</span><span style="color:#F8F8F2;">[</span><span style="color:#E6DB74;">&#39;play&#39;</span><span style="color:#F8F8F2;">, </span><span style="color:#E6DB74;">&#39;stop&#39;</span><span style="color:#F8F8F2;">]</span><span style="color:#F92672;">}</span></span>
<span class="line"><span style="color:#E6DB74;">                value=</span><span style="color:#F92672;">${</span><span style="color:#F8F8F2;">global.</span><span style="color:#A6E22E;">get</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;running&#39;</span><span style="color:#F8F8F2;">) </span><span style="color:#F92672;">?</span><span style="color:#E6DB74;"> &#39;play&#39;</span><span style="color:#F92672;"> :</span><span style="color:#E6DB74;"> &#39;stop&#39;</span><span style="color:#F92672;">}</span></span>
<span class="line diff add"><span style="color:#E6DB74;">                @change=</span><span style="color:#F92672;">${</span><span style="color:#FD971F;font-style:italic;">e</span><span style="color:#66D9EF;font-style:italic;"> =&gt;</span><span style="color:#F8F8F2;"> { </span></span>
<span class="line diff add"><span style="color:#F92672;">                  if</span><span style="color:#F8F8F2;"> (e.detail.value </span><span style="color:#F92672;">===</span><span style="color:#E6DB74;"> &#39;stop&#39;</span><span style="color:#F8F8F2;">) { </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">                    global.</span><span style="color:#A6E22E;">set</span><span style="color:#F8F8F2;">({ running: </span><span style="color:#AE81FF;">false</span><span style="color:#F8F8F2;"> }); </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">                  } </span><span style="color:#F92672;">else</span><span style="color:#F8F8F2;"> { </span></span>
<span class="line diff add"><span style="color:#88846F;">                    // grab current sync time</span></span>
<span class="line diff add"><span style="color:#66D9EF;font-style:italic;">                    const</span><span style="color:#F8F8F2;"> syncTime </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> sync.</span><span style="color:#A6E22E;">getSyncTime</span><span style="color:#F8F8F2;">(); </span></span>
<span class="line diff add"><span style="color:#88846F;">                    // add an offset to the syncTime to handle network latency</span></span>
<span class="line diff add"><span style="color:#66D9EF;font-style:italic;">                    const</span><span style="color:#F8F8F2;"> startTime </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> syncTime </span><span style="color:#F92672;">+</span><span style="color:#AE81FF;"> 0.5</span><span style="color:#F8F8F2;">; </span></span>
<span class="line diff add"><span style="color:#88846F;">                    // propagate values on the network</span></span>
<span class="line diff add"><span style="color:#F8F8F2;">                    global.</span><span style="color:#A6E22E;">set</span><span style="color:#F8F8F2;">({ running: </span><span style="color:#AE81FF;">true</span><span style="color:#F8F8F2;">, startTime }); </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">                  } </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">                }</span><span style="color:#F92672;">}</span></span>
<span class="line"><span style="color:#E6DB74;">              &gt;&lt;/sc-transport&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">            &lt;/div&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">            &lt;div style=&quot;margin-bottom: 4px;&quot;&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">              &lt;sc-text&gt;BPM&lt;/sc-text&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">              &lt;sc-number</span></span>
<span class="line"><span style="color:#E6DB74;">                min=&quot;50&quot;</span></span>
<span class="line"><span style="color:#E6DB74;">                max=&quot;240&quot;</span></span>
<span class="line"><span style="color:#E6DB74;">                value=</span><span style="color:#F92672;">${</span><span style="color:#F8F8F2;">global.</span><span style="color:#A6E22E;">get</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;BPM&#39;</span><span style="color:#F8F8F2;">)</span><span style="color:#F92672;">}</span></span>
<span class="line diff add"><span style="color:#E6DB74;">                ?disabled=</span><span style="color:#F92672;">${</span><span style="color:#F8F8F2;">global.</span><span style="color:#A6E22E;">get</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;running&#39;</span><span style="color:#F8F8F2;">)</span><span style="color:#F92672;">}</span></span>
<span class="line diff add"><span style="color:#E6DB74;">                @change=</span><span style="color:#F92672;">${</span><span style="color:#FD971F;font-style:italic;">e</span><span style="color:#66D9EF;font-style:italic;"> =&gt;</span><span style="color:#F8F8F2;"> global.</span><span style="color:#A6E22E;">set</span><span style="color:#F8F8F2;">({ BPM: e.detail.value })</span><span style="color:#F92672;">}</span></span>
<span class="line"><span style="color:#E6DB74;">              &gt;&lt;/sc-number&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">            &lt;/div&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">            &lt;div style=&quot;margin-bottom: 4px;&quot;&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">              &lt;sc-matrix</span></span>
<span class="line"><span style="color:#E6DB74;">                .value=</span><span style="color:#F92672;">${</span><span style="color:#F8F8F2;">global.</span><span style="color:#A6E22E;">get</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;score&#39;</span><span style="color:#F8F8F2;">)</span><span style="color:#F92672;">}</span></span>
<span class="line diff add"><span style="color:#E6DB74;">                @change=</span><span style="color:#F92672;">${</span><span style="color:#FD971F;font-style:italic;">e</span><span style="color:#66D9EF;font-style:italic;"> =&gt;</span><span style="color:#F8F8F2;"> global.</span><span style="color:#A6E22E;">set</span><span style="color:#F8F8F2;">({ score: e.detail.value })</span><span style="color:#F92672;">}</span></span>
<span class="line"><span style="color:#E6DB74;">              &gt;&lt;/sc-matrix&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">            &lt;/div&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">          &lt;/div&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">        &lt;/section&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">      &lt;/div&gt;</span></span>
<span class="line"><span style="color:#E6DB74;">    `</span><span style="color:#F8F8F2;">, $container);</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span></code></pre></div><div class="info custom-block"><p class="custom-block-title custom-block-title-default">INFO</p><p>Note how we disabled the BPM number box when the step sequencer is running:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki monokai" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#F92672;">?</span><span style="color:#F8F8F2;">disabled</span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;">${global.get(</span><span style="color:#E6DB74;">&#39;running&#39;</span><span style="color:#F8F8F2;">)}</span></span></code></pre></div><p>to make clear to the user that the BPM can be changed only when it is stopped.</p></div><p>If you now open two controllers side by side, e.g. <a href="http://127.0.0.1:8000?emulate=2" target="_blank" rel="noreferrer">http://127.0.0.1:8000?emulate=2</a>, you should see that the two controllers stay perfectly synchronized:</p><p><img src="/assets/controller-synced.Dhh54bgZ.png" alt="controller-synced"></p><h2 id="implementing-the-audio-engine" tabindex="-1">Implementing the audio engine <a class="header-anchor" href="#implementing-the-audio-engine" aria-label="Permalink to “Implementing the audio engine”">​</a></h2><p>Now that all our controls are set up, let&#39;s go back to our thing clients to implement the audio engine and logic.</p><h3 id="loading-some-audio-files" tabindex="-1">Loading some audio files <a class="header-anchor" href="#loading-some-audio-files" aria-label="Permalink to “Loading some audio files”">​</a></h3><p>First let&#39;s add a few audio files into our project, that our step sequencer will be able to use for audio rendering. For simplicity, let&#39;s put them in the <code>public</code> directory.</p><div class="info custom-block"><p class="custom-block-title custom-block-title-default">INFO</p><p>The set of samples used in the tutorial can be downloaded <a href="/static-assets/step-sequencer-samples.zip">here</a></p></div><p>Your file system should now look like the following:</p><p><img src="/assets/filesystem-assets.1FnjDJqW.png" alt="filesystem-assets"></p><p>Now let&#39;s load these file into our thing clients:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki monokai has-diff" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> { AudioContext } </span><span style="color:#F92672;">from</span><span style="color:#E6DB74;"> &#39;node-web-audio-api&#39;</span><span style="color:#F8F8F2;">;</span></span>
<span class="line diff add"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> { AudioBufferLoader } </span><span style="color:#F92672;">from</span><span style="color:#E6DB74;"> &#39;@ircam/sc-loader&#39;</span><span style="color:#F8F8F2;">; </span></span>
<span class="line"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> { loadConfig } </span><span style="color:#F92672;">from</span><span style="color:#E6DB74;"> &#39;../../utils/load-config.js&#39;</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;">// ...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F92672;">await</span><span style="color:#F8F8F2;"> client.</span><span style="color:#A6E22E;">start</span><span style="color:#F8F8F2;">();</span></span>
<span class="line"></span>
<span class="line diff add"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> audioFiles </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> [ </span></span>
<span class="line diff add"><span style="color:#E6DB74;">  &#39;public/assets/hh.wav&#39;</span><span style="color:#F8F8F2;">, </span></span>
<span class="line diff add"><span style="color:#E6DB74;">  &#39;public/assets/clap.wav&#39;</span><span style="color:#F8F8F2;">, </span></span>
<span class="line diff add"><span style="color:#E6DB74;">  &#39;public/assets/rimshot.wav&#39;</span><span style="color:#F8F8F2;">, </span></span>
<span class="line diff add"><span style="color:#E6DB74;">  &#39;public/assets/snare.wav&#39;</span><span style="color:#F8F8F2;">, </span></span>
<span class="line diff add"><span style="color:#E6DB74;">  &#39;public/assets/kick.wav&#39;</span><span style="color:#F8F8F2;">, </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">]; </span></span>
<span class="line diff add"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> loader </span><span style="color:#F92672;">=</span><span style="color:#F92672;"> new</span><span style="color:#A6E22E;"> AudioBufferLoader</span><span style="color:#F8F8F2;">(audioContext); </span></span>
<span class="line diff add"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> audioBuffers </span><span style="color:#F92672;">=</span><span style="color:#F92672;"> await</span><span style="color:#F8F8F2;"> loader.</span><span style="color:#A6E22E;">load</span><span style="color:#F8F8F2;">(audioFiles); </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">console.</span><span style="color:#A6E22E;">log</span><span style="color:#F8F8F2;">(audioBuffers); </span></span></code></pre></div><p>You should see logged into the console the loaded audio buffers.</p><h3 id="creating-the-synchronized-scheduler" tabindex="-1">Creating the synchronized scheduler <a class="header-anchor" href="#creating-the-synchronized-scheduler" aria-label="Permalink to “Creating the synchronized scheduler”">​</a></h3><p>Then, let&#39;s create a scheduler, running in the synchronized time, i.e. scheduling events in the synchronized timeline, but able to provide us the corresponding time in the <code>audioContext</code> time reference:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki monokai has-diff" style="background-color:#272822;color:#F8F8F2;" tabindex="0" dir="ltr"><code><span class="line"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> { AudioBufferLoader } </span><span style="color:#F92672;">from</span><span style="color:#E6DB74;"> &#39;@ircam/sc-loader&#39;</span><span style="color:#F8F8F2;">;</span></span>
<span class="line diff add"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> { Scheduler } </span><span style="color:#F92672;">from</span><span style="color:#E6DB74;"> &#39;@ircam/sc-scheduling&#39;</span><span style="color:#F8F8F2;">; </span></span>
<span class="line"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> { loadConfig } </span><span style="color:#F92672;">from</span><span style="color:#E6DB74;"> &#39;../../utils/load-config.js&#39;</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;">// ...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F92672;">await</span><span style="color:#F8F8F2;"> client.</span><span style="color:#A6E22E;">start</span><span style="color:#F8F8F2;">();</span></span>
<span class="line"></span>
<span class="line diff add"><span style="color:#88846F;">// retrieve initialized sync plugin</span></span>
<span class="line diff add"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> sync </span><span style="color:#F92672;">=</span><span style="color:#F92672;"> await</span><span style="color:#F8F8F2;"> client.pluginManager.</span><span style="color:#A6E22E;">get</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;sync&#39;</span><span style="color:#F8F8F2;">); </span></span>
<span class="line diff add"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> scheduler </span><span style="color:#F92672;">=</span><span style="color:#F92672;"> new</span><span style="color:#A6E22E;"> Scheduler</span><span style="color:#F8F8F2;">(() </span><span style="color:#66D9EF;font-style:italic;">=&gt;</span><span style="color:#F8F8F2;"> sync.</span><span style="color:#A6E22E;">getSyncTime</span><span style="color:#F8F8F2;">(), { </span></span>
<span class="line diff add"><span style="color:#88846F;">  // provide the transfert function that will allow the scheduler to map from</span></span>
<span class="line diff add"><span style="color:#88846F;">  // its current time (the sync time) and the audio time (the sync plugin local time)</span></span>
<span class="line diff add"><span style="color:#A6E22E;">  currentTimeToProcessorTimeFunction</span><span style="color:#F8F8F2;">: </span><span style="color:#FD971F;font-style:italic;">syncTime</span><span style="color:#66D9EF;font-style:italic;"> =&gt;</span><span style="color:#F8F8F2;"> sync.</span><span style="color:#A6E22E;">getLocalTime</span><span style="color:#F8F8F2;">(syncTime), </span></span>
<span class="line diff add"><span style="color:#F8F8F2;">}); </span></span>
<span class="line"></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">const</span><span style="color:#F8F8F2;"> audioFiles </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> [</span></span>
<span class="line"><span style="color:#88846F;">  // ...</span></span>
<span class="line"><span style="color:#F8F8F2;">];</span></span></code></pre></div><h3 id="implementing-the-audio-engine-1" tabindex="-1">Implementing the audio engine <a class="header-anchor" href="#implementing-the-audio-engine-1" aria-label="Permalink to “Implementing the audio engine”">​</a></h3><p>Then implement a simple audio engine that will play a track from the score and an associated buffer according to a given index:</p><h3 id="binding-all-components-with-the-shared-state" tabindex="-1">Binding all components with the shared state <a class="header-anchor" href="#binding-all-components-with-the-shared-state" aria-label="Permalink to “Binding all components with the shared state”">​</a></h3><p>Finally, let&#39;s attach to the <code>global</code> state and create our step sequencer engine which will react to updates of the <code>global</code> state:</p><h2 id="conclusion" tabindex="-1">Conclusion <a class="header-anchor" href="#conclusion" aria-label="Permalink to “Conclusion”">​</a></h2></div></div></main><footer class="VPDocFooter" data-v-d668f7cc data-v-1bcd8184><!--[--><!--]--><!----><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-1bcd8184><span class="visually-hidden" id="doc-footer-aria-label" data-v-1bcd8184>Pager</span><div class="pager" data-v-1bcd8184><a class="VPLink link pager-link prev" href="/tutorials/plugin-sync.html" data-v-1bcd8184><!--[--><span class="desc" data-v-1bcd8184>Previous page</span><span class="title" data-v-1bcd8184>Using Plugins 2 - <i>sync</i></span><!--]--></a></div><div class="pager" data-v-1bcd8184><a class="VPLink link pager-link next" href="/recipes/working-with-max.html" data-v-1bcd8184><!--[--><span class="desc" data-v-1bcd8184>Next page</span><span class="title" data-v-1bcd8184>Working with Max</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"api.md\":\"Hy3wBnac\",\"credits.md\":\"BrA1Pzee\",\"ecosystem_ecosystem.md\":\"BA_RphpA\",\"index.md\":\"C18x0pat\",\"introduction.md\":\"1VoA1VB0\",\"misc__contributing-to-this-site.md\":\"CYeTkNSK\",\"misc__deployment.md\":\"BngYWeyB\",\"misc__local-deployment.md\":\"GnHl-ltB\",\"misc__todo_electron-applications.md\":\"CC5baAKP\",\"misc_websockets-101.md\":\"C-gXDMS3\",\"plugins_checkin.md\":\"C6RM-Tm2\",\"plugins_filesystem.md\":\"FMZlAHa5\",\"plugins_license.md\":\"BACUdzM4\",\"plugins_logger.md\":\"WkoUpJQD\",\"plugins_platform-init.md\":\"CpKNubvr\",\"plugins_position.md\":\"IHw_x8tv\",\"plugins_scripting.md\":\"BmalzbyY\",\"plugins_soundworks-helpers.md\":\"Csh1b2RR\",\"plugins_sync.md\":\"BcOxYxrv\",\"recipes_working-with-max.md\":\"B376Sw62\",\"tools_helpers.md\":\"CZZB8W_o\",\"tools_license.md\":\"BbonFmD2\",\"tutorials__connected-lamp.md\":\"BNjt-enF\",\"tutorials__context.md\":\"BjuHZuxh\",\"tutorials_getting-started.md\":\"BpaQKx_Z\",\"tutorials_node-clients.md\":\"C9rZi5xs\",\"tutorials_plugin-platform-init.md\":\"CVSQ4ZSt\",\"tutorials_plugin-sync.md\":\"BD1vtBCG\",\"tutorials_state-manager.md\":\"DL2GqnxU\",\"tutorials_step-sequencer.md\":\"CBp3A5Ak\",\"tutorials_todo-noise.md\":\"C57Po1TH\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"soundworks\",\"description\":\"Creative coding framework for distributed applications based on Web technologies\",\"base\":\"/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"logo\":\"/logo-nav.png\",\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/collective-soundworks/collective-soundworks.github.io\"}],\"search\":{\"provider\":\"local\"},\"nav\":[{\"text\":\"Guide\",\"link\":\"/tutorials/getting-started\"},{\"text\":\"soundworks API\",\"link\":\"https://soundworks.dev/soundworks\"},{\"text\":\"Credits\",\"link\":\"/credits\"}],\"sidebar\":[{\"text\":\"Introduction\",\"link\":\"/introduction\"},{\"text\":\"Tutorials\",\"items\":[{\"text\":\"Getting Started\",\"link\":\"/tutorials/getting-started\"},{\"text\":\"Using the State Manager\",\"link\":\"/tutorials/state-manager\"},{\"text\":\"Using Plugins 1 - <i>platform-init</i>\",\"link\":\"/tutorials/plugin-platform-init\"},{\"text\":\"The <i>Todo Noise</i> Application\",\"link\":\"/tutorials/todo-noise\"},{\"text\":\"Working with Node Clients\",\"link\":\"/tutorials/node-clients\"},{\"text\":\"Using Plugins 2 - <i>sync</i>\",\"link\":\"/tutorials/plugin-sync\"},{\"text\":\"Distributed Step Sequencer\",\"link\":\"/tutorials/step-sequencer\"}]},{\"text\":\"Recipes\",\"items\":[{\"text\":\"Working with Max\",\"link\":\"/recipes/working-with-max\"}]},{\"text\":\"Documentation\",\"items\":[{\"text\":\"soundworks API\",\"link\":\"https://soundworks.dev/soundworks\"},{\"text\":\"Helpers\",\"link\":\"/tools/helpers\"},{\"text\":\"Plugin Platform Init\",\"link\":\"/plugins/platform-init\"},{\"text\":\"Plugin Sync\",\"link\":\"/plugins/sync\"},{\"text\":\"Plugin Filesystem\",\"link\":\"/plugins/filesystem\"},{\"text\":\"Plugin Scripting\",\"link\":\"/plugins/scripting\"},{\"text\":\"Plugin Checkin\",\"link\":\"/plugins/checkin\"},{\"text\":\"Plugin Position\",\"link\":\"/plugins/position\"},{\"text\":\"Plugin Logger\",\"link\":\"/plugins/logger\"}]},{\"text\":\"Ecosystem\",\"items\":[{\"text\":\"node-web-audio-api\",\"link\":\"https://github.com/ircam-ismm/node-web-audio-api/\"},{\"text\":\"@ircam/sc-components\",\"link\":\"https://github.com/ircam-ismm/sc-components/\"},{\"text\":\"@ircam/sc-utils\",\"link\":\"https://github.com/ircam-ismm/sc-utils\"},{\"text\":\"@ircam/sc-scheduling\",\"link\":\"https://github.com/ircam-ismm/sc-scheduling/\"},{\"text\":\"@ircam/devicemotion\",\"link\":\"https://github.com/ircam-ismm/devicemotion\"},{\"text\":\"dotpi tools\",\"link\":\"https://ircam-ismm.github.io/dotpi/\"}]},{\"text\":\"Misc\",\"items\":[{\"text\":\"WebSockets 101\",\"link\":\"/misc/websockets-101\"}]}]},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false,\"additionalConfig\":{}}");</script>
    
  </body>
</html>